---
csrf-param: authenticity_token
csrf-token: onoAHE2wF0bCJFyTUJjlf9N2SIBFV/7HFbwQawZnsq839Xddt4Dt9OmaWiHf8lNZNu4a1NgpiOLwAgOxQ9IOeg==
description: Redmine
keywords: issue,bug,tracker
lang: en
title: Icarus ops software configuration - ICARUS operations - Fermilab
  Redmine
viewport: width=device-width, initial-scale=1, maximum-scale=1,
  user-scalable=no
---

::: {#wrapper}
::: {.flyout-menu .js-flyout-menu}
::: {.flyout-menu__search}
⚲
:::

::: {.flyout-menu__avatar .flyout-menu__avatar--no-avatar}
[mengel](/redmine/users/3){.user .active}
:::

### Project

[]{.js-project-menu}

### General

[]{.js-general-menu} []{.js-sidebar .flyout-menu__sidebar}

### Profile

[]{.js-profile-menu}
:::

::: {#wrapper2}
::: {#wrapper3}
::: {#top-menu}
::: {#account}
-   [My account](/redmine/my/account){.my-account}
-   [Sign out](/redmine/logout){.logout}
:::

::: {#loggedas}
Logged in as [mengel](/redmine/users/3){.user .active}
:::

-   [Home](/redmine/){.home}
-   [My page](/redmine/my/page){.my-page}
-   [Projects](/redmine/projects){.projects}
-   [Administration](/redmine/admin){.administration}
-   [Help](https://www.redmine.org/guide){.help}
:::

::: {#header}
[](#){.mobile-toggle-button .js-flyout-menu-toggle-button}

::: {#quick-search}
[Search](/redmine/projects/icarus-operations/search):

::: {#project-jump .drdn}
[ICARUS operations]{.drdn-trigger}

::: {.drdn-content}
::: {.quick-search}
:::

::: {.drdn-items .projects .selection}
[[MISER]{style="padding-left:0px;"}](/redmine/projects/miser?jump=wiki "MISER")[[Footprints
Forwarder]{style="padding-left:0px;"}](/redmine/projects/footprints-forwarder?jump=wiki "Footprints Forwarder")[[Offsite
Account
Request]{style="padding-left:0px;"}](/redmine/projects/offsite-acct-req?jump=wiki "Offsite Account Request")[[Service-NOW
SOAP]{style="padding-left:0px;"}](/redmine/projects/servicenow-soap?jump=wiki "Service-NOW SOAP")[[art]{style="padding-left:0px;"}](/redmine/projects/art?jump=wiki "art")[[art_root_io]{style="padding-left:16px;"}](/redmine/projects/art_root_io?jump=wiki "art_root_io")[[Spack
Planning]{style="padding-left:0px;"}](/redmine/projects/spack-planning?jump=wiki "Spack Planning")[[Compute
Services
Tools]{style="padding-left:0px;"}](/redmine/projects/scd-cst?jump=wiki "Compute Services Tools")[[FIFE]{style="padding-left:0px;"}](/redmine/projects/fife?jump=wiki "FIFE")[[HEPCloud
Decision
Engine]{style="padding-left:0px;"}](/redmine/projects/decisionengine?jump=wiki "HEPCloud Decision Engine")[[IFront]{style="padding-left:0px;"}](/redmine/projects/ifront?jump=wiki "IFront")[[JobSub]{style="padding-left:0px;"}](/redmine/projects/jobsub?jump=wiki "JobSub")[[LAr-Continuous-Integration]{style="padding-left:0px;"}](/redmine/projects/lar-ci?jump=wiki "LAr-Continuous-Integration")[[uBooNE
code]{style="padding-left:0px;"}](/redmine/projects/uboonecode?jump=wiki "uBooNE code")[[CC1pi]{style="padding-left:16px;"}](/redmine/projects/cc1pi?jump=wiki "CC1pi")[[UBooNE
alg]{style="padding-left:16px;"}](/redmine/projects/uboonealg?jump=wiki "UBooNE alg")[[uBAna]{style="padding-left:16px;"}](/redmine/projects/ubana?jump=wiki "uBAna")[[uBCRT]{style="padding-left:16px;"}](/redmine/projects/ubcrt?jump=wiki "uBCRT")[[uBCV]{style="padding-left:16px;"}](/redmine/projects/ubcv?jump=wiki "uBCV")[[uBCore]{style="padding-left:16px;"}](/redmine/projects/ubcore?jump=wiki "uBCore")[[uBEvt]{style="padding-left:16px;"}](/redmine/projects/ubevt?jump=wiki "uBEvt")[[uBLite]{style="padding-left:16px;"}](/redmine/projects/ublite?jump=wiki "uBLite")[[uBObj]{style="padding-left:16px;"}](/redmine/projects/ubobj?jump=wiki "uBObj")[[uBRaw]{style="padding-left:16px;"}](/redmine/projects/ubraw?jump=wiki "uBRaw")[[uBReco]{style="padding-left:16px;"}](/redmine/projects/ubreco?jump=wiki "uBReco")[[uBSim]{style="padding-left:16px;"}](/redmine/projects/ubsim?jump=wiki "uBSim")[[uBXSec]{style="padding-left:16px;"}](/redmine/projects/ubxsec?jump=wiki "uBXSec")[[Continuous
Integration
(CI)]{style="padding-left:0px;"}](/redmine/projects/ci?jump=wiki "Continuous Integration (CI)")[[art_ci]{style="padding-left:16px;"}](/redmine/projects/art_ci?jump=wiki "art_ci")[[genie_ci]{style="padding-left:16px;"}](/redmine/projects/genie_ci?jump=wiki "genie_ci")[[glideinwms_ci]{style="padding-left:16px;"}](/redmine/projects/glideinwms_ci?jump=wiki "glideinwms_ci")[[lar_ci]{style="padding-left:16px;"}](/redmine/projects/lar_ci?jump=wiki "lar_ci")[[minerva_ci]{style="padding-left:16px;"}](/redmine/projects/minerva_ci?jump=wiki "minerva_ci")[[nova_ci]{style="padding-left:16px;"}](/redmine/projects/nova_ci?jump=wiki "nova_ci")[[CVDB]{style="padding-left:0px;"}](/redmine/projects/cvdb?jump=wiki "CVDB")[[Data
Analysis as a Service
Musings]{style="padding-left:0px;"}](/redmine/projects/daaas_musings?jump=wiki "Data Analysis as a Service Musings")[[DCAFI]{style="padding-left:0px;"}](/redmine/projects/dcafi?jump=wiki "DCAFI")[[ProtoDUNE
Data
Management]{style="padding-left:0px;"}](/redmine/projects/protodune-data-management?jump=wiki "ProtoDUNE Data Management")[[Fermi
Tape
Tools]{style="padding-left:0px;"}](/redmine/projects/ftt?jump=wiki "Fermi Tape Tools")[[Fermi
Software
Distribution]{style="padding-left:0px;"}](/redmine/projects/fermi-soft-distrib?jump=wiki "Fermi Software Distribution")[[upd]{style="padding-left:16px;"}](/redmine/projects/upd?jump=wiki "upd")[[ups]{style="padding-left:16px;"}](/redmine/projects/ups?jump=wiki "ups")[[Fermi
Redmine]{style="padding-left:0px;"}](/redmine/projects/fermi-redmine?jump=wiki "Fermi Redmine")[[Projects
for Monitoring Redmine
Health]{style="padding-left:16px;"}](/redmine/projects/test-p1?jump=wiki "Projects for Monitoring Redmine Health")[[test-git]{style="padding-left:32px;"}](/redmine/projects/test-git?jump=wiki "test-git")[[test-svn]{style="padding-left:32px;"}](/redmine/projects/test-svn?jump=wiki "test-svn")[[redmine-lib]{style="padding-left:16px;"}](/redmine/projects/redmine-lib?jump=wiki "redmine-lib")[[Jira2Snow]{style="padding-left:0px;"}](/redmine/projects/jira2snow?jump=wiki "Jira2Snow")[[Fifemon]{style="padding-left:0px;"}](/redmine/projects/fifemon?jump=wiki "Fifemon")[[LBNF
Beam
Simulation]{style="padding-left:0px;"}](/redmine/projects/lbne-beamsim?jump=wiki "LBNF Beam Simulation")[[maaws]{style="padding-left:0px;"}](/redmine/projects/maaws?jump=wiki "maaws")[[mediawiki2textile]{style="padding-left:0px;"}](/redmine/projects/mediawiki2textile?jump=wiki "mediawiki2textile")[[MeetingMaker
to
Exchange]{style="padding-left:0px;"}](/redmine/projects/mm-to-ex?jump=wiki "MeetingMaker to Exchange")[[MINERvA]{style="padding-left:0px;"}](/redmine/projects/minerva?jump=wiki "MINERvA")[[MINERvA
Software]{style="padding-left:16px;"}](/redmine/projects/minerva-sw?jump=wiki "MINERvA Software")[[MINERvA
Software
Infrastructure]{style="padding-left:16px;"}](/redmine/projects/mnvsoftinfra?jump=wiki "MINERvA Software Infrastructure")[[PlotUtils
Management]{style="padding-left:16px;"}](/redmine/projects/plotutils-management?jump=wiki "PlotUtils Management")[[Muon
g-2]{style="padding-left:0px;"}](/redmine/projects/g-2?jump=wiki "Muon g-2")[[g-2
TWiki
Conversion]{style="padding-left:16px;"}](/redmine/projects/gm2twikiconv?jump=wiki "g-2 TWiki Conversion")[[gm2aux]{style="padding-left:16px;"}](/redmine/projects/gm2aux?jump=wiki "gm2aux")[[gm2viz]{style="padding-left:16px;"}](/redmine/projects/gm2viz?jump=wiki "gm2viz")[[NOvA-SAM]{style="padding-left:0px;"}](/redmine/projects/nova_sam?jump=wiki "NOvA-SAM")[[NOvA]{style="padding-left:0px;"}](/redmine/projects/nova?jump=wiki "NOvA")[[CHEP
2015
Papers]{style="padding-left:0px;"}](/redmine/projects/nova_chep2015_papers?jump=wiki "CHEP 2015 Papers")[[Production
Operations Management Service
(POMS)]{style="padding-left:0px;"}](/redmine/projects/prod_mgmt_db?jump=wiki "Production Operations Management Service (POMS)")[[Recocert
Framework]{style="padding-left:0px;"}](/redmine/projects/recocert-framework?jump=wiki "Recocert Framework")[[Scientific
Data
Management]{style="padding-left:0px;"}](/redmine/projects/scientific-data-management?jump=wiki "Scientific Data Management")[[REX]{style="padding-left:16px;"}](/redmine/projects/rex?jump=wiki "REX")[[IF
Data Handling Client Tools
(ifdhc)]{style="padding-left:32px;"}](/redmine/projects/ifdhc?jump=wiki "IF Data Handling Client Tools (ifdhc)")[[CPN]{style="padding-left:48px;"}](/redmine/projects/ifdhcpn?jump=wiki "CPN")[[fife_utils]{style="padding-left:48px;"}](/redmine/projects/fife_utils?jump=wiki "fife_utils")[[FIFE
Utils
Demo]{style="padding-left:64px;"}](/redmine/projects/fife-utils-demo?jump=wiki "FIFE Utils Demo")[[IFDH
Art
interface]{style="padding-left:48px;"}](/redmine/projects/ifdh-art?jump=wiki "IFDH Art interface")[[NuConDB-client]{style="padding-left:48px;"}](/redmine/projects/nucondb?jump=wiki "NuConDB-client")[[numsg]{style="padding-left:48px;"}](/redmine/projects/numsg?jump=wiki "numsg")[[REX-Cert-db]{style="padding-left:32px;"}](/redmine/projects/rex-cert-db?jump=wiki "REX-Cert-db")[[REXINT]{style="padding-left:32px;"}](/redmine/projects/rexint?jump=wiki "REXINT")[[SAM]{style="padding-left:16px;"}](/redmine/projects/sam?jump=wiki "SAM")[[SAM-MAIN]{style="padding-left:32px;"}](/redmine/projects/sam-main?jump=wiki "SAM-MAIN")[[Miscellaneous
SAM tools and
scripts]{style="padding-left:48px;"}](/redmine/projects/sam-misc?jump=wiki "Miscellaneous SAM tools and scripts")[[NOVA
SAM
Cookbook]{style="padding-left:48px;"}](/redmine/projects/nova-sam-cookbook?jump=wiki "NOVA SAM Cookbook")[[Fermi
File Transfer
Service]{style="padding-left:48px;"}](/redmine/projects/filetransferservice?jump=wiki "Fermi File Transfer Service")[[SAM
build
util]{style="padding-left:48px;"}](/redmine/projects/sam-util?jump=wiki "SAM build util")[[SAM
C++
servers]{style="padding-left:48px;"}](/redmine/projects/sam-cpp-servers?jump=wiki "SAM C++ servers")[[sam_idl_cpplib]{style="padding-left:64px;"}](/redmine/projects/sam-idl-cpplib?jump=wiki "sam_idl_cpplib")[[sam_lib]{style="padding-left:64px;"}](/redmine/projects/sam-lib?jump=wiki "sam_lib")[[SAM
CORBA DB
server]{style="padding-left:48px;"}](/redmine/projects/sam-python-servers?jump=wiki "SAM CORBA DB server")[[SAM
dataset definition
editor]{style="padding-left:64px;"}](/redmine/projects/sam-def-editor?jump=wiki "SAM dataset definition editor")[[SAM
python
client]{style="padding-left:64px;"}](/redmine/projects/sam-python-client?jump=wiki "SAM python client")[[sam_common_pylib]{style="padding-left:64px;"}](/redmine/projects/sam-common-pylib?jump=wiki "sam_common_pylib")[[sam_idl_pylib]{style="padding-left:64px;"}](/redmine/projects/sam-idl-pylib?jump=wiki "sam_idl_pylib")[[SAM
Dataset
Replicator]{style="padding-left:48px;"}](/redmine/projects/sam_data_replicator?jump=wiki "SAM Dataset Replicator")[[SAM
DDL]{style="padding-left:48px;"}](/redmine/projects/sam-ddl?jump=wiki "SAM DDL")[[SAM
Metrics]{style="padding-left:48px;"}](/redmine/projects/sam-metrics?jump=wiki "SAM Metrics")[[SAM
Oracle
Database]{style="padding-left:48px;"}](/redmine/projects/sam-oracle-db?jump=wiki "SAM Oracle Database")[[SAM
Web
client]{style="padding-left:48px;"}](/redmine/projects/sam-web-client?jump=wiki "SAM Web client")[[SAM
Web
Registry]{style="padding-left:48px;"}](/redmine/projects/sam-web-registry?jump=wiki "SAM Web Registry")[[SAM
Web
services]{style="padding-left:48px;"}](/redmine/projects/sam-web?jump=wiki "SAM Web services")[[Sam_cp
replacement]{style="padding-left:48px;"}](/redmine/projects/sam-cp?jump=wiki "Sam_cp replacement")[[SAM
CORBA
IDL]{style="padding-left:48px;"}](/redmine/projects/sam-idl?jump=wiki "SAM CORBA IDL")[[SAM
station]{style="padding-left:48px;"}](/redmine/projects/sam-station?jump=wiki "SAM station")[[SAM
station
monitor]{style="padding-left:48px;"}](/redmine/projects/sam-station-monitor?jump=wiki "SAM station monitor")[[sam_protobuf]{style="padding-left:48px;"}](/redmine/projects/sam-protobuf?jump=wiki "sam_protobuf")[[XSL
Master
Config]{style="padding-left:48px;"}](/redmine/projects/xsl-master-config?jump=wiki "XSL Master Config")[[Simons
Foundation Data
Management]{style="padding-left:16px;"}](/redmine/projects/simons-dm?jump=wiki "Simons Foundation Data Management")[[Simons-internal]{style="padding-left:32px;"}](/redmine/projects/simons-internal?jump=wiki "Simons-internal")[[LibWDA]{style="padding-left:0px;"}](/redmine/projects/libwda?jump=wiki "LibWDA")[[Scientist
Survey
(Ruby)]{style="padding-left:0px;"}](/redmine/projects/scientist-survey-rub?jump=wiki "Scientist Survey (Ruby)")[[Tester
]{style="padding-left:0px;"}](/redmine/projects/tester?jump=wiki "Tester ")[[Distributed
Computing
Support]{style="padding-left:0px;"}](/redmine/projects/discompsupp?jump=wiki "Distributed Computing Support")[[project-py]{style="padding-left:0px;"}](/redmine/projects/project-py?jump=wiki "project-py")[[Spack
Infrastructure]{style="padding-left:0px;"}](/redmine/projects/spack-infrastructure?jump=wiki "Spack Infrastructure")
:::

::: {.drdn-items .all-projects .selection}
[All Projects](/redmine/projects?jump=wiki)
:::
:::
:::
:::

# [[ICARUS](/redmine/projects/icarus?jump=wiki){.root}[ » ]{.separator}]{.breadcrumbs}[ICARUS operations]{.current-project}

::: {#main-menu .tabs}
-   [+](#){#new-object .new-object}
    -   [New
        issue](/redmine/projects/icarus-operations/issues/new){.new-issue-sub}
    -   [New
        category](/redmine/projects/icarus-operations/issue_categories/new){.new-issue-category}
    -   [New
        version](/redmine/projects/icarus-operations/versions/new){.new-version}
    -   [Log
        time](/redmine/projects/icarus-operations/time_entries/new){.new-timelog}
    -   [Add
        news](/redmine/projects/icarus-operations/news/new){.new-news}
    -   [New
        document](/redmine/projects/icarus-operations/documents/new){.new-document}
    -   [New wiki
        page](/redmine/projects/icarus-operations/wiki/new){.new-wiki-page}
    -   [New
        file](/redmine/projects/icarus-operations/files/new){.new-file}
-   [Overview](/redmine/projects/icarus-operations){.overview}
-   [Activity](/redmine/projects/icarus-operations/activity){.activity}
-   [Issues](/redmine/projects/icarus-operations/issues){.issues}
-   [Spent
    time](/redmine/projects/icarus-operations/time_entries){.time-entries}
-   [Gantt](/redmine/projects/icarus-operations/issues/gantt){.gantt}
-   [Calendar](/redmine/projects/icarus-operations/issues/calendar){.calendar}
-   [News](/redmine/projects/icarus-operations/news){.news}
-   [Documents](/redmine/projects/icarus-operations/documents){.documents}
-   [Wiki](/redmine/projects/icarus-operations/wiki){.wiki .selected}
-   [Files](/redmine/projects/icarus-operations/files){.files}
-   [Repository](/redmine/projects/icarus-operations/repository){.repository}
-   [Settings](/redmine/projects/icarus-operations/settings){.settings}

::: {.tabs-buttons style="display:none;"}
:::
:::
:::

::: {#main}
::: {#sidebar}
### Wiki

-   [Start page](/redmine/projects/icarus-operations/wiki)
-   [Index by title](/redmine/projects/icarus-operations/wiki/index)
-   [Index by date](/redmine/projects/icarus-operations/wiki/date_index)
:::

::: {#content}
::: {.contextual}
[New wiki page](/redmine/projects/icarus-operations/wiki/new){.icon
.icon-add}
[Edit](/redmine/projects/icarus-operations/wiki/Icarus_ops_software_configuration/edit){.icon
.icon-edit}
[Watch](/redmine/watchers/watch?object_id=28264&object_type=wiki_page){.wiki_page-28264-watcher
.icon .icon-fav-off}
[Lock](/redmine/projects/icarus-operations/wiki/Icarus_ops_software_configuration/protect?protected=1){.icon
.icon-lock}
[Rename](/redmine/projects/icarus-operations/wiki/Icarus_ops_software_configuration/rename){.icon
.icon-move}
[Delete](/redmine/projects/icarus-operations/wiki/Icarus_ops_software_configuration){.icon
.icon-del}
[History](/redmine/projects/icarus-operations/wiki/Icarus_ops_software_configuration/history){.icon
.icon-history}
:::

[Wiki](/redmine/projects/icarus-operations/wiki/Wiki) »

::: {.wiki .wiki-page}
[]{#ICARUS-Operations-Software-Configuration}

# ICARUS Operations Software Configuration[¶](#ICARUS-Operations-Software-Configuration){.wiki-anchor}

-   **Table of contents**
-   [ICARUS Operations Software
    Configuration](#ICARUS-Operations-Software-Configuration)
-   [Login at control room console (\"Three Point
    Login\")](#Login-at-control-room-console-Three-Point-Login)
-   [VNC/noVNC](#VNCnoVNC)
    -   [Update firewall](#Update-firewall)
    -   [systemd for vncserver](#systemd-for-vncserver)
    -   [websocket](#websocket)
    -   [Window manager in VNC](#Window-manager-in-VNC)
    -   [icarusdcs vnc server crashes](#icarusdcs-vnc-server-crashes)
-   [Authentication](#Authentication)

::: {#section-2 .contextual .heading-1 title="Edit this section"}
[Edit this
section](/redmine/projects/icarus-operations/wiki/Icarus_ops_software_configuration/edit?section=2){.icon-only
.icon-edit}
:::

[]{#Login-at-control-room-console-Three-Point-Login}

# Login at control room console (\"Three Point Login\")[¶](#Login-at-control-room-console-Three-Point-Login){.wiki-anchor}

-   Login to the sbn account.
-   Enter your kerberos password. (There is no password written
    somewhere).
-   Enter your kerberos username.

If this doesn\'t work then you are probably not in the icarus .k5login
file or you don\'t remember your kerberos password.

    For the "Three Point Login", any user who is in ~/.k5login can login
    with their Kerberos Username and Password.  Once logged in they will
    have a valid ticket that can be used to ssh out.

::: {#section-3 .contextual .heading-1 title="Edit this section"}
[Edit this
section](/redmine/projects/icarus-operations/wiki/Icarus_ops_software_configuration/edit?section=3){.icon-only
.icon-edit}
:::

[]{#VNCnoVNC}

# VNC/noVNC[¶](#VNCnoVNC){.wiki-anchor}

Run a VNC server, run a WebSocket proxy that points to the VNC server,
load the page, and connect! See the quick-start instructions in the
project README for more details.

::: {#section-4 .contextual .heading-2 title="Edit this section"}
[Edit this
section](/redmine/projects/icarus-operations/wiki/Icarus_ops_software_configuration/edit?section=4){.icon-only
.icon-edit}
:::

[]{#Update-firewall}

## Update firewall[¶](#Update-firewall){.wiki-anchor}

Ask the SLAM team to open the firewall on the computer for port 443 on
the public interface.

::: {#section-5 .contextual .heading-2 title="Edit this section"}
[Edit this
section](/redmine/projects/icarus-operations/wiki/Icarus_ops_software_configuration/edit?section=5){.icon-only
.icon-edit}
:::

[]{#systemd-for-vncserver}

## systemd for vncserver[¶](#systemd-for-vncserver){.wiki-anchor}

    /etc/systemd/system
    [root@icarus-evb01 system]# cat vncserver@\:1.service 
    [Unit]
    Description=Remote desktop service (VNC)
    After=syslog.target network.target

    [Service]
    Type=forking
    User=icarus

    # Clean any existing files in /tmp/.X11-unix environment
    ExecStartPre=-/usr/bin/vncserver -kill %i
    ExecStartPre=-/usr/bin/mkdir -p /home/nfs/icarus/.vnc
    ExecStart=/usr/bin/vncserver -localhost -alwaysshared -nolisten tcp -noreset %i
    PIDFile=/home/nfs/icarus/.vnc/%H%i.pid
    ExecStop=-/usr/bin/vncserver -kill %i

    [Install]
    WantedBy=multi-user.target

::: {#section-6 .contextual .heading-2 title="Edit this section"}
[Edit this
section](/redmine/projects/icarus-operations/wiki/Icarus_ops_software_configuration/edit?section=6){.icon-only
.icon-edit}
:::

[]{#websocket}

## websocket[¶](#websocket){.wiki-anchor}

    icarus    54371  54350  0 Jan22 ?        00:00:57     /usr/bin/python /usr/bin/websockify --web /usr/bin/../share/novnc/ 127.0.0.1:15901 127.0.0.1:5901
    icarus     6185  54371  0 Jan27 ?        00:00:10       /usr/bin/python /usr/bin/websockify --web /usr/bin/../share/novnc/ 127.0.0.1:15901 127.0.0.1:5901
    icarus    24397  54371  0 Jan28 ?        00:00:37       /usr/bin/python /usr/bin/websockify --web /usr/bin/../share/novnc/ 127.0.0.1:15901 127.0.0.1:5901
    icarus   162970  54371  0 Jan28 ?        00:00:00       /usr/bin/python /usr/bin/websockify --web /usr/bin/../share/novnc/ 127.0.0.1:15901 127.0.0.1:5901

    [root@icarus-evb01 system]# cat novnc@\:1.service 
    [Unit]
    Description=VNC over HTTP
    After=vncserver@:1.service
    Requires=vncserver@:1.service

    [Service]
    Type=simple
    User=icarus

    ExecStart=/usr/bin/novnc_server --vnc 127.0.0.1:5901 --listen 127.0.0.1:15901

    Restart=on-failure
    RestartSec=2

    [Install]
    WantedBy=multi-user.target

    Just a follow up on what I showed everyone upstairs.

    For the "Three Point Login", any user who is in ~/.k5login can login
    with their Kerberos Username and Password.  Once logged in they will
    have a valid ticket that can be used to ssh out.

    I put a script on Icarus CR 01 called "setup_tunnel" which is really
    just a wrapper around:

    ssh -L 8443:icarus-evb01.fnal.gov:443 icarus-gateway01

    And I set the Firefox home page to https://localhost:8443/

    You'll need to use the VNC password you specified to get control of the
    interface.

    You can change the default size of the VNC window by editing
    ~/.vnc/config (geometry) and then restarting the VNC service.  The size
    of the desktop is set at launch time and may generate scroll windows on
    smaller screens.

    Restarting VNC right now requires root access.  If you've got root
    access run: "systemctl restart vncserver@:1.service" 

    You may need to close and re-open firefox if the VNC session is restarted.

    Pat

**NOTE:** The above command `systemctl restart` will restart the server,
but if you want to check the status to see errors and such
(recommended!) then the command is the same but with `status` in place
of `restart`. That is\

    systemctl status vncserver@:1.service

::: {#section-7 .contextual .heading-2 title="Edit this section"}
[Edit this
section](/redmine/projects/icarus-operations/wiki/Icarus_ops_software_configuration/edit?section=7){.icon-only
.icon-edit}
:::

[]{#Window-manager-in-VNC}

## Window manager in VNC[¶](#Window-manager-in-VNC){.wiki-anchor}

    == Puppet Setup ==

    Add the `apache` class with the `novnc` application to the host.
    - Attach `apache` to the host
    - Edit class params to add the `novnc` application for this fqdn

    Add the `desktop` class to the host.

    Edit the `firewall` to permit `https` access to the server from the right network.

    == On the Host ==

    You'll need to put ssl certificates in:
    /etc/httpd/crts/server.crt
    /etc/httpd/crts/server.key
    /etc/httpd/crts/ca.crt

    They can be whatever.

    Whoever owns $vncuser should edit `~/.vnc/config` to meet their needs and set the VNC password.  This config file has replaced a lot of the xstartup bits (with something far more sane).

    Until the VNC password is set, the server wont actually start.

    EL8 plan - move these into systemd user services so they can be restarted by $vncuser

    -----
    puppet agent -t

    VNCUSER="vncuser" 
    USERHOME=$(getent passwd ${VNCUSER} | cut -d ':' -f6)

    mkdir -p ${USERHOME}/.vnc
    mkdir -p ${USERHOME}/.vnc
    cat << EOF >${USERHOME}/.vnc/config
    ## For desktop options do 'ls /usr/share/xsessions/'
    ## Not all desktops are suitable for VNC
    ##
    ## To select one, 
    ##   Extract the 'Exec=' line without Exec= (grep ^Exec= /usr/share/xsessions/icewm.desktop | sed -e 's/Exec=//')
    ##   Put it in ~/.Xclients
    ##   Make ~/.Xclients executable
    ##   It becomes the shell script that starts your window manager
    ##      so you can use various POSIX sh logic if you need to.
    ## echo "icewm-session" > ~/.Xclients ; chmod +x ~/.Xclients
    ##
    ## NOTE: desktop= sets the NAME of the session, not the window manager.
    #desktop=VNC_WINDOW_NUMBER_1
    geometry=1280x1024
    securitytypes=none
    localhost
    alwaysshared
    nolisten=tcp
    EOF

    cat << EOF >${USERHOME}/.vnc/xstartup
    #!/bin/sh
    unset SESSION_MANAGER
    unset DBUS_SESSION_BUS_ADDRESS
    VNC_DISPLAY=${DISPLAY}
    export VNC_DISPLAY
    exec /etc/X11/xinit/xinitrc
    # If the window manager exits, kill the session
    vncserver -kill ${DISPLAY}
    EOF

    chmod +x ${USERHOME}/.vnc/xstartup
    chown -R ${VNCUSER}:users ${USERHOME}/.vnc

    cat << EOF >/etc/systemd/system/vncserver@:1.service
    [Unit]
    Description=Remote desktop service (VNC)
    After=syslog.target network.target

    [Service]
    Type=forking
    User=${VNCUSER}

    # Clean any existing files in /tmp/.X11-unix environment
    ExecStartPre=-/usr/bin/vncserver -kill %i
    ExecStartPre=-/usr/bin/mkdir -p ${USERHOME}/.vnc
    ExecStart=/usr/bin/vncserver -localhost -alwaysshared -nolisten tcp -noreset %i
    PIDFile=${USERHOME}/.vnc/%H%i.pid
    ExecStop=-/usr/bin/vncserver -kill %i

    [Install]
    WantedBy=multi-user.target

    EOF

    cat << EOF > /etc/systemd/system/novnc@:1.service
    [Unit]
    Description=VNC over HTTP
    After=vncserver@:1.service
    Requires=vncserver@:1.service

    [Service]
    Type=simple
    User=${VNCUSER}

    ExecStart=/usr/bin/novnc_server --vnc 127.0.0.1:5901 --listen 127.0.0.1:15901

    [Install]
    WantedBy=multi-user.target

    EOF

    systemctl daemon-reload
    systemctl enable vncserver@:1.service novnc@:1.service
    systemctl start vncserver@:1.service novnc@:1.service

    -----

::: {#section-8 .contextual .heading-2 title="Edit this section"}
[Edit this
section](/redmine/projects/icarus-operations/wiki/Icarus_ops_software_configuration/edit?section=8){.icon-only
.icon-edit}
:::

[]{#icarusdcs-vnc-server-crashes}

## icarusdcs vnc server crashes[¶](#icarusdcs-vnc-server-crashes){.wiki-anchor}

15-Oct-2020 These changes did not have the desired effect. Using the CSS
phoebus gui on evb05 vnc crashed the ev06 vnc.

Summarized from RITM1027616.

These days very few Linux desktops support running multiple disconnected
instances out of the same home area.

VNC is running on evb05 and evb06 for the icarusdcs user. They are
trying to access and lock some of the same resources (in particular
/home/nfs/icarusdcs/.gvfs and some local dbus sockets). These files
cannot be shared between two running desktop sessions.

In theory the GOA messages are not that important. It is getting
launched automatically by DBUS via your desktop session. If you add:

sleep 10; kill -9 \`ps -axf \| grep goa-daemon \| cut -c 1-4\`; true

to your .xinitrc that should kill off that service automatically.

I\'d also encourage adding

    GVFS_DISABLE_FUSE=1
    export GVFS_DISABLE_FUSE

to \~/.profile on all the icarus shared accounts not using GNOME, MATE,
or Cinnamon.

The various desktop startup services will try to launch common tools.
Some of those tools depend on gvfs. Odds are you\'re not actually using
those integrations in icewm.

    Configured the files as suggested.  (see below)
    Restarted the vncserver on icarus-evb05.
    + GVFS_DISABLE_FUSE=1 is now set.
    + goa processes are still running.

    [icarusdcs@icarus-evb05 ~]$ cat .xinitrc
    GVFS_DISABLE_FUSE=1
    export GVFS_DISABLE_FUSE

    [icarusdcs@icarus-evb05 ~]$ cat .vnc/xstartup
    #!/bin/sh

    GVFS_DISABLE_FUSE=1
    export GVFS_DISABLE_FUSE

    unset SESSION_MANAGER
    unset DBUS_SESSION_BUS_ADDRESS
    VNC_DISPLAY=${DISPLAY}
    export VNC_DISPLAY
    exec /etc/X11/xinit/xinitrc
    # If the window manager exits, kill the session
    vncserver -kill ${DISPLAY}

    [icarusdcs@icarus-evb05 ~]$ cat .icewm/startup
    #!/bin/bash

    source ~/.profile

    # the sleep is required to ensure ICEWM has loaded the task bar
    sleep 1 && pkill -9 goa-daemon || true
    sleep 1 && pkill -9 goa-identity-service || true
    sleep 1 && pkill -9 gvfs-goa-volume-monitor || true

    [icarusdcs@icarus-evb05 ~]$ printenv | grep GV
    GVFS_DISABLE_FUSE=1
    DBUS_SESSION_BUS_ADDRESS=unix:abstract=/tmp/dbus-x6iBhIDjZU,guid=e1ec7973fcd1de40c15fe6f95f887152;unix:abstract=/tmp/dbus-DZGV1C7xVX,guid=9b6266a4b1f634db04c94e035f887152

    [icarusdcs@icarus-evb05 ~]$ ps -axf | grep goa
     29312 ?        Sl     0:00 /usr/libexec/gvfs-goa-volume-monitor
     29326 ?        SLl    0:00 /usr/libexec/goa-daemon
     29371 ?        Sl     0:00 /usr/libexec/goa-identity-service
    109542 pts/0    S+     0:00      |           \_ grep --color=auto goa

::: {#section-9 .contextual .heading-1 title="Edit this section"}
[Edit this
section](/redmine/projects/icarus-operations/wiki/Icarus_ops_software_configuration/edit?section=9){.icon-only
.icon-edit}
:::

[]{#Authentication}

# Authentication[¶](#Authentication){.wiki-anchor}

1\. request a special principal for the host. If a new principal,
requests need to be approved.\
For the CR this principal is \'<sbn/shift/$host.fnal.gov@FNAL.GOV>\'

2\. you will be emailed a one-time password

3\. create the keytab file in a secure location (the target host). This
file is sensitive and should have\
restrictive permissions.

SVC=service, eg sbn/shift\
HOST=eg icarus-cr-02.fnal.gov\
PASSWD=your one time password\
FILENAME=eg sbnshift (for sbnshift.keytab)

kadmin -p \${SVC}/\${HOST}.fnal.gov -w \${PASSWD} -q \"ktadd -k
\${FILENAME}.keytab \${SVC}/\${HOST}.fnal.gov\"

4\. if you put the keytab in
/var/kerberos/krb5/user/\$EUID/client.keytab, where EUID is the
effective UID of the user (56284 for sbn)\
it will be the default keytab. if you don\'t have a valid ticket account
will kinit against it. This method is the easiest.

5\. To authenticate against this file directly:

CCFILENAME=a filename for the credential cache\
KTFILENAME=your keytab filename\
HOST=your host

export KRB5CCNAME=FILE:\${FILENAME}/tmp/; kinit -A -k -t
/var/adm/krb5/\${KTFILENAME} sbn/shift/\${HOST}.<fnal.gov@FNAL.GOV>

\$KRB5CCNAME is the environment variable krb uses to save the credential
cache.

6\. now if you have KRB5CCNAME set correctly in a shell processes will
use that file as ticket cache\
and will have permissions granted to that principal. You can put
<sbn/shift/$host.fnal.gov@FNAL.GOV> in\
a user\'s .k5login on another host.
:::

Files (0)

::: {style="display: none;"}
::: {#wiki_add_attachment}
::: {.box}
[ [ ]{.attachments_fields} [ (Maximum size: 400 MB) ]{.add_attachment
style=""} ]{.attachments_form}
:::
:::
:::

Also available in:
[PDF](/redmine/projects/icarus-operations/wiki/Icarus_ops_software_configuration.pdf){.pdf}
[HTML](/redmine/projects/icarus-operations/wiki/Icarus_ops_software_configuration.html){.html}
[TXT](/redmine/projects/icarus-operations/wiki/Icarus_ops_software_configuration.txt){.txt}

::: {style="clear:both;"}
:::
:::
:::
:::

::: {#ajax-indicator style="display:none;"}
Loading\...
:::

::: {#ajax-modal style="display:none;"}
:::

::: {#footer}
::: {.bgl}
::: {.bgr}
Powered by [Redmine](https://www.redmine.org/) © 2006-2019 Jean-Philippe
Lang
:::
:::
:::
:::
:::
