<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.5"/>
<title>trkf::TrackKalmanFitter Class Reference</title>
<link href="../../tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../jquery.js"></script>
<script type="text/javascript" src="../../dynsections.js"></script>
<link href="../../search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>
<link href="../../doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<!-- end header part -->
<!-- Generated by Doxygen 1.8.5 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "../../search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="../../index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="../../pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="../../modules.html"><span>Modules</span></a></li>
      <li><a href="../../namespaces.html"><span>Namespaces</span></a></li>
      <li class="current"><a href="../../annotated.html"><span>Classes</span></a></li>
      <li><a href="../../files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="../../search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="../../search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="../../annotated.html"><span>Class&#160;List</span></a></li>
      <li><a href="../../hierarchy.html"><span>Class&#160;Hierarchy</span></a></li>
      <li><a href="../../functions.html"><span>Class&#160;Members</span></a></li>
    </ul>
  </div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Classes</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Namespaces</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Typedefs</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>Enumerations</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(8)"><span class="SelectionMark">&#160;</span>Enumerator</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(9)"><span class="SelectionMark">&#160;</span>Friends</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(10)"><span class="SelectionMark">&#160;</span>Macros</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(11)"><span class="SelectionMark">&#160;</span>Groups</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(12)"><span class="SelectionMark">&#160;</span>Pages</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="../../d0/da2/namespacetrkf.html">trkf</a></li><li class="navelem"><a class="el" href="../../d6/dca/classtrkf_1_1TrackKalmanFitter.html">TrackKalmanFitter</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="summary">
<a href="#nested-classes">Classes</a> &#124;
<a href="#pub-types">Public Types</a> &#124;
<a href="#pub-methods">Public Member Functions</a> &#124;
<a href="#pri-methods">Private Member Functions</a> &#124;
<a href="#pri-attribs">Private Attributes</a> &#124;
<a href="../../d1/d2f/classtrkf_1_1TrackKalmanFitter-members.html">List of all members</a>  </div>
  <div class="headertitle">
<div class="title">trkf::TrackKalmanFitter Class Reference</div>  </div>
</div><!--header-->
<div class="contents">

<p>Fit tracks using Kalman Filter fit+smooth.  
 <a href="../../d6/dca/classtrkf_1_1TrackKalmanFitter.html#details">More...</a></p>

<p><code>#include &lt;<a class="el" href="../../d7/dcf/TrackKalmanFitter_8h_source.html">TrackKalmanFitter.h</a>&gt;</code></p>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="nested-classes"></a>
Classes</h2></td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">struct &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../db/d30/structtrkf_1_1TrackKalmanFitter_1_1Config.html">Config</a></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="pub-types"></a>
Public Types</h2></td></tr>
<tr class="memitem:a7e26f365240b0750d703bf4edafcc898"><td class="memItemLeft" align="right" valign="top">using&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d6/dca/classtrkf_1_1TrackKalmanFitter.html#a7e26f365240b0750d703bf4edafcc898">Parameters</a> = fhicl::Table&lt; <a class="el" href="../../db/d30/structtrkf_1_1TrackKalmanFitter_1_1Config.html">Config</a> &gt;</td></tr>
<tr class="separator:a7e26f365240b0750d703bf4edafcc898"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="pub-methods"></a>
Public Member Functions</h2></td></tr>
<tr class="memitem:a6bd62511762eaeb7817cfa5cd3e1e8ef"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d6/dca/classtrkf_1_1TrackKalmanFitter.html#a6bd62511762eaeb7817cfa5cd3e1e8ef">TrackKalmanFitter</a> (const <a class="el" href="../../dc/d5e/classtrkf_1_1TrackStatePropagator.html">TrackStatePropagator</a> *prop, bool useRMS, bool sortHitsByPlane, bool sortHitsByWire, bool sortOutputHitsMinLength, bool skipNegProp, bool cleanZigzag, bool rejectHighMultHits, bool rejectHitsNegativeGOF, float hitErr2ScaleFact, bool tryNoSkipWhenFails, bool tryBothDirs, bool pickBestHitOnWire, float maxResidue, float maxResidueFirstHit, float maxChi2, float maxDist, float negDistTolerance, int dumpLevel)</td></tr>
<tr class="memdesc:a6bd62511762eaeb7817cfa5cd3e1e8ef"><td class="mdescLeft">&#160;</td><td class="mdescRight">Constructor from <a class="el" href="../../dc/d5e/classtrkf_1_1TrackStatePropagator.html" title="Class for propagation of a trkf::TrackState to a recob::tracking::Plane. ">TrackStatePropagator</a> and values of configuration parameters.  <a href="#a6bd62511762eaeb7817cfa5cd3e1e8ef">More...</a><br/></td></tr>
<tr class="separator:a6bd62511762eaeb7817cfa5cd3e1e8ef"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:afbd2be32a4696b632aa2873547f8ef57"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d6/dca/classtrkf_1_1TrackKalmanFitter.html#afbd2be32a4696b632aa2873547f8ef57">TrackKalmanFitter</a> (const <a class="el" href="../../dc/d5e/classtrkf_1_1TrackStatePropagator.html">TrackStatePropagator</a> *prop, <a class="el" href="../../d6/dca/classtrkf_1_1TrackKalmanFitter.html#a7e26f365240b0750d703bf4edafcc898">Parameters</a> const &amp;<a class="el" href="../../d9/dd2/selectors_8fcl.html#a24c8335057af14a9b508d5ac18999ce5">p</a>)</td></tr>
<tr class="memdesc:afbd2be32a4696b632aa2873547f8ef57"><td class="mdescLeft">&#160;</td><td class="mdescRight">Constructor from <a class="el" href="../../dc/d5e/classtrkf_1_1TrackStatePropagator.html" title="Class for propagation of a trkf::TrackState to a recob::tracking::Plane. ">TrackStatePropagator</a> and Parameters table.  <a href="#afbd2be32a4696b632aa2873547f8ef57">More...</a><br/></td></tr>
<tr class="separator:afbd2be32a4696b632aa2873547f8ef57"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a736d6f1efc6e9f76d7be5bde86faa030"><td class="memItemLeft" align="right" valign="top">bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d6/dca/classtrkf_1_1TrackKalmanFitter.html#a736d6f1efc6e9f76d7be5bde86faa030">fitTrack</a> (<a class="el" href="../../d1/d11/classdetinfo_1_1DetectorPropertiesData.html">detinfo::DetectorPropertiesData</a> const &amp;detProp, const <a class="el" href="../../de/de5/classrecob_1_1TrackTrajectory.html">recob::TrackTrajectory</a> &amp;traj, int tkID, const <a class="el" href="../../d0/da2/namespacetrkf.html#afce9d7f4b81473c0ba04bac01ee6fa51">SMatrixSym55</a> &amp;covVtx, const <a class="el" href="../../d0/da2/namespacetrkf.html#afce9d7f4b81473c0ba04bac01ee6fa51">SMatrixSym55</a> &amp;covEnd, const std::vector&lt; art::Ptr&lt; <a class="el" href="../../db/d4e/classrecob_1_1Hit.html">recob::Hit</a> &gt;&gt; &amp;hits, const double pval, const int pdgid, const bool flipDirection, <a class="el" href="../../d9/dca/classrecob_1_1Track.html">recob::Track</a> &amp;outTrack, std::vector&lt; art::Ptr&lt; <a class="el" href="../../db/d4e/classrecob_1_1Hit.html">recob::Hit</a> &gt;&gt; &amp;outHits, <a class="el" href="../../d0/d41/structtrkmkr_1_1OptionalOutputs.html">trkmkr::OptionalOutputs</a> &amp;optionals) const </td></tr>
<tr class="memdesc:a736d6f1efc6e9f76d7be5bde86faa030"><td class="mdescLeft">&#160;</td><td class="mdescRight">Fit track starting from TrackTrajectory.  <a href="#a736d6f1efc6e9f76d7be5bde86faa030">More...</a><br/></td></tr>
<tr class="separator:a736d6f1efc6e9f76d7be5bde86faa030"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a0d7c02137f7bf515122e293b505c8cb1"><td class="memItemLeft" align="right" valign="top">bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d6/dca/classtrkf_1_1TrackKalmanFitter.html#a0d7c02137f7bf515122e293b505c8cb1">fitTrack</a> (<a class="el" href="../../d1/d11/classdetinfo_1_1DetectorPropertiesData.html">detinfo::DetectorPropertiesData</a> const &amp;detProp, const <a class="el" href="../../d0/da2/namespacetrkf.html#a38ab77d67362ad2a0af6a2a7997cbf5a">Point_t</a> &amp;position, const <a class="el" href="../../d0/da2/namespacetrkf.html#afce448b0c24542e8646ade72b3bd51b3">Vector_t</a> &amp;direction, <a class="el" href="../../d0/da2/namespacetrkf.html#afce9d7f4b81473c0ba04bac01ee6fa51">SMatrixSym55</a> &amp;trackStateCov, const std::vector&lt; art::Ptr&lt; <a class="el" href="../../db/d4e/classrecob_1_1Hit.html">recob::Hit</a> &gt;&gt; &amp;hits, const std::vector&lt; <a class="el" href="../../d3/d86/classrecob_1_1TrajectoryPointFlags.html">recob::TrajectoryPointFlags</a> &gt; &amp;flags, const int tkID, const double pval, const int pdgid, <a class="el" href="../../d9/dca/classrecob_1_1Track.html">recob::Track</a> &amp;outTrack, std::vector&lt; art::Ptr&lt; <a class="el" href="../../db/d4e/classrecob_1_1Hit.html">recob::Hit</a> &gt;&gt; &amp;outHits, <a class="el" href="../../d0/d41/structtrkmkr_1_1OptionalOutputs.html">trkmkr::OptionalOutputs</a> &amp;optionals) const </td></tr>
<tr class="memdesc:a0d7c02137f7bf515122e293b505c8cb1"><td class="mdescLeft">&#160;</td><td class="mdescRight">Fit track starting from intial position, direction, and flags.  <a href="#a0d7c02137f7bf515122e293b505c8cb1">More...</a><br/></td></tr>
<tr class="separator:a0d7c02137f7bf515122e293b505c8cb1"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a4e8612ccdaee7e850a7330f6d955bb1d"><td class="memItemLeft" align="right" valign="top">bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d6/dca/classtrkf_1_1TrackKalmanFitter.html#a4e8612ccdaee7e850a7330f6d955bb1d">doFitWork</a> (<a class="el" href="../../d3/d02/classtrkf_1_1KFTrackState.html">KFTrackState</a> &amp;trackState, <a class="el" href="../../d1/d11/classdetinfo_1_1DetectorPropertiesData.html">detinfo::DetectorPropertiesData</a> const &amp;detProp, std::vector&lt; <a class="el" href="../../da/d57/classtrkf_1_1HitState.html">HitState</a> &gt; &amp;hitstatev, std::vector&lt; <a class="el" href="../../d3/d86/classrecob_1_1TrajectoryPointFlags.html#a1fa59abb69bb752ec069798b2f3b8202">recob::TrajectoryPointFlags::Mask_t</a> &gt; &amp;hitflagsv, std::vector&lt; <a class="el" href="../../d3/d02/classtrkf_1_1KFTrackState.html">KFTrackState</a> &gt; &amp;fwdPrdTkState, std::vector&lt; <a class="el" href="../../d3/d02/classtrkf_1_1KFTrackState.html">KFTrackState</a> &gt; &amp;fwdUpdTkState, std::vector&lt; unsigned int &gt; &amp;hitstateidx, std::vector&lt; unsigned int &gt; &amp;rejectedhsidx, std::vector&lt; unsigned int &gt; &amp;sortedtksidx, bool applySkipClean=<a class="el" href="../../de/d36/crtt0matchingalg__sbnd_8fcl.html#af8bc618309fb2d0f55f7f5ae0760b466">true</a>) const </td></tr>
<tr class="memdesc:a4e8612ccdaee7e850a7330f6d955bb1d"><td class="mdescLeft">&#160;</td><td class="mdescRight">Function where the core of the fit is performed.  <a href="#a4e8612ccdaee7e850a7330f6d955bb1d">More...</a><br/></td></tr>
<tr class="separator:a4e8612ccdaee7e850a7330f6d955bb1d"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="pri-methods"></a>
Private Member Functions</h2></td></tr>
<tr class="memitem:a231eecc69d011725afd8e5b55295976e"><td class="memItemLeft" align="right" valign="top"><a class="el" href="../../d3/d02/classtrkf_1_1KFTrackState.html">KFTrackState</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d6/dca/classtrkf_1_1TrackKalmanFitter.html#a231eecc69d011725afd8e5b55295976e">setupInitialTrackState</a> (const <a class="el" href="../../d0/da2/namespacetrkf.html#a38ab77d67362ad2a0af6a2a7997cbf5a">Point_t</a> &amp;position, const <a class="el" href="../../d0/da2/namespacetrkf.html#afce448b0c24542e8646ade72b3bd51b3">Vector_t</a> &amp;direction, <a class="el" href="../../d0/da2/namespacetrkf.html#afce9d7f4b81473c0ba04bac01ee6fa51">SMatrixSym55</a> &amp;trackStateCov, const double pval, const int pdgid) const </td></tr>
<tr class="memdesc:a231eecc69d011725afd8e5b55295976e"><td class="mdescLeft">&#160;</td><td class="mdescRight">Return track state from intial position, direction, and covariance.  <a href="#a231eecc69d011725afd8e5b55295976e">More...</a><br/></td></tr>
<tr class="separator:a231eecc69d011725afd8e5b55295976e"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a7a47ff89ff45737db6fd90055305af0c"><td class="memItemLeft" align="right" valign="top">bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d6/dca/classtrkf_1_1TrackKalmanFitter.html#a7a47ff89ff45737db6fd90055305af0c">setupInputStates</a> (<a class="el" href="../../d1/d11/classdetinfo_1_1DetectorPropertiesData.html">detinfo::DetectorPropertiesData</a> const &amp;detProp, const std::vector&lt; art::Ptr&lt; <a class="el" href="../../db/d4e/classrecob_1_1Hit.html">recob::Hit</a> &gt;&gt; &amp;hits, const std::vector&lt; <a class="el" href="../../d3/d86/classrecob_1_1TrajectoryPointFlags.html">recob::TrajectoryPointFlags</a> &gt; &amp;flags, const <a class="el" href="../../d3/d02/classtrkf_1_1KFTrackState.html">KFTrackState</a> &amp;trackState, std::vector&lt; <a class="el" href="../../da/d57/classtrkf_1_1HitState.html">HitState</a> &gt; &amp;hitstatev, std::vector&lt; <a class="el" href="../../d3/d86/classrecob_1_1TrajectoryPointFlags.html#a1fa59abb69bb752ec069798b2f3b8202">recob::TrajectoryPointFlags::Mask_t</a> &gt; &amp;hitflagsv) const </td></tr>
<tr class="memdesc:a7a47ff89ff45737db6fd90055305af0c"><td class="mdescLeft">&#160;</td><td class="mdescRight">Setup vectors of <a class="el" href="../../da/d57/classtrkf_1_1HitState.html" title="Class for a measurement on a recob::tracking::Plane (plane defined by a wire and the drift direction)...">HitState</a> and Masks to be used during the fit.  <a href="#a7a47ff89ff45737db6fd90055305af0c">More...</a><br/></td></tr>
<tr class="separator:a7a47ff89ff45737db6fd90055305af0c"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a1234a68e20de47fcd42999626d6c07e4"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d6/dca/classtrkf_1_1TrackKalmanFitter.html#a1234a68e20de47fcd42999626d6c07e4">sortOutput</a> (std::vector&lt; <a class="el" href="../../da/d57/classtrkf_1_1HitState.html">HitState</a> &gt; &amp;hitstatev, std::vector&lt; <a class="el" href="../../d3/d02/classtrkf_1_1KFTrackState.html">KFTrackState</a> &gt; &amp;fwdUpdTkState, std::vector&lt; unsigned int &gt; &amp;hitstateidx, std::vector&lt; unsigned int &gt; &amp;rejectedhsidx, std::vector&lt; unsigned int &gt; &amp;sortedtksidx, std::vector&lt; <a class="el" href="../../d3/d86/classrecob_1_1TrajectoryPointFlags.html#a1fa59abb69bb752ec069798b2f3b8202">recob::TrajectoryPointFlags::Mask_t</a> &gt; &amp;hitflagsv, bool applySkipClean=<a class="el" href="../../de/d36/crtt0matchingalg__sbnd_8fcl.html#af8bc618309fb2d0f55f7f5ae0760b466">true</a>) const </td></tr>
<tr class="memdesc:a1234a68e20de47fcd42999626d6c07e4"><td class="mdescLeft">&#160;</td><td class="mdescRight">Sort the output states.  <a href="#a1234a68e20de47fcd42999626d6c07e4">More...</a><br/></td></tr>
<tr class="separator:a1234a68e20de47fcd42999626d6c07e4"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a84c42d9dadf9523f2261042da5bead99"><td class="memItemLeft" align="right" valign="top">bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d6/dca/classtrkf_1_1TrackKalmanFitter.html#a84c42d9dadf9523f2261042da5bead99">fillResult</a> (const std::vector&lt; art::Ptr&lt; <a class="el" href="../../db/d4e/classrecob_1_1Hit.html">recob::Hit</a> &gt;&gt; &amp;inHits, const int tkID, const int pdgid, std::vector&lt; <a class="el" href="../../da/d57/classtrkf_1_1HitState.html">HitState</a> &gt; &amp;hitstatev, std::vector&lt; <a class="el" href="../../d3/d86/classrecob_1_1TrajectoryPointFlags.html#a1fa59abb69bb752ec069798b2f3b8202">recob::TrajectoryPointFlags::Mask_t</a> &gt; &amp;hitflagsv, std::vector&lt; <a class="el" href="../../d3/d02/classtrkf_1_1KFTrackState.html">KFTrackState</a> &gt; &amp;fwdPrdTkState, std::vector&lt; <a class="el" href="../../d3/d02/classtrkf_1_1KFTrackState.html">KFTrackState</a> &gt; &amp;fwdUpdTkState, std::vector&lt; unsigned int &gt; &amp;hitstateidx, std::vector&lt; unsigned int &gt; &amp;rejectedhsidx, std::vector&lt; unsigned int &gt; &amp;sortedtksidx, <a class="el" href="../../d9/dca/classrecob_1_1Track.html">recob::Track</a> &amp;outTrack, std::vector&lt; art::Ptr&lt; <a class="el" href="../../db/d4e/classrecob_1_1Hit.html">recob::Hit</a> &gt;&gt; &amp;outHits, <a class="el" href="../../d0/d41/structtrkmkr_1_1OptionalOutputs.html">trkmkr::OptionalOutputs</a> &amp;optionals) const </td></tr>
<tr class="memdesc:a84c42d9dadf9523f2261042da5bead99"><td class="mdescLeft">&#160;</td><td class="mdescRight">Fill the output objects.  <a href="#a84c42d9dadf9523f2261042da5bead99">More...</a><br/></td></tr>
<tr class="separator:a84c42d9dadf9523f2261042da5bead99"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="pri-attribs"></a>
Private Attributes</h2></td></tr>
<tr class="memitem:a16bded3d3b4f7d0602c76a5b105af9f6"><td class="memItemLeft" align="right" valign="top">art::ServiceHandle<br class="typebreak"/>
&lt; <a class="el" href="../../d8/df3/classgeo_1_1Geometry.html">geo::Geometry</a> const  &gt;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d6/dca/classtrkf_1_1TrackKalmanFitter.html#a16bded3d3b4f7d0602c76a5b105af9f6">geom</a></td></tr>
<tr class="separator:a16bded3d3b4f7d0602c76a5b105af9f6"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a029821569a62274483456d270d7cd7e8"><td class="memItemLeft" align="right" valign="top">const <a class="el" href="../../dc/d5e/classtrkf_1_1TrackStatePropagator.html">TrackStatePropagator</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d6/dca/classtrkf_1_1TrackKalmanFitter.html#a029821569a62274483456d270d7cd7e8">propagator</a></td></tr>
<tr class="separator:a029821569a62274483456d270d7cd7e8"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a36f86ceceded941eb34ee8a1e762c40f"><td class="memItemLeft" align="right" valign="top">bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d6/dca/classtrkf_1_1TrackKalmanFitter.html#a36f86ceceded941eb34ee8a1e762c40f">useRMS_</a></td></tr>
<tr class="separator:a36f86ceceded941eb34ee8a1e762c40f"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a444bcfb6fd6cdf59ae68f7ee2c366368"><td class="memItemLeft" align="right" valign="top">bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d6/dca/classtrkf_1_1TrackKalmanFitter.html#a444bcfb6fd6cdf59ae68f7ee2c366368">sortHitsByPlane_</a></td></tr>
<tr class="separator:a444bcfb6fd6cdf59ae68f7ee2c366368"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aa38e65d72933ec4e4ff502510d9b3c12"><td class="memItemLeft" align="right" valign="top">bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d6/dca/classtrkf_1_1TrackKalmanFitter.html#aa38e65d72933ec4e4ff502510d9b3c12">sortHitsByWire_</a></td></tr>
<tr class="separator:aa38e65d72933ec4e4ff502510d9b3c12"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a48c558422473744a041b99ee95c59d95"><td class="memItemLeft" align="right" valign="top">bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d6/dca/classtrkf_1_1TrackKalmanFitter.html#a48c558422473744a041b99ee95c59d95">sortOutputHitsMinLength_</a></td></tr>
<tr class="separator:a48c558422473744a041b99ee95c59d95"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a439ce5d209c8590832ce4c5612dbf7b7"><td class="memItemLeft" align="right" valign="top">bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d6/dca/classtrkf_1_1TrackKalmanFitter.html#a439ce5d209c8590832ce4c5612dbf7b7">skipNegProp_</a></td></tr>
<tr class="separator:a439ce5d209c8590832ce4c5612dbf7b7"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ae0c319b72c3d58667842962a195a7752"><td class="memItemLeft" align="right" valign="top">bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d6/dca/classtrkf_1_1TrackKalmanFitter.html#ae0c319b72c3d58667842962a195a7752">cleanZigzag_</a></td></tr>
<tr class="separator:ae0c319b72c3d58667842962a195a7752"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aee1a59befcc52425c5f57815310eb096"><td class="memItemLeft" align="right" valign="top">bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d6/dca/classtrkf_1_1TrackKalmanFitter.html#aee1a59befcc52425c5f57815310eb096">rejectHighMultHits_</a></td></tr>
<tr class="separator:aee1a59befcc52425c5f57815310eb096"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a072e8273342653ea9a4150d1b60939b7"><td class="memItemLeft" align="right" valign="top">bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d6/dca/classtrkf_1_1TrackKalmanFitter.html#a072e8273342653ea9a4150d1b60939b7">rejectHitsNegativeGOF_</a></td></tr>
<tr class="separator:a072e8273342653ea9a4150d1b60939b7"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a14e5957cb48a5d5b764883a16e38d960"><td class="memItemLeft" align="right" valign="top">float&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d6/dca/classtrkf_1_1TrackKalmanFitter.html#a14e5957cb48a5d5b764883a16e38d960">hitErr2ScaleFact_</a></td></tr>
<tr class="separator:a14e5957cb48a5d5b764883a16e38d960"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a27d510c7be11bd82373d8ab30ac8e6d9"><td class="memItemLeft" align="right" valign="top">bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d6/dca/classtrkf_1_1TrackKalmanFitter.html#a27d510c7be11bd82373d8ab30ac8e6d9">tryNoSkipWhenFails_</a></td></tr>
<tr class="separator:a27d510c7be11bd82373d8ab30ac8e6d9"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a2f527686a3b82eaab63104dbb3e870b2"><td class="memItemLeft" align="right" valign="top">bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d6/dca/classtrkf_1_1TrackKalmanFitter.html#a2f527686a3b82eaab63104dbb3e870b2">tryBothDirs_</a></td></tr>
<tr class="separator:a2f527686a3b82eaab63104dbb3e870b2"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ae5732efc6840b8ee63c1da7cae12dc92"><td class="memItemLeft" align="right" valign="top">bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d6/dca/classtrkf_1_1TrackKalmanFitter.html#ae5732efc6840b8ee63c1da7cae12dc92">pickBestHitOnWire_</a></td></tr>
<tr class="separator:ae5732efc6840b8ee63c1da7cae12dc92"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ad91dc22bc6789376670625e65803e70a"><td class="memItemLeft" align="right" valign="top">float&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d6/dca/classtrkf_1_1TrackKalmanFitter.html#ad91dc22bc6789376670625e65803e70a">maxResidue_</a></td></tr>
<tr class="separator:ad91dc22bc6789376670625e65803e70a"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a796c8a2d3ee31f64c073dca95a009964"><td class="memItemLeft" align="right" valign="top">float&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d6/dca/classtrkf_1_1TrackKalmanFitter.html#a796c8a2d3ee31f64c073dca95a009964">maxResidueFirstHit_</a></td></tr>
<tr class="separator:a796c8a2d3ee31f64c073dca95a009964"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a32e405aa0e9672abe0f28d28d3af8777"><td class="memItemLeft" align="right" valign="top">float&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d6/dca/classtrkf_1_1TrackKalmanFitter.html#a32e405aa0e9672abe0f28d28d3af8777">maxChi2_</a></td></tr>
<tr class="separator:a32e405aa0e9672abe0f28d28d3af8777"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a3637c0f4a1ead3c751c0a4cc687facdc"><td class="memItemLeft" align="right" valign="top">float&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d6/dca/classtrkf_1_1TrackKalmanFitter.html#a3637c0f4a1ead3c751c0a4cc687facdc">maxDist_</a></td></tr>
<tr class="separator:a3637c0f4a1ead3c751c0a4cc687facdc"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a2efa447160c8b4b0cb5fddc93cd05352"><td class="memItemLeft" align="right" valign="top">float&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d6/dca/classtrkf_1_1TrackKalmanFitter.html#a2efa447160c8b4b0cb5fddc93cd05352">negDistTolerance_</a></td></tr>
<tr class="separator:a2efa447160c8b4b0cb5fddc93cd05352"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:acbd8f32e18621b3cc8387fc6f01fb190"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d6/dca/classtrkf_1_1TrackKalmanFitter.html#acbd8f32e18621b3cc8387fc6f01fb190">dumpLevel_</a></td></tr>
<tr class="separator:acbd8f32e18621b3cc8387fc6f01fb190"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><p>Fit tracks using Kalman Filter fit+smooth. </p>
<p>This algorithm fits tracks using a Kalman Filter forward fit followed by a backward smoothing. The resulting track will feature covariance matrices at start and end positions. Fundamental components of the fit are <a class="el" href="../../d3/d02/classtrkf_1_1KFTrackState.html" title="Extension of a TrackState to perform KalmanFilter calculations. ">trkf::KFTrackState</a> and <a class="el" href="../../dc/d5e/classtrkf_1_1TrackStatePropagator.html" title="Class for propagation of a trkf::TrackState to a recob::tracking::Plane. ">trkf::TrackStatePropagator</a>.</p>
<p>Inputs are: <a class="el" href="../../de/de5/classrecob_1_1TrackTrajectory.html" title="A trajectory in space reconstructed from hits. ">recob::TrackTrajectory</a>, initial covariance, associated hits, momentum estimate, particle id hypothesis. Alternatively, instead of a TrackTrajectory the fit can be input with initial position and direction, and vector of <a class="el" href="../../d3/d86/classrecob_1_1TrajectoryPointFlags.html" title="Set of flags pertaining a point of the track. ">recob::TrajectoryPointFlags</a>.</p>
<p>Outputs are: resulting <a class="el" href="../../d9/dca/classrecob_1_1Track.html" title="Track from a non-cascading particle.A recob::Track consists of a recob::TrackTrajectory, plus additional members relevant for a &quot;fitted&quot; track: ">recob::Track</a>, associated hits, and <a class="el" href="../../d0/d41/structtrkmkr_1_1OptionalOutputs.html" title="Struct holding optional TrackMaker outputs. ">trkmkr::OptionalOutputs</a>.</p>
<p>For configuration options see <a class="el" href="../../db/d30/structtrkf_1_1TrackKalmanFitter_1_1Config.html">TrackKalmanFitter::Config</a></p>
<dl class="section author"><dt>Author</dt><dd>G. Cerati (FNAL, MicroBooNE) </dd></dl>
<dl class="section date"><dt>Date</dt><dd>2017 </dd></dl>
<dl class="section version"><dt>Version</dt><dd>1.0 </dd></dl>

<p>Definition at line <a class="el" href="../../d7/dcf/TrackKalmanFitter_8h_source.html#l00056">56</a> of file <a class="el" href="../../d7/dcf/TrackKalmanFitter_8h_source.html">TrackKalmanFitter.h</a>.</p>
</div><h2 class="groupheader">Member Typedef Documentation</h2>
<a class="anchor" id="a7e26f365240b0750d703bf4edafcc898"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">using <a class="el" href="../../d6/dca/classtrkf_1_1TrackKalmanFitter.html#a7e26f365240b0750d703bf4edafcc898">trkf::TrackKalmanFitter::Parameters</a> =  fhicl::Table&lt;<a class="el" href="../../db/d30/structtrkf_1_1TrackKalmanFitter_1_1Config.html">Config</a>&gt;</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="../../d7/dcf/TrackKalmanFitter_8h_source.html#l00151">151</a> of file <a class="el" href="../../d7/dcf/TrackKalmanFitter_8h_source.html">TrackKalmanFitter.h</a>.</p>

</div>
</div>
<h2 class="groupheader">Constructor &amp; Destructor Documentation</h2>
<a class="anchor" id="a6bd62511762eaeb7817cfa5cd3e1e8ef"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">trkf::TrackKalmanFitter::TrackKalmanFitter </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="../../dc/d5e/classtrkf_1_1TrackStatePropagator.html">TrackStatePropagator</a> *&#160;</td>
          <td class="paramname"><em>prop</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">bool&#160;</td>
          <td class="paramname"><em>useRMS</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">bool&#160;</td>
          <td class="paramname"><em>sortHitsByPlane</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">bool&#160;</td>
          <td class="paramname"><em>sortHitsByWire</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">bool&#160;</td>
          <td class="paramname"><em>sortOutputHitsMinLength</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">bool&#160;</td>
          <td class="paramname"><em>skipNegProp</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">bool&#160;</td>
          <td class="paramname"><em>cleanZigzag</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">bool&#160;</td>
          <td class="paramname"><em>rejectHighMultHits</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">bool&#160;</td>
          <td class="paramname"><em>rejectHitsNegativeGOF</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">float&#160;</td>
          <td class="paramname"><em>hitErr2ScaleFact</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">bool&#160;</td>
          <td class="paramname"><em>tryNoSkipWhenFails</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">bool&#160;</td>
          <td class="paramname"><em>tryBothDirs</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">bool&#160;</td>
          <td class="paramname"><em>pickBestHitOnWire</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">float&#160;</td>
          <td class="paramname"><em>maxResidue</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">float&#160;</td>
          <td class="paramname"><em>maxResidueFirstHit</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">float&#160;</td>
          <td class="paramname"><em>maxChi2</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">float&#160;</td>
          <td class="paramname"><em>maxDist</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">float&#160;</td>
          <td class="paramname"><em>negDistTolerance</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>dumpLevel</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Constructor from <a class="el" href="../../dc/d5e/classtrkf_1_1TrackStatePropagator.html" title="Class for propagation of a trkf::TrackState to a recob::tracking::Plane. ">TrackStatePropagator</a> and values of configuration parameters. </p>

<p>Definition at line <a class="el" href="../../d7/dcf/TrackKalmanFitter_8h_source.html#l00154">154</a> of file <a class="el" href="../../d7/dcf/TrackKalmanFitter_8h_source.html">TrackKalmanFitter.h</a>.</p>
<div class="fragment"><div class="line"><a name="l00173"></a><span class="lineno">  173</span>&#160;    {</div>
<div class="line"><a name="l00174"></a><span class="lineno">  174</span>&#160;      <a class="code" href="../../d6/dca/classtrkf_1_1TrackKalmanFitter.html#a029821569a62274483456d270d7cd7e8">propagator</a> = prop;</div>
<div class="line"><a name="l00175"></a><span class="lineno">  175</span>&#160;      <a class="code" href="../../d6/dca/classtrkf_1_1TrackKalmanFitter.html#a36f86ceceded941eb34ee8a1e762c40f">useRMS_</a> = useRMS;</div>
<div class="line"><a name="l00176"></a><span class="lineno">  176</span>&#160;      <a class="code" href="../../d6/dca/classtrkf_1_1TrackKalmanFitter.html#a444bcfb6fd6cdf59ae68f7ee2c366368">sortHitsByPlane_</a> = sortHitsByPlane;</div>
<div class="line"><a name="l00177"></a><span class="lineno">  177</span>&#160;      <a class="code" href="../../d6/dca/classtrkf_1_1TrackKalmanFitter.html#aa38e65d72933ec4e4ff502510d9b3c12">sortHitsByWire_</a> = <a class="code" href="../../de/d1b/namespacecluster.html#a7a59982ae019fd01c228cda0f6b6d7e3">sortHitsByWire</a>;</div>
<div class="line"><a name="l00178"></a><span class="lineno">  178</span>&#160;      <a class="code" href="../../d6/dca/classtrkf_1_1TrackKalmanFitter.html#a48c558422473744a041b99ee95c59d95">sortOutputHitsMinLength_</a> = sortOutputHitsMinLength;</div>
<div class="line"><a name="l00179"></a><span class="lineno">  179</span>&#160;      <a class="code" href="../../d6/dca/classtrkf_1_1TrackKalmanFitter.html#a439ce5d209c8590832ce4c5612dbf7b7">skipNegProp_</a> = skipNegProp;</div>
<div class="line"><a name="l00180"></a><span class="lineno">  180</span>&#160;      <a class="code" href="../../d6/dca/classtrkf_1_1TrackKalmanFitter.html#ae0c319b72c3d58667842962a195a7752">cleanZigzag_</a> = cleanZigzag;</div>
<div class="line"><a name="l00181"></a><span class="lineno">  181</span>&#160;      <a class="code" href="../../d6/dca/classtrkf_1_1TrackKalmanFitter.html#aee1a59befcc52425c5f57815310eb096">rejectHighMultHits_</a> = rejectHighMultHits;</div>
<div class="line"><a name="l00182"></a><span class="lineno">  182</span>&#160;      <a class="code" href="../../d6/dca/classtrkf_1_1TrackKalmanFitter.html#a072e8273342653ea9a4150d1b60939b7">rejectHitsNegativeGOF_</a> = rejectHitsNegativeGOF;</div>
<div class="line"><a name="l00183"></a><span class="lineno">  183</span>&#160;      <a class="code" href="../../d6/dca/classtrkf_1_1TrackKalmanFitter.html#a14e5957cb48a5d5b764883a16e38d960">hitErr2ScaleFact_</a> = hitErr2ScaleFact;</div>
<div class="line"><a name="l00184"></a><span class="lineno">  184</span>&#160;      <a class="code" href="../../d6/dca/classtrkf_1_1TrackKalmanFitter.html#a27d510c7be11bd82373d8ab30ac8e6d9">tryNoSkipWhenFails_</a> = tryNoSkipWhenFails;</div>
<div class="line"><a name="l00185"></a><span class="lineno">  185</span>&#160;      <a class="code" href="../../d6/dca/classtrkf_1_1TrackKalmanFitter.html#a2f527686a3b82eaab63104dbb3e870b2">tryBothDirs_</a> = tryBothDirs;</div>
<div class="line"><a name="l00186"></a><span class="lineno">  186</span>&#160;      <a class="code" href="../../d6/dca/classtrkf_1_1TrackKalmanFitter.html#ae5732efc6840b8ee63c1da7cae12dc92">pickBestHitOnWire_</a> = pickBestHitOnWire;</div>
<div class="line"><a name="l00187"></a><span class="lineno">  187</span>&#160;      <a class="code" href="../../d6/dca/classtrkf_1_1TrackKalmanFitter.html#ad91dc22bc6789376670625e65803e70a">maxResidue_</a> = (maxResidue &gt; 0 ? maxResidue : std::numeric_limits&lt;float&gt;::max());</div>
<div class="line"><a name="l00188"></a><span class="lineno">  188</span>&#160;      <a class="code" href="../../d6/dca/classtrkf_1_1TrackKalmanFitter.html#a796c8a2d3ee31f64c073dca95a009964">maxResidueFirstHit_</a> =</div>
<div class="line"><a name="l00189"></a><span class="lineno">  189</span>&#160;        (maxResidueFirstHit &gt; 0 ? maxResidueFirstHit : std::numeric_limits&lt;float&gt;::max());</div>
<div class="line"><a name="l00190"></a><span class="lineno">  190</span>&#160;      <a class="code" href="../../d6/dca/classtrkf_1_1TrackKalmanFitter.html#a32e405aa0e9672abe0f28d28d3af8777">maxChi2_</a> = (maxChi2 &gt; 0 ? maxChi2 : std::numeric_limits&lt;float&gt;::max());</div>
<div class="line"><a name="l00191"></a><span class="lineno">  191</span>&#160;      <a class="code" href="../../d6/dca/classtrkf_1_1TrackKalmanFitter.html#a3637c0f4a1ead3c751c0a4cc687facdc">maxDist_</a> = (maxDist &gt; 0 ? maxDist : std::numeric_limits&lt;float&gt;::max());</div>
<div class="line"><a name="l00192"></a><span class="lineno">  192</span>&#160;      <a class="code" href="../../d6/dca/classtrkf_1_1TrackKalmanFitter.html#a2efa447160c8b4b0cb5fddc93cd05352">negDistTolerance_</a> = negDistTolerance;</div>
<div class="line"><a name="l00193"></a><span class="lineno">  193</span>&#160;      <a class="code" href="../../d6/dca/classtrkf_1_1TrackKalmanFitter.html#acbd8f32e18621b3cc8387fc6f01fb190">dumpLevel_</a> = dumpLevel;</div>
<div class="line"><a name="l00194"></a><span class="lineno">  194</span>&#160;    }</div>
<div class="ttc" id="classtrkf_1_1TrackKalmanFitter_html_a14e5957cb48a5d5b764883a16e38d960"><div class="ttname"><a href="../../d6/dca/classtrkf_1_1TrackKalmanFitter.html#a14e5957cb48a5d5b764883a16e38d960">trkf::TrackKalmanFitter::hitErr2ScaleFact_</a></div><div class="ttdeci">float hitErr2ScaleFact_</div><div class="ttdef"><b>Definition:</b> <a href="../../d7/dcf/TrackKalmanFitter_8h_source.html#l00309">TrackKalmanFitter.h:309</a></div></div>
<div class="ttc" id="classtrkf_1_1TrackKalmanFitter_html_ae0c319b72c3d58667842962a195a7752"><div class="ttname"><a href="../../d6/dca/classtrkf_1_1TrackKalmanFitter.html#ae0c319b72c3d58667842962a195a7752">trkf::TrackKalmanFitter::cleanZigzag_</a></div><div class="ttdeci">bool cleanZigzag_</div><div class="ttdef"><b>Definition:</b> <a href="../../d7/dcf/TrackKalmanFitter_8h_source.html#l00306">TrackKalmanFitter.h:306</a></div></div>
<div class="ttc" id="classtrkf_1_1TrackKalmanFitter_html_ae5732efc6840b8ee63c1da7cae12dc92"><div class="ttname"><a href="../../d6/dca/classtrkf_1_1TrackKalmanFitter.html#ae5732efc6840b8ee63c1da7cae12dc92">trkf::TrackKalmanFitter::pickBestHitOnWire_</a></div><div class="ttdeci">bool pickBestHitOnWire_</div><div class="ttdef"><b>Definition:</b> <a href="../../d7/dcf/TrackKalmanFitter_8h_source.html#l00312">TrackKalmanFitter.h:312</a></div></div>
<div class="ttc" id="classtrkf_1_1TrackKalmanFitter_html_a444bcfb6fd6cdf59ae68f7ee2c366368"><div class="ttname"><a href="../../d6/dca/classtrkf_1_1TrackKalmanFitter.html#a444bcfb6fd6cdf59ae68f7ee2c366368">trkf::TrackKalmanFitter::sortHitsByPlane_</a></div><div class="ttdeci">bool sortHitsByPlane_</div><div class="ttdef"><b>Definition:</b> <a href="../../d7/dcf/TrackKalmanFitter_8h_source.html#l00302">TrackKalmanFitter.h:302</a></div></div>
<div class="ttc" id="classtrkf_1_1TrackKalmanFitter_html_a32e405aa0e9672abe0f28d28d3af8777"><div class="ttname"><a href="../../d6/dca/classtrkf_1_1TrackKalmanFitter.html#a32e405aa0e9672abe0f28d28d3af8777">trkf::TrackKalmanFitter::maxChi2_</a></div><div class="ttdeci">float maxChi2_</div><div class="ttdef"><b>Definition:</b> <a href="../../d7/dcf/TrackKalmanFitter_8h_source.html#l00315">TrackKalmanFitter.h:315</a></div></div>
<div class="ttc" id="classtrkf_1_1TrackKalmanFitter_html_a3637c0f4a1ead3c751c0a4cc687facdc"><div class="ttname"><a href="../../d6/dca/classtrkf_1_1TrackKalmanFitter.html#a3637c0f4a1ead3c751c0a4cc687facdc">trkf::TrackKalmanFitter::maxDist_</a></div><div class="ttdeci">float maxDist_</div><div class="ttdef"><b>Definition:</b> <a href="../../d7/dcf/TrackKalmanFitter_8h_source.html#l00316">TrackKalmanFitter.h:316</a></div></div>
<div class="ttc" id="classtrkf_1_1TrackKalmanFitter_html_aa38e65d72933ec4e4ff502510d9b3c12"><div class="ttname"><a href="../../d6/dca/classtrkf_1_1TrackKalmanFitter.html#aa38e65d72933ec4e4ff502510d9b3c12">trkf::TrackKalmanFitter::sortHitsByWire_</a></div><div class="ttdeci">bool sortHitsByWire_</div><div class="ttdef"><b>Definition:</b> <a href="../../d7/dcf/TrackKalmanFitter_8h_source.html#l00303">TrackKalmanFitter.h:303</a></div></div>
<div class="ttc" id="classtrkf_1_1TrackKalmanFitter_html_a27d510c7be11bd82373d8ab30ac8e6d9"><div class="ttname"><a href="../../d6/dca/classtrkf_1_1TrackKalmanFitter.html#a27d510c7be11bd82373d8ab30ac8e6d9">trkf::TrackKalmanFitter::tryNoSkipWhenFails_</a></div><div class="ttdeci">bool tryNoSkipWhenFails_</div><div class="ttdef"><b>Definition:</b> <a href="../../d7/dcf/TrackKalmanFitter_8h_source.html#l00310">TrackKalmanFitter.h:310</a></div></div>
<div class="ttc" id="namespacecluster_html_a7a59982ae019fd01c228cda0f6b6d7e3"><div class="ttname"><a href="../../de/d1b/namespacecluster.html#a7a59982ae019fd01c228cda0f6b6d7e3">cluster::sortHitsByWire</a></div><div class="ttdeci">bool sortHitsByWire(art::Ptr&lt; recob::Hit &gt; a, art::Ptr&lt; recob::Hit &gt; b)</div><div class="ttdef"><b>Definition:</b> <a href="../../db/d58/ClusterCheater__module_8cc_source.html#l00072">ClusterCheater_module.cc:72</a></div></div>
<div class="ttc" id="classtrkf_1_1TrackKalmanFitter_html_acbd8f32e18621b3cc8387fc6f01fb190"><div class="ttname"><a href="../../d6/dca/classtrkf_1_1TrackKalmanFitter.html#acbd8f32e18621b3cc8387fc6f01fb190">trkf::TrackKalmanFitter::dumpLevel_</a></div><div class="ttdeci">int dumpLevel_</div><div class="ttdef"><b>Definition:</b> <a href="../../d7/dcf/TrackKalmanFitter_8h_source.html#l00318">TrackKalmanFitter.h:318</a></div></div>
<div class="ttc" id="classtrkf_1_1TrackKalmanFitter_html_ad91dc22bc6789376670625e65803e70a"><div class="ttname"><a href="../../d6/dca/classtrkf_1_1TrackKalmanFitter.html#ad91dc22bc6789376670625e65803e70a">trkf::TrackKalmanFitter::maxResidue_</a></div><div class="ttdeci">float maxResidue_</div><div class="ttdef"><b>Definition:</b> <a href="../../d7/dcf/TrackKalmanFitter_8h_source.html#l00313">TrackKalmanFitter.h:313</a></div></div>
<div class="ttc" id="classtrkf_1_1TrackKalmanFitter_html_a072e8273342653ea9a4150d1b60939b7"><div class="ttname"><a href="../../d6/dca/classtrkf_1_1TrackKalmanFitter.html#a072e8273342653ea9a4150d1b60939b7">trkf::TrackKalmanFitter::rejectHitsNegativeGOF_</a></div><div class="ttdeci">bool rejectHitsNegativeGOF_</div><div class="ttdef"><b>Definition:</b> <a href="../../d7/dcf/TrackKalmanFitter_8h_source.html#l00308">TrackKalmanFitter.h:308</a></div></div>
<div class="ttc" id="classtrkf_1_1TrackKalmanFitter_html_a2efa447160c8b4b0cb5fddc93cd05352"><div class="ttname"><a href="../../d6/dca/classtrkf_1_1TrackKalmanFitter.html#a2efa447160c8b4b0cb5fddc93cd05352">trkf::TrackKalmanFitter::negDistTolerance_</a></div><div class="ttdeci">float negDistTolerance_</div><div class="ttdef"><b>Definition:</b> <a href="../../d7/dcf/TrackKalmanFitter_8h_source.html#l00317">TrackKalmanFitter.h:317</a></div></div>
<div class="ttc" id="classtrkf_1_1TrackKalmanFitter_html_a36f86ceceded941eb34ee8a1e762c40f"><div class="ttname"><a href="../../d6/dca/classtrkf_1_1TrackKalmanFitter.html#a36f86ceceded941eb34ee8a1e762c40f">trkf::TrackKalmanFitter::useRMS_</a></div><div class="ttdeci">bool useRMS_</div><div class="ttdef"><b>Definition:</b> <a href="../../d7/dcf/TrackKalmanFitter_8h_source.html#l00301">TrackKalmanFitter.h:301</a></div></div>
<div class="ttc" id="classtrkf_1_1TrackKalmanFitter_html_a029821569a62274483456d270d7cd7e8"><div class="ttname"><a href="../../d6/dca/classtrkf_1_1TrackKalmanFitter.html#a029821569a62274483456d270d7cd7e8">trkf::TrackKalmanFitter::propagator</a></div><div class="ttdeci">const TrackStatePropagator * propagator</div><div class="ttdef"><b>Definition:</b> <a href="../../d7/dcf/TrackKalmanFitter_8h_source.html#l00300">TrackKalmanFitter.h:300</a></div></div>
<div class="ttc" id="classtrkf_1_1TrackKalmanFitter_html_aee1a59befcc52425c5f57815310eb096"><div class="ttname"><a href="../../d6/dca/classtrkf_1_1TrackKalmanFitter.html#aee1a59befcc52425c5f57815310eb096">trkf::TrackKalmanFitter::rejectHighMultHits_</a></div><div class="ttdeci">bool rejectHighMultHits_</div><div class="ttdef"><b>Definition:</b> <a href="../../d7/dcf/TrackKalmanFitter_8h_source.html#l00307">TrackKalmanFitter.h:307</a></div></div>
<div class="ttc" id="classtrkf_1_1TrackKalmanFitter_html_a796c8a2d3ee31f64c073dca95a009964"><div class="ttname"><a href="../../d6/dca/classtrkf_1_1TrackKalmanFitter.html#a796c8a2d3ee31f64c073dca95a009964">trkf::TrackKalmanFitter::maxResidueFirstHit_</a></div><div class="ttdeci">float maxResidueFirstHit_</div><div class="ttdef"><b>Definition:</b> <a href="../../d7/dcf/TrackKalmanFitter_8h_source.html#l00314">TrackKalmanFitter.h:314</a></div></div>
<div class="ttc" id="classtrkf_1_1TrackKalmanFitter_html_a2f527686a3b82eaab63104dbb3e870b2"><div class="ttname"><a href="../../d6/dca/classtrkf_1_1TrackKalmanFitter.html#a2f527686a3b82eaab63104dbb3e870b2">trkf::TrackKalmanFitter::tryBothDirs_</a></div><div class="ttdeci">bool tryBothDirs_</div><div class="ttdef"><b>Definition:</b> <a href="../../d7/dcf/TrackKalmanFitter_8h_source.html#l00311">TrackKalmanFitter.h:311</a></div></div>
<div class="ttc" id="classtrkf_1_1TrackKalmanFitter_html_a48c558422473744a041b99ee95c59d95"><div class="ttname"><a href="../../d6/dca/classtrkf_1_1TrackKalmanFitter.html#a48c558422473744a041b99ee95c59d95">trkf::TrackKalmanFitter::sortOutputHitsMinLength_</a></div><div class="ttdeci">bool sortOutputHitsMinLength_</div><div class="ttdef"><b>Definition:</b> <a href="../../d7/dcf/TrackKalmanFitter_8h_source.html#l00304">TrackKalmanFitter.h:304</a></div></div>
<div class="ttc" id="classtrkf_1_1TrackKalmanFitter_html_a439ce5d209c8590832ce4c5612dbf7b7"><div class="ttname"><a href="../../d6/dca/classtrkf_1_1TrackKalmanFitter.html#a439ce5d209c8590832ce4c5612dbf7b7">trkf::TrackKalmanFitter::skipNegProp_</a></div><div class="ttdeci">bool skipNegProp_</div><div class="ttdef"><b>Definition:</b> <a href="../../d7/dcf/TrackKalmanFitter_8h_source.html#l00305">TrackKalmanFitter.h:305</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="afbd2be32a4696b632aa2873547f8ef57"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">trkf::TrackKalmanFitter::TrackKalmanFitter </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="../../dc/d5e/classtrkf_1_1TrackStatePropagator.html">TrackStatePropagator</a> *&#160;</td>
          <td class="paramname"><em>prop</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="../../d6/dca/classtrkf_1_1TrackKalmanFitter.html#a7e26f365240b0750d703bf4edafcc898">Parameters</a> const &amp;&#160;</td>
          <td class="paramname"><em>p</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span><span class="mlabel">explicit</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Constructor from <a class="el" href="../../dc/d5e/classtrkf_1_1TrackStatePropagator.html" title="Class for propagation of a trkf::TrackState to a recob::tracking::Plane. ">TrackStatePropagator</a> and Parameters table. </p>

<p>Definition at line <a class="el" href="../../d7/dcf/TrackKalmanFitter_8h_source.html#l00197">197</a> of file <a class="el" href="../../d7/dcf/TrackKalmanFitter_8h_source.html">TrackKalmanFitter.h</a>.</p>
<div class="fragment"><div class="line"><a name="l00198"></a><span class="lineno">  198</span>&#160;      : <a class="code" href="../../d6/dca/classtrkf_1_1TrackKalmanFitter.html#a6bd62511762eaeb7817cfa5cd3e1e8ef">TrackKalmanFitter</a>(prop,</div>
<div class="line"><a name="l00199"></a><span class="lineno">  199</span>&#160;                          <a class="code" href="../../d9/dd2/selectors_8fcl.html#a24c8335057af14a9b508d5ac18999ce5">p</a>().useRMS(),</div>
<div class="line"><a name="l00200"></a><span class="lineno">  200</span>&#160;                          <a class="code" href="../../d9/dd2/selectors_8fcl.html#a24c8335057af14a9b508d5ac18999ce5">p</a>().sortHitsByPlane(),</div>
<div class="line"><a name="l00201"></a><span class="lineno">  201</span>&#160;                          <a class="code" href="../../d9/dd2/selectors_8fcl.html#a24c8335057af14a9b508d5ac18999ce5">p</a>().<a class="code" href="../../de/d1b/namespacecluster.html#a7a59982ae019fd01c228cda0f6b6d7e3">sortHitsByWire</a>(),</div>
<div class="line"><a name="l00202"></a><span class="lineno">  202</span>&#160;                          <a class="code" href="../../d9/dd2/selectors_8fcl.html#a24c8335057af14a9b508d5ac18999ce5">p</a>().sortOutputHitsMinLength(),</div>
<div class="line"><a name="l00203"></a><span class="lineno">  203</span>&#160;                          <a class="code" href="../../d9/dd2/selectors_8fcl.html#a24c8335057af14a9b508d5ac18999ce5">p</a>().skipNegProp(),</div>
<div class="line"><a name="l00204"></a><span class="lineno">  204</span>&#160;                          <a class="code" href="../../d9/dd2/selectors_8fcl.html#a24c8335057af14a9b508d5ac18999ce5">p</a>().cleanZigzag(),</div>
<div class="line"><a name="l00205"></a><span class="lineno">  205</span>&#160;                          <a class="code" href="../../d9/dd2/selectors_8fcl.html#a24c8335057af14a9b508d5ac18999ce5">p</a>().rejectHighMultHits(),</div>
<div class="line"><a name="l00206"></a><span class="lineno">  206</span>&#160;                          <a class="code" href="../../d9/dd2/selectors_8fcl.html#a24c8335057af14a9b508d5ac18999ce5">p</a>().rejectHitsNegativeGOF(),</div>
<div class="line"><a name="l00207"></a><span class="lineno">  207</span>&#160;                          <a class="code" href="../../d9/dd2/selectors_8fcl.html#a24c8335057af14a9b508d5ac18999ce5">p</a>().hitErr2ScaleFact(),</div>
<div class="line"><a name="l00208"></a><span class="lineno">  208</span>&#160;                          <a class="code" href="../../d9/dd2/selectors_8fcl.html#a24c8335057af14a9b508d5ac18999ce5">p</a>().tryNoSkipWhenFails(),</div>
<div class="line"><a name="l00209"></a><span class="lineno">  209</span>&#160;                          <a class="code" href="../../d9/dd2/selectors_8fcl.html#a24c8335057af14a9b508d5ac18999ce5">p</a>().tryBothDirs(),</div>
<div class="line"><a name="l00210"></a><span class="lineno">  210</span>&#160;                          <a class="code" href="../../d9/dd2/selectors_8fcl.html#a24c8335057af14a9b508d5ac18999ce5">p</a>().pickBestHitOnWire(),</div>
<div class="line"><a name="l00211"></a><span class="lineno">  211</span>&#160;                          <a class="code" href="../../d9/dd2/selectors_8fcl.html#a24c8335057af14a9b508d5ac18999ce5">p</a>().maxResidue(),</div>
<div class="line"><a name="l00212"></a><span class="lineno">  212</span>&#160;                          <a class="code" href="../../d9/dd2/selectors_8fcl.html#a24c8335057af14a9b508d5ac18999ce5">p</a>().maxResidueFirstHit(),</div>
<div class="line"><a name="l00213"></a><span class="lineno">  213</span>&#160;                          <a class="code" href="../../d9/dd2/selectors_8fcl.html#a24c8335057af14a9b508d5ac18999ce5">p</a>().maxChi2(),</div>
<div class="line"><a name="l00214"></a><span class="lineno">  214</span>&#160;                          <a class="code" href="../../d9/dd2/selectors_8fcl.html#a24c8335057af14a9b508d5ac18999ce5">p</a>().maxDist(),</div>
<div class="line"><a name="l00215"></a><span class="lineno">  215</span>&#160;                          <a class="code" href="../../d9/dd2/selectors_8fcl.html#a24c8335057af14a9b508d5ac18999ce5">p</a>().negDistTolerance(),</div>
<div class="line"><a name="l00216"></a><span class="lineno">  216</span>&#160;                          <a class="code" href="../../d9/dd2/selectors_8fcl.html#a24c8335057af14a9b508d5ac18999ce5">p</a>().dumpLevel())</div>
<div class="line"><a name="l00217"></a><span class="lineno">  217</span>&#160;    {}</div>
<div class="ttc" id="selectors_8fcl_html_a24c8335057af14a9b508d5ac18999ce5"><div class="ttname"><a href="../../d9/dd2/selectors_8fcl.html#a24c8335057af14a9b508d5ac18999ce5">p</a></div><div class="ttdeci">pdgs p</div><div class="ttdef"><b>Definition:</b> <a href="../../d9/dd2/selectors_8fcl_source.html#l00022">selectors.fcl:22</a></div></div>
<div class="ttc" id="classtrkf_1_1TrackKalmanFitter_html_a6bd62511762eaeb7817cfa5cd3e1e8ef"><div class="ttname"><a href="../../d6/dca/classtrkf_1_1TrackKalmanFitter.html#a6bd62511762eaeb7817cfa5cd3e1e8ef">trkf::TrackKalmanFitter::TrackKalmanFitter</a></div><div class="ttdeci">TrackKalmanFitter(const TrackStatePropagator *prop, bool useRMS, bool sortHitsByPlane, bool sortHitsByWire, bool sortOutputHitsMinLength, bool skipNegProp, bool cleanZigzag, bool rejectHighMultHits, bool rejectHitsNegativeGOF, float hitErr2ScaleFact, bool tryNoSkipWhenFails, bool tryBothDirs, bool pickBestHitOnWire, float maxResidue, float maxResidueFirstHit, float maxChi2, float maxDist, float negDistTolerance, int dumpLevel)</div><div class="ttdoc">Constructor from TrackStatePropagator and values of configuration parameters. </div><div class="ttdef"><b>Definition:</b> <a href="../../d7/dcf/TrackKalmanFitter_8h_source.html#l00154">TrackKalmanFitter.h:154</a></div></div>
<div class="ttc" id="namespacecluster_html_a7a59982ae019fd01c228cda0f6b6d7e3"><div class="ttname"><a href="../../de/d1b/namespacecluster.html#a7a59982ae019fd01c228cda0f6b6d7e3">cluster::sortHitsByWire</a></div><div class="ttdeci">bool sortHitsByWire(art::Ptr&lt; recob::Hit &gt; a, art::Ptr&lt; recob::Hit &gt; b)</div><div class="ttdef"><b>Definition:</b> <a href="../../db/d58/ClusterCheater__module_8cc_source.html#l00072">ClusterCheater_module.cc:72</a></div></div>
</div><!-- fragment -->
</div>
</div>
<h2 class="groupheader">Member Function Documentation</h2>
<a class="anchor" id="a4e8612ccdaee7e850a7330f6d955bb1d"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool trkf::TrackKalmanFitter::doFitWork </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="../../d3/d02/classtrkf_1_1KFTrackState.html">KFTrackState</a> &amp;&#160;</td>
          <td class="paramname"><em>trackState</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="../../d1/d11/classdetinfo_1_1DetectorPropertiesData.html">detinfo::DetectorPropertiesData</a> const &amp;&#160;</td>
          <td class="paramname"><em>detProp</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">std::vector&lt; <a class="el" href="../../da/d57/classtrkf_1_1HitState.html">HitState</a> &gt; &amp;&#160;</td>
          <td class="paramname"><em>hitstatev</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">std::vector&lt; <a class="el" href="../../d3/d86/classrecob_1_1TrajectoryPointFlags.html#a1fa59abb69bb752ec069798b2f3b8202">recob::TrajectoryPointFlags::Mask_t</a> &gt; &amp;&#160;</td>
          <td class="paramname"><em>hitflagsv</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">std::vector&lt; <a class="el" href="../../d3/d02/classtrkf_1_1KFTrackState.html">KFTrackState</a> &gt; &amp;&#160;</td>
          <td class="paramname"><em>fwdPrdTkState</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">std::vector&lt; <a class="el" href="../../d3/d02/classtrkf_1_1KFTrackState.html">KFTrackState</a> &gt; &amp;&#160;</td>
          <td class="paramname"><em>fwdUpdTkState</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">std::vector&lt; unsigned int &gt; &amp;&#160;</td>
          <td class="paramname"><em>hitstateidx</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">std::vector&lt; unsigned int &gt; &amp;&#160;</td>
          <td class="paramname"><em>rejectedhsidx</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">std::vector&lt; unsigned int &gt; &amp;&#160;</td>
          <td class="paramname"><em>sortedtksidx</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">bool&#160;</td>
          <td class="paramname"><em>applySkipClean</em> = <code><a class="el" href="../../de/d36/crtt0matchingalg__sbnd_8fcl.html#af8bc618309fb2d0f55f7f5ae0760b466">true</a></code>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td> const</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Function where the core of the fit is performed. </p>

<p>Definition at line <a class="el" href="../../de/d68/TrackKalmanFitter_8cxx_source.html#l00301">301</a> of file <a class="el" href="../../de/d68/TrackKalmanFitter_8cxx_source.html">TrackKalmanFitter.cxx</a>.</p>
<div class="fragment"><div class="line"><a name="l00311"></a><span class="lineno">  311</span>&#160;{</div>
<div class="line"><a name="l00312"></a><span class="lineno">  312</span>&#160;  fwdPrdTkState.clear();</div>
<div class="line"><a name="l00313"></a><span class="lineno">  313</span>&#160;  fwdUpdTkState.clear();</div>
<div class="line"><a name="l00314"></a><span class="lineno">  314</span>&#160;  hitstateidx.clear();</div>
<div class="line"><a name="l00315"></a><span class="lineno">  315</span>&#160;  rejectedhsidx.clear();</div>
<div class="line"><a name="l00316"></a><span class="lineno">  316</span>&#160;  sortedtksidx.clear();</div>
<div class="line"><a name="l00317"></a><span class="lineno">  317</span>&#160;  <span class="comment">// these three vectors are aligned</span></div>
<div class="line"><a name="l00318"></a><span class="lineno">  318</span>&#160;  fwdPrdTkState.reserve(hitstatev.size());</div>
<div class="line"><a name="l00319"></a><span class="lineno">  319</span>&#160;  fwdUpdTkState.reserve(hitstatev.size());</div>
<div class="line"><a name="l00320"></a><span class="lineno">  320</span>&#160;  hitstateidx.reserve(hitstatev.size());</div>
<div class="line"><a name="l00321"></a><span class="lineno">  321</span>&#160;</div>
<div class="line"><a name="l00322"></a><span class="lineno">  322</span>&#160;  <span class="comment">// keep a copy in case first propagation fails</span></div>
<div class="line"><a name="l00323"></a><span class="lineno">  323</span>&#160;  KFTrackState startState = trackState;</div>
<div class="line"><a name="l00324"></a><span class="lineno">  324</span>&#160;</div>
<div class="line"><a name="l00325"></a><span class="lineno">  325</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="../../d6/dca/classtrkf_1_1TrackKalmanFitter.html#a444bcfb6fd6cdf59ae68f7ee2c366368">sortHitsByPlane_</a>) {</div>
<div class="line"><a name="l00326"></a><span class="lineno">  326</span>&#160;    <span class="comment">//array of hit indices in planes, keeping the original sorting by plane</span></div>
<div class="line"><a name="l00327"></a><span class="lineno">  327</span>&#160;    <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> nplanes = <a class="code" href="../../d6/dca/classtrkf_1_1TrackKalmanFitter.html#a16bded3d3b4f7d0602c76a5b105af9f6">geom</a>-&gt;MaxPlanes();</div>
<div class="line"><a name="l00328"></a><span class="lineno">  328</span>&#160;    std::vector&lt;std::vector&lt;unsigned int&gt;&gt; hitsInPlanes(nplanes);</div>
<div class="line"><a name="l00329"></a><span class="lineno">  329</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> ihit = 0; ihit &lt; hitstatev.size(); ihit++) {</div>
<div class="line"><a name="l00330"></a><span class="lineno">  330</span>&#160;      hitsInPlanes[hitstatev[ihit].wireId().Plane].push_back(ihit);</div>
<div class="line"><a name="l00331"></a><span class="lineno">  331</span>&#160;    }</div>
<div class="line"><a name="l00332"></a><span class="lineno">  332</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="../../d6/dca/classtrkf_1_1TrackKalmanFitter.html#aa38e65d72933ec4e4ff502510d9b3c12">sortHitsByWire_</a>) {</div>
<div class="line"><a name="l00333"></a><span class="lineno">  333</span>&#160;      <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> iplane = 0; iplane &lt; nplanes; ++iplane) {</div>
<div class="line"><a name="l00334"></a><span class="lineno">  334</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="../../d6/dca/classtrkf_1_1TrackKalmanFitter.html#a16bded3d3b4f7d0602c76a5b105af9f6">geom</a>-&gt;Plane(iplane).GetIncreasingWireDirection&lt;<a class="code" href="../../db/dfa/PMAlgTracking_8cxx.html#aba288dcf8037152d32ec29330d952878">Vector_t</a>&gt;().Dot(trackState.momentum()) &gt;</div>
<div class="line"><a name="l00335"></a><span class="lineno">  335</span>&#160;            0) {</div>
<div class="line"><a name="l00336"></a><span class="lineno">  336</span>&#160;          std::sort(hitsInPlanes[iplane].<a class="code" href="../../d5/d62/namespaceicarus_1_1ns_1_1util.html#acc1957472e01a8d9ecd245e26338f0b9">begin</a>(),</div>
<div class="line"><a name="l00337"></a><span class="lineno">  337</span>&#160;                    hitsInPlanes[iplane].<a class="code" href="../../d5/d62/namespaceicarus_1_1ns_1_1util.html#aac918da84f16d53ad17bab4f817da1c4">end</a>(),</div>
<div class="line"><a name="l00338"></a><span class="lineno">  338</span>&#160;                    [hitstatev](<span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span>&amp; <a class="code" href="../../d0/d8f/decode__signalprocess__icarus_8fcl.html#a2a105cb669129f9c63eb7a4c15bf2d9b">a</a>, <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span>&amp; b) -&gt; <span class="keywordtype">bool</span> {</div>
<div class="line"><a name="l00339"></a><span class="lineno">  339</span>&#160;                      <span class="keywordflow">return</span> hitstatev[<a class="code" href="../../d0/d8f/decode__signalprocess__icarus_8fcl.html#a2a105cb669129f9c63eb7a4c15bf2d9b">a</a>].wireId().Wire &lt; hitstatev[b].wireId().Wire;</div>
<div class="line"><a name="l00340"></a><span class="lineno">  340</span>&#160;                    });</div>
<div class="line"><a name="l00341"></a><span class="lineno">  341</span>&#160;        }</div>
<div class="line"><a name="l00342"></a><span class="lineno">  342</span>&#160;        <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00343"></a><span class="lineno">  343</span>&#160;          std::sort(hitsInPlanes[iplane].<a class="code" href="../../d5/d62/namespaceicarus_1_1ns_1_1util.html#acc1957472e01a8d9ecd245e26338f0b9">begin</a>(),</div>
<div class="line"><a name="l00344"></a><span class="lineno">  344</span>&#160;                    hitsInPlanes[iplane].<a class="code" href="../../d5/d62/namespaceicarus_1_1ns_1_1util.html#aac918da84f16d53ad17bab4f817da1c4">end</a>(),</div>
<div class="line"><a name="l00345"></a><span class="lineno">  345</span>&#160;                    [hitstatev](<span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span>&amp; a, <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span>&amp; b) -&gt; <span class="keywordtype">bool</span> {</div>
<div class="line"><a name="l00346"></a><span class="lineno">  346</span>&#160;                      <span class="keywordflow">return</span> hitstatev[<a class="code" href="../../d0/d8f/decode__signalprocess__icarus_8fcl.html#a2a105cb669129f9c63eb7a4c15bf2d9b">a</a>].wireId().Wire &gt; hitstatev[b].wireId().Wire;</div>
<div class="line"><a name="l00347"></a><span class="lineno">  347</span>&#160;                    });</div>
<div class="line"><a name="l00348"></a><span class="lineno">  348</span>&#160;        }</div>
<div class="line"><a name="l00349"></a><span class="lineno">  349</span>&#160;      }</div>
<div class="line"><a name="l00350"></a><span class="lineno">  350</span>&#160;    }</div>
<div class="line"><a name="l00351"></a><span class="lineno">  351</span>&#160;</div>
<div class="line"><a name="l00352"></a><span class="lineno">  352</span>&#160;    <span class="comment">//dump hits sorted in each plane</span></div>
<div class="line"><a name="l00353"></a><span class="lineno">  353</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="../../d6/dca/classtrkf_1_1TrackKalmanFitter.html#acbd8f32e18621b3cc8387fc6f01fb190">dumpLevel_</a> &gt; 1) {</div>
<div class="line"><a name="l00354"></a><span class="lineno">  354</span>&#160;      <span class="keywordtype">int</span> ch = 0;</div>
<div class="line"><a name="l00355"></a><span class="lineno">  355</span>&#160;      <span class="keywordflow">for</span> (<span class="keyword">auto</span> <a class="code" href="../../d9/dd2/selectors_8fcl.html#a24c8335057af14a9b508d5ac18999ce5">p</a> : hitsInPlanes) {</div>
<div class="line"><a name="l00356"></a><span class="lineno">  356</span>&#160;        <span class="keywordflow">for</span> (<span class="keyword">auto</span> <a class="code" href="../../dd/de2/getStatistics_8sh.html#a04d4c2131ccb24cc78386597e8a21c5b">h</a> : <a class="code" href="../../d9/dd2/selectors_8fcl.html#a24c8335057af14a9b508d5ac18999ce5">p</a>) {</div>
<div class="line"><a name="l00357"></a><span class="lineno">  357</span>&#160;          <a class="code" href="../../d8/df5/messageservice_8fcl.html#a6699b4dbd72f548e48d81c88697d35a6">std::cout</a> &lt;&lt; <span class="stringliteral">&quot;hit #/Plane/Wire/x/mask: &quot;</span> &lt;&lt; ch++ &lt;&lt; <span class="stringliteral">&quot; &quot;</span> &lt;&lt; hitstatev[<a class="code" href="../../dd/de2/getStatistics_8sh.html#a04d4c2131ccb24cc78386597e8a21c5b">h</a>].wireId().Plane</div>
<div class="line"><a name="l00358"></a><span class="lineno">  358</span>&#160;                    &lt;&lt; <span class="stringliteral">&quot; &quot;</span> &lt;&lt; hitstatev[<a class="code" href="../../dd/de2/getStatistics_8sh.html#a04d4c2131ccb24cc78386597e8a21c5b">h</a>].wireId().Wire &lt;&lt; <span class="stringliteral">&quot; &quot;</span> &lt;&lt; hitstatev[<a class="code" href="../../dd/de2/getStatistics_8sh.html#a04d4c2131ccb24cc78386597e8a21c5b">h</a>].hitMeas() &lt;&lt; <span class="stringliteral">&quot; &quot;</span></div>
<div class="line"><a name="l00359"></a><span class="lineno">  359</span>&#160;                    &lt;&lt; hitflagsv[<a class="code" href="../../dd/de2/getStatistics_8sh.html#a04d4c2131ccb24cc78386597e8a21c5b">h</a>] &lt;&lt; std::endl;</div>
<div class="line"><a name="l00360"></a><span class="lineno">  360</span>&#160;        }</div>
<div class="line"><a name="l00361"></a><span class="lineno">  361</span>&#160;      }</div>
<div class="line"><a name="l00362"></a><span class="lineno">  362</span>&#160;    }</div>
<div class="line"><a name="l00363"></a><span class="lineno">  363</span>&#160;</div>
<div class="line"><a name="l00364"></a><span class="lineno">  364</span>&#160;    <span class="comment">//array of indices, where iterHitsInPlanes[i] is the iterator over hitsInPlanes[i]</span></div>
<div class="line"><a name="l00365"></a><span class="lineno">  365</span>&#160;    std::vector&lt;unsigned int&gt; iterHitsInPlanes(nplanes, 0);</div>
<div class="line"><a name="l00366"></a><span class="lineno">  366</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> p = 0; p &lt; hitstatev.size(); ++<a class="code" href="../../d9/dd2/selectors_8fcl.html#a24c8335057af14a9b508d5ac18999ce5">p</a>) {</div>
<div class="line"><a name="l00367"></a><span class="lineno">  367</span>&#160;      <span class="keywordflow">if</span> (<a class="code" href="../../d6/dca/classtrkf_1_1TrackKalmanFitter.html#acbd8f32e18621b3cc8387fc6f01fb190">dumpLevel_</a> &gt; 1) <a class="code" href="../../d8/df5/messageservice_8fcl.html#a6699b4dbd72f548e48d81c88697d35a6">std::cout</a> &lt;&lt; std::endl &lt;&lt; <span class="stringliteral">&quot;processing hit #&quot;</span> &lt;&lt; p &lt;&lt; std::endl;</div>
<div class="line"><a name="l00368"></a><span class="lineno">  368</span>&#160;      <span class="keywordflow">if</span> (<a class="code" href="../../d6/dca/classtrkf_1_1TrackKalmanFitter.html#acbd8f32e18621b3cc8387fc6f01fb190">dumpLevel_</a> &gt; 1)</div>
<div class="line"><a name="l00369"></a><span class="lineno">  369</span>&#160;        <a class="code" href="../../d8/df5/messageservice_8fcl.html#a6699b4dbd72f548e48d81c88697d35a6">std::cout</a> &lt;&lt; <span class="stringliteral">&quot;hit sizes: rej=&quot;</span> &lt;&lt; rejectedhsidx.size() &lt;&lt; <span class="stringliteral">&quot; good=&quot;</span> &lt;&lt; hitstateidx.size()</div>
<div class="line"><a name="l00370"></a><span class="lineno">  370</span>&#160;                  &lt;&lt; <span class="stringliteral">&quot; input=&quot;</span> &lt;&lt; hitstatev.size() &lt;&lt; std::endl;</div>
<div class="line"><a name="l00371"></a><span class="lineno">  371</span>&#160;      <span class="keywordflow">if</span> (<a class="code" href="../../d6/dca/classtrkf_1_1TrackKalmanFitter.html#acbd8f32e18621b3cc8387fc6f01fb190">dumpLevel_</a> &gt; 1) {</div>
<div class="line"><a name="l00372"></a><span class="lineno">  372</span>&#160;        <a class="code" href="../../d8/df5/messageservice_8fcl.html#a6699b4dbd72f548e48d81c88697d35a6">std::cout</a> &lt;&lt; <span class="stringliteral">&quot;compute distance from state=&quot;</span> &lt;&lt; std::endl;</div>
<div class="line"><a name="l00373"></a><span class="lineno">  373</span>&#160;        trackState.dump();</div>
<div class="line"><a name="l00374"></a><span class="lineno">  374</span>&#160;      }</div>
<div class="line"><a name="l00375"></a><span class="lineno">  375</span>&#160;      <span class="keywordtype">int</span> min_plane = -1;</div>
<div class="line"><a name="l00376"></a><span class="lineno">  376</span>&#160;      <span class="keywordtype">double</span> min_dist = DBL_MAX;</div>
<div class="line"><a name="l00377"></a><span class="lineno">  377</span>&#160;      <span class="comment">//find the closest hit according to the sorting in each plane</span></div>
<div class="line"><a name="l00378"></a><span class="lineno">  378</span>&#160;      <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> iplane = 0; iplane &lt; nplanes; ++iplane) {</div>
<div class="line"><a name="l00379"></a><span class="lineno">  379</span>&#160;        <span class="comment">//note: ih is a reference, so when &#39;continue&#39; we increment iterHitsInPlanes[iplane] and the hit is effectively rejected</span></div>
<div class="line"><a name="l00380"></a><span class="lineno">  380</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="../../d6/dca/classtrkf_1_1TrackKalmanFitter.html#acbd8f32e18621b3cc8387fc6f01fb190">dumpLevel_</a> &gt; 1)</div>
<div class="line"><a name="l00381"></a><span class="lineno">  381</span>&#160;          <a class="code" href="../../d8/df5/messageservice_8fcl.html#a6699b4dbd72f548e48d81c88697d35a6">std::cout</a> &lt;&lt; <span class="stringliteral">&quot;iplane=&quot;</span> &lt;&lt; iplane &lt;&lt; <span class="stringliteral">&quot; nplanes=&quot;</span> &lt;&lt; nplanes</div>
<div class="line"><a name="l00382"></a><span class="lineno">  382</span>&#160;                    &lt;&lt; <span class="stringliteral">&quot; iterHitsInPlanes[iplane]=&quot;</span> &lt;&lt; iterHitsInPlanes[iplane]</div>
<div class="line"><a name="l00383"></a><span class="lineno">  383</span>&#160;                    &lt;&lt; <span class="stringliteral">&quot; hitsInPlanes[iplane].size()=&quot;</span> &lt;&lt; hitsInPlanes[iplane].size() &lt;&lt; std::endl;</div>
<div class="line"><a name="l00384"></a><span class="lineno">  384</span>&#160;        <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span>&amp; ih = iterHitsInPlanes[iplane]; ih &lt; hitsInPlanes[iplane].size(); ++ih) {</div>
<div class="line"><a name="l00385"></a><span class="lineno">  385</span>&#160;          <span class="comment">//</span></div>
<div class="line"><a name="l00386"></a><span class="lineno">  386</span>&#160;          <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> ihit = hitsInPlanes[iplane][ih];</div>
<div class="line"><a name="l00387"></a><span class="lineno">  387</span>&#160;          <span class="keywordflow">if</span> (<a class="code" href="../../d6/dca/classtrkf_1_1TrackKalmanFitter.html#acbd8f32e18621b3cc8387fc6f01fb190">dumpLevel_</a> &gt; 1)</div>
<div class="line"><a name="l00388"></a><span class="lineno">  388</span>&#160;            <a class="code" href="../../d8/df5/messageservice_8fcl.html#a6699b4dbd72f548e48d81c88697d35a6">std::cout</a> &lt;&lt; <span class="stringliteral">&quot;ih=&quot;</span> &lt;&lt; ih &lt;&lt; <span class="stringliteral">&quot; ihit=&quot;</span> &lt;&lt; ihit &lt;&lt; <span class="stringliteral">&quot; size=&quot;</span> &lt;&lt; hitsInPlanes[iplane].size()</div>
<div class="line"><a name="l00389"></a><span class="lineno">  389</span>&#160;                      &lt;&lt; std::endl;</div>
<div class="line"><a name="l00390"></a><span class="lineno">  390</span>&#160;          <span class="keyword">const</span> <span class="keyword">auto</span>&amp; hitstate = hitstatev[ihit];</div>
<div class="line"><a name="l00391"></a><span class="lineno">  391</span>&#160;          <span class="keyword">const</span> <span class="keyword">auto</span>&amp; hitflags = hitflagsv[ihit];</div>
<div class="line"><a name="l00392"></a><span class="lineno">  392</span>&#160;          <span class="keywordflow">if</span> (hitflags.isSet(<a class="code" href="../../d4/dff/structrecob_1_1TrajectoryPointFlagTraits.html#a7a1b836f14bde0eb20ca4da2ead61a53">recob::TrajectoryPointFlagTraits::NoPoint</a>) ||</div>
<div class="line"><a name="l00393"></a><span class="lineno">  393</span>&#160;              hitflags.isSet(<a class="code" href="../../d4/dff/structrecob_1_1TrajectoryPointFlagTraits.html#a52e1b0d7701ede6b439780ccfe24dcf6">recob::TrajectoryPointFlagTraits::ExcludedFromFit</a>) ||</div>
<div class="line"><a name="l00394"></a><span class="lineno">  394</span>&#160;              hitflags.isSet(<a class="code" href="../../d4/dff/structrecob_1_1TrajectoryPointFlagTraits.html#a06470c4691580dc3c0414f78f737aaf8">recob::TrajectoryPointFlagTraits::Rejected</a>)) {</div>
<div class="line"><a name="l00395"></a><span class="lineno">  395</span>&#160;            <span class="keywordflow">if</span> (<a class="code" href="../../d6/dca/classtrkf_1_1TrackKalmanFitter.html#acbd8f32e18621b3cc8387fc6f01fb190">dumpLevel_</a> &gt; 1)</div>
<div class="line"><a name="l00396"></a><span class="lineno">  396</span>&#160;              <a class="code" href="../../d8/df5/messageservice_8fcl.html#a6699b4dbd72f548e48d81c88697d35a6">std::cout</a> &lt;&lt; <span class="stringliteral">&quot;rejecting hit flags=&quot;</span></div>
<div class="line"><a name="l00397"></a><span class="lineno">  397</span>&#160;                        &lt;&lt; hitflags.isSet(<a class="code" href="../../d4/dff/structrecob_1_1TrajectoryPointFlagTraits.html#a7a1b836f14bde0eb20ca4da2ead61a53">recob::TrajectoryPointFlagTraits::NoPoint</a>) &lt;&lt; <span class="stringliteral">&quot;, &quot;</span></div>
<div class="line"><a name="l00398"></a><span class="lineno">  398</span>&#160;                        &lt;&lt; hitflags.isSet(<a class="code" href="../../d4/dff/structrecob_1_1TrajectoryPointFlagTraits.html#a52e1b0d7701ede6b439780ccfe24dcf6">recob::TrajectoryPointFlagTraits::ExcludedFromFit</a>) &lt;&lt; <span class="stringliteral">&quot;, &quot;</span></div>
<div class="line"><a name="l00399"></a><span class="lineno">  399</span>&#160;                        &lt;&lt; hitflags.isSet(<a class="code" href="../../d4/dff/structrecob_1_1TrajectoryPointFlagTraits.html#a06470c4691580dc3c0414f78f737aaf8">recob::TrajectoryPointFlagTraits::Rejected</a>) &lt;&lt; <span class="stringliteral">&quot; &quot;</span></div>
<div class="line"><a name="l00400"></a><span class="lineno">  400</span>&#160;                        &lt;&lt; hitflags &lt;&lt; std::endl;</div>
<div class="line"><a name="l00401"></a><span class="lineno">  401</span>&#160;            rejectedhsidx.push_back(ihit);</div>
<div class="line"><a name="l00402"></a><span class="lineno">  402</span>&#160;            <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l00403"></a><span class="lineno">  403</span>&#160;          }</div>
<div class="line"><a name="l00404"></a><span class="lineno">  404</span>&#160;          <span class="comment">//get distance to measurement surface</span></div>
<div class="line"><a name="l00405"></a><span class="lineno">  405</span>&#160;          <span class="keywordtype">bool</span> success = <span class="keyword">true</span>;</div>
<div class="line"><a name="l00406"></a><span class="lineno">  406</span>&#160;          <span class="keyword">const</span> <span class="keywordtype">double</span> <a class="code" href="../../d7/d6f/namespacelarg4.html#a3b23adbb58bc71f7c54806914226f1f8">dist</a> =</div>
<div class="line"><a name="l00407"></a><span class="lineno">  407</span>&#160;            <a class="code" href="../../d6/dca/classtrkf_1_1TrackKalmanFitter.html#a029821569a62274483456d270d7cd7e8">propagator</a>-&gt;<a class="code" href="../../dc/d5e/classtrkf_1_1TrackStatePropagator.html#ab4f06dfff7579a24d5748096cb49bf06">distanceToPlane</a>(success, trackState.trackState(), hitstate.plane());</div>
<div class="line"><a name="l00408"></a><span class="lineno">  408</span>&#160;          <span class="keywordflow">if</span> (<a class="code" href="../../d6/dca/classtrkf_1_1TrackKalmanFitter.html#acbd8f32e18621b3cc8387fc6f01fb190">dumpLevel_</a> &gt; 1)</div>
<div class="line"><a name="l00409"></a><span class="lineno">  409</span>&#160;            <a class="code" href="../../d8/df5/messageservice_8fcl.html#a6699b4dbd72f548e48d81c88697d35a6">std::cout</a> &lt;&lt; <span class="stringliteral">&quot;distance to plane &quot;</span> &lt;&lt; iplane &lt;&lt; <span class="stringliteral">&quot; wire=&quot;</span> &lt;&lt; hitstate.wireId().Wire</div>
<div class="line"><a name="l00410"></a><span class="lineno">  410</span>&#160;                      &lt;&lt; <span class="stringliteral">&quot; = &quot;</span> &lt;&lt; dist &lt;&lt; <span class="stringliteral">&quot;, min_dist=&quot;</span> &lt;&lt; std::min(min_dist, 999.)</div>
<div class="line"><a name="l00411"></a><span class="lineno">  411</span>&#160;                      &lt;&lt; <span class="stringliteral">&quot; min_plane=&quot;</span> &lt;&lt; min_plane &lt;&lt; <span class="stringliteral">&quot; success=&quot;</span> &lt;&lt; success</div>
<div class="line"><a name="l00412"></a><span class="lineno">  412</span>&#160;                      &lt;&lt; <span class="stringliteral">&quot; wirepo=&quot;</span> &lt;&lt; hitstate.plane().position() &lt;&lt; std::endl;</div>
<div class="line"><a name="l00413"></a><span class="lineno">  413</span>&#160;          <span class="keywordflow">if</span> (!success) {</div>
<div class="line"><a name="l00414"></a><span class="lineno">  414</span>&#160;            rejectedhsidx.push_back(ihit);</div>
<div class="line"><a name="l00415"></a><span class="lineno">  415</span>&#160;            <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l00416"></a><span class="lineno">  416</span>&#160;          }</div>
<div class="line"><a name="l00417"></a><span class="lineno">  417</span>&#160;          <span class="keywordflow">if</span> (applySkipClean &amp;&amp; <a class="code" href="../../d6/dca/classtrkf_1_1TrackKalmanFitter.html#a439ce5d209c8590832ce4c5612dbf7b7">skipNegProp_</a> &amp;&amp; fwdUpdTkState.size() &gt; 0 &amp;&amp;</div>
<div class="line"><a name="l00418"></a><span class="lineno">  418</span>&#160;              dist &lt; <a class="code" href="../../d6/dca/classtrkf_1_1TrackKalmanFitter.html#a2efa447160c8b4b0cb5fddc93cd05352">negDistTolerance_</a>) {</div>
<div class="line"><a name="l00419"></a><span class="lineno">  419</span>&#160;            rejectedhsidx.push_back(ihit);</div>
<div class="line"><a name="l00420"></a><span class="lineno">  420</span>&#160;            <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l00421"></a><span class="lineno">  421</span>&#160;          }</div>
<div class="line"><a name="l00422"></a><span class="lineno">  422</span>&#160;          <span class="keywordflow">if</span> (dist &lt; min_dist) {</div>
<div class="line"><a name="l00423"></a><span class="lineno">  423</span>&#160;            min_plane = iplane;</div>
<div class="line"><a name="l00424"></a><span class="lineno">  424</span>&#160;            min_dist = <a class="code" href="../../d7/d6f/namespacelarg4.html#a3b23adbb58bc71f7c54806914226f1f8">dist</a>;</div>
<div class="line"><a name="l00425"></a><span class="lineno">  425</span>&#160;          }</div>
<div class="line"><a name="l00426"></a><span class="lineno">  426</span>&#160;          <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00427"></a><span class="lineno">  427</span>&#160;        }</div>
<div class="line"><a name="l00428"></a><span class="lineno">  428</span>&#160;      }</div>
<div class="line"><a name="l00429"></a><span class="lineno">  429</span>&#160;      <span class="keywordflow">if</span> (<a class="code" href="../../d6/dca/classtrkf_1_1TrackKalmanFitter.html#acbd8f32e18621b3cc8387fc6f01fb190">dumpLevel_</a> &gt; 1)</div>
<div class="line"><a name="l00430"></a><span class="lineno">  430</span>&#160;        <a class="code" href="../../d8/df5/messageservice_8fcl.html#a6699b4dbd72f548e48d81c88697d35a6">std::cout</a></div>
<div class="line"><a name="l00431"></a><span class="lineno">  431</span>&#160;          &lt;&lt; <span class="stringliteral">&quot;pick min_dist=&quot;</span> &lt;&lt; min_dist &lt;&lt; <span class="stringliteral">&quot; min_plane=&quot;</span> &lt;&lt; min_plane &lt;&lt; <span class="stringliteral">&quot; wire=&quot;</span></div>
<div class="line"><a name="l00432"></a><span class="lineno">  432</span>&#160;          &lt;&lt; (min_plane &lt; 0 ?</div>
<div class="line"><a name="l00433"></a><span class="lineno">  433</span>&#160;                -1 :</div>
<div class="line"><a name="l00434"></a><span class="lineno">  434</span>&#160;                hitstatev[hitsInPlanes[min_plane][iterHitsInPlanes[min_plane]]].wireId().Wire)</div>
<div class="line"><a name="l00435"></a><span class="lineno">  435</span>&#160;          &lt;&lt; std::endl;</div>
<div class="line"><a name="l00436"></a><span class="lineno">  436</span>&#160;      <span class="comment">//</span></div>
<div class="line"><a name="l00437"></a><span class="lineno">  437</span>&#160;      <span class="comment">//now we know which is the closest wire: get the hitstate and increment the iterator</span></div>
<div class="line"><a name="l00438"></a><span class="lineno">  438</span>&#160;      <span class="keywordflow">if</span> (min_plane &lt; 0) {</div>
<div class="line"><a name="l00439"></a><span class="lineno">  439</span>&#160;        <span class="keywordflow">if</span> (rejectedhsidx.size() + hitstateidx.size() == hitstatev.size())</div>
<div class="line"><a name="l00440"></a><span class="lineno">  440</span>&#160;          <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00441"></a><span class="lineno">  441</span>&#160;        <span class="keywordflow">else</span></div>
<div class="line"><a name="l00442"></a><span class="lineno">  442</span>&#160;          <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l00443"></a><span class="lineno">  443</span>&#160;      }</div>
<div class="line"><a name="l00444"></a><span class="lineno">  444</span>&#160;      <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> ihit = hitsInPlanes[min_plane][iterHitsInPlanes[min_plane]];</div>
<div class="line"><a name="l00445"></a><span class="lineno">  445</span>&#160;      <span class="keyword">const</span> <span class="keyword">auto</span>* hitstate = &amp;hitstatev[ihit];</div>
<div class="line"><a name="l00446"></a><span class="lineno">  446</span>&#160;      iterHitsInPlanes[min_plane]++;</div>
<div class="line"><a name="l00447"></a><span class="lineno">  447</span>&#160;      <span class="comment">//</span></div>
<div class="line"><a name="l00448"></a><span class="lineno">  448</span>&#160;      <span class="comment">//propagate to measurement surface</span></div>
<div class="line"><a name="l00449"></a><span class="lineno">  449</span>&#160;      <span class="keywordtype">bool</span> propok = <span class="keyword">true</span>;</div>
<div class="line"><a name="l00450"></a><span class="lineno">  450</span>&#160;      trackState = <a class="code" href="../../d6/dca/classtrkf_1_1TrackKalmanFitter.html#a029821569a62274483456d270d7cd7e8">propagator</a>-&gt;<a class="code" href="../../dc/d5e/classtrkf_1_1TrackStatePropagator.html#ae46e7c518db95bfca7418cd582682c95">propagateToPlane</a>(propok,</div>
<div class="line"><a name="l00451"></a><span class="lineno">  451</span>&#160;                                                <a class="code" href="../../d2/d1a/namespacedetsim.html#a560adbb3abf95a23d45a53ed25d8c0c7">detProp</a>,</div>
<div class="line"><a name="l00452"></a><span class="lineno">  452</span>&#160;                                                trackState.trackState(),</div>
<div class="line"><a name="l00453"></a><span class="lineno">  453</span>&#160;                                                hitstate-&gt;plane(),</div>
<div class="line"><a name="l00454"></a><span class="lineno">  454</span>&#160;                                                <span class="keyword">true</span>,</div>
<div class="line"><a name="l00455"></a><span class="lineno">  455</span>&#160;                                                <span class="keyword">true</span>,</div>
<div class="line"><a name="l00456"></a><span class="lineno">  456</span>&#160;                                                <a class="code" href="../../dc/d5e/classtrkf_1_1TrackStatePropagator.html#ae5eff788f74ea79d40466328fd943a1ba6351b029d52cf3f64d523db56d4a532a">TrackStatePropagator::FORWARD</a>);</div>
<div class="line"><a name="l00457"></a><span class="lineno">  457</span>&#160;      <span class="keywordflow">if</span> (!propok &amp;&amp; !(applySkipClean &amp;&amp; fwdUpdTkState.size() &gt; 0 &amp;&amp; <a class="code" href="../../d6/dca/classtrkf_1_1TrackKalmanFitter.html#a439ce5d209c8590832ce4c5612dbf7b7">skipNegProp_</a>)) {</div>
<div class="line"><a name="l00458"></a><span class="lineno">  458</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="../../d6/dca/classtrkf_1_1TrackKalmanFitter.html#acbd8f32e18621b3cc8387fc6f01fb190">dumpLevel_</a> &gt; 1) <a class="code" href="../../d8/df5/messageservice_8fcl.html#a6699b4dbd72f548e48d81c88697d35a6">std::cout</a> &lt;&lt; <span class="stringliteral">&quot;attempt backward prop&quot;</span> &lt;&lt; std::endl;</div>
<div class="line"><a name="l00459"></a><span class="lineno">  459</span>&#160;        trackState = <a class="code" href="../../d6/dca/classtrkf_1_1TrackKalmanFitter.html#a029821569a62274483456d270d7cd7e8">propagator</a>-&gt;<a class="code" href="../../dc/d5e/classtrkf_1_1TrackStatePropagator.html#ae46e7c518db95bfca7418cd582682c95">propagateToPlane</a>(propok,</div>
<div class="line"><a name="l00460"></a><span class="lineno">  460</span>&#160;                                                  <a class="code" href="../../d2/d1a/namespacedetsim.html#a560adbb3abf95a23d45a53ed25d8c0c7">detProp</a>,</div>
<div class="line"><a name="l00461"></a><span class="lineno">  461</span>&#160;                                                  trackState.trackState(),</div>
<div class="line"><a name="l00462"></a><span class="lineno">  462</span>&#160;                                                  hitstate-&gt;plane(),</div>
<div class="line"><a name="l00463"></a><span class="lineno">  463</span>&#160;                                                  <span class="keyword">true</span>,</div>
<div class="line"><a name="l00464"></a><span class="lineno">  464</span>&#160;                                                  <span class="keyword">true</span>,</div>
<div class="line"><a name="l00465"></a><span class="lineno">  465</span>&#160;                                                  <a class="code" href="../../dc/d5e/classtrkf_1_1TrackStatePropagator.html#ae5eff788f74ea79d40466328fd943a1ba815fdae095e62f7826692abe63e9e458">TrackStatePropagator::BACKWARD</a>);</div>
<div class="line"><a name="l00466"></a><span class="lineno">  466</span>&#160;      }</div>
<div class="line"><a name="l00467"></a><span class="lineno">  467</span>&#160;      <span class="keywordflow">if</span> (<a class="code" href="../../d6/dca/classtrkf_1_1TrackKalmanFitter.html#acbd8f32e18621b3cc8387fc6f01fb190">dumpLevel_</a> &gt; 1) {</div>
<div class="line"><a name="l00468"></a><span class="lineno">  468</span>&#160;        <a class="code" href="../../d8/df5/messageservice_8fcl.html#a6699b4dbd72f548e48d81c88697d35a6">std::cout</a> &lt;&lt; <span class="stringliteral">&quot;hit state &quot;</span> &lt;&lt; std::endl;</div>
<div class="line"><a name="l00469"></a><span class="lineno">  469</span>&#160;        hitstate-&gt;dump();</div>
<div class="line"><a name="l00470"></a><span class="lineno">  470</span>&#160;        <a class="code" href="../../d8/df5/messageservice_8fcl.html#a6699b4dbd72f548e48d81c88697d35a6">std::cout</a> &lt;&lt; <span class="stringliteral">&quot;propagation result=&quot;</span> &lt;&lt; propok &lt;&lt; std::endl;</div>
<div class="line"><a name="l00471"></a><span class="lineno">  471</span>&#160;        <a class="code" href="../../d8/df5/messageservice_8fcl.html#a6699b4dbd72f548e48d81c88697d35a6">std::cout</a> &lt;&lt; <span class="stringliteral">&quot;propagated state &quot;</span> &lt;&lt; std::endl;</div>
<div class="line"><a name="l00472"></a><span class="lineno">  472</span>&#160;        trackState.dump();</div>
<div class="line"><a name="l00473"></a><span class="lineno">  473</span>&#160;        <a class="code" href="../../d8/df5/messageservice_8fcl.html#a6699b4dbd72f548e48d81c88697d35a6">std::cout</a> &lt;&lt; <span class="stringliteral">&quot;propagated planarity=&quot;</span></div>
<div class="line"><a name="l00474"></a><span class="lineno">  474</span>&#160;                  &lt;&lt; hitstate-&gt;plane().direction().Dot(hitstate-&gt;plane().position() -</div>
<div class="line"><a name="l00475"></a><span class="lineno">  475</span>&#160;                                                       trackState.position())</div>
<div class="line"><a name="l00476"></a><span class="lineno">  476</span>&#160;                  &lt;&lt; std::endl;</div>
<div class="line"><a name="l00477"></a><span class="lineno">  477</span>&#160;        <a class="code" href="../../d8/df5/messageservice_8fcl.html#a6699b4dbd72f548e48d81c88697d35a6">std::cout</a> &lt;&lt; <span class="stringliteral">&quot;residual=&quot;</span> &lt;&lt; trackState.residual(*hitstate)</div>
<div class="line"><a name="l00478"></a><span class="lineno">  478</span>&#160;                  &lt;&lt; <span class="stringliteral">&quot; chi2=&quot;</span> &lt;&lt; trackState.chi2(*hitstate) &lt;&lt; std::endl;</div>
<div class="line"><a name="l00479"></a><span class="lineno">  479</span>&#160;      }</div>
<div class="line"><a name="l00480"></a><span class="lineno">  480</span>&#160;      <span class="keywordflow">if</span> (propok) {</div>
<div class="line"><a name="l00481"></a><span class="lineno">  481</span>&#160;</div>
<div class="line"><a name="l00482"></a><span class="lineno">  482</span>&#160;        <span class="comment">//reject the first hit if its residue is too large (due to e.g. spurious hit or bad hit sorting)</span></div>
<div class="line"><a name="l00483"></a><span class="lineno">  483</span>&#160;        <span class="keywordflow">if</span> (applySkipClean &amp;&amp; fwdUpdTkState.size() == 0 &amp;&amp;</div>
<div class="line"><a name="l00484"></a><span class="lineno">  484</span>&#160;            <a class="code" href="../../dd/d59/sparse__vector__test_8cc.html#a39f16bf854ba527dee7eba5bbbd93f3f">std::abs</a>(trackState.residual(*hitstate)) &gt; <a class="code" href="../../d6/dca/classtrkf_1_1TrackKalmanFitter.html#a796c8a2d3ee31f64c073dca95a009964">maxResidueFirstHit_</a>) {</div>
<div class="line"><a name="l00485"></a><span class="lineno">  485</span>&#160;          <span class="keywordflow">if</span> (<a class="code" href="../../d6/dca/classtrkf_1_1TrackKalmanFitter.html#acbd8f32e18621b3cc8387fc6f01fb190">dumpLevel_</a> &gt; 1)</div>
<div class="line"><a name="l00486"></a><span class="lineno">  486</span>&#160;            <a class="code" href="../../d8/df5/messageservice_8fcl.html#a6699b4dbd72f548e48d81c88697d35a6">std::cout</a> &lt;&lt; <span class="stringliteral">&quot;rejecting first hit with residual=&quot;</span> &lt;&lt; trackState.residual(*hitstate)</div>
<div class="line"><a name="l00487"></a><span class="lineno">  487</span>&#160;                      &lt;&lt; std::endl;</div>
<div class="line"><a name="l00488"></a><span class="lineno">  488</span>&#160;          rejectedhsidx.push_back(ihit);</div>
<div class="line"><a name="l00489"></a><span class="lineno">  489</span>&#160;          trackState = startState;</div>
<div class="line"><a name="l00490"></a><span class="lineno">  490</span>&#160;          <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l00491"></a><span class="lineno">  491</span>&#160;        }</div>
<div class="line"><a name="l00492"></a><span class="lineno">  492</span>&#160;</div>
<div class="line"><a name="l00493"></a><span class="lineno">  493</span>&#160;        <span class="comment">//if there is &gt;1 consecutive hit on the same wire, choose the one with best chi2 and exclude the others (should this be optional?)</span></div>
<div class="line"><a name="l00494"></a><span class="lineno">  494</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="../../d6/dca/classtrkf_1_1TrackKalmanFitter.html#ae5732efc6840b8ee63c1da7cae12dc92">pickBestHitOnWire_</a>) {</div>
<div class="line"><a name="l00495"></a><span class="lineno">  495</span>&#160;          <span class="keyword">auto</span> wire = hitstate-&gt;wireId().Wire;</div>
<div class="line"><a name="l00496"></a><span class="lineno">  496</span>&#160;          <span class="keywordtype">float</span> min_chi2_wire = trackState.chi2(*hitstate);</div>
<div class="line"><a name="l00497"></a><span class="lineno">  497</span>&#160;          <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> jh = iterHitsInPlanes[min_plane]; jh &lt; hitsInPlanes[min_plane].size();</div>
<div class="line"><a name="l00498"></a><span class="lineno">  498</span>&#160;               ++jh) {</div>
<div class="line"><a name="l00499"></a><span class="lineno">  499</span>&#160;            <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> jhit = hitsInPlanes[min_plane][jh];</div>
<div class="line"><a name="l00500"></a><span class="lineno">  500</span>&#160;            <span class="keyword">const</span> <span class="keyword">auto</span>&amp; jhitstate = hitstatev[jhit];</div>
<div class="line"><a name="l00501"></a><span class="lineno">  501</span>&#160;            <span class="keywordflow">if</span> (jhitstate.wireId().Wire != wire) <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00502"></a><span class="lineno">  502</span>&#160;            <span class="keywordflow">if</span> (ihit != jhit) iterHitsInPlanes[min_plane]++;</div>
<div class="line"><a name="l00503"></a><span class="lineno">  503</span>&#160;            <span class="keywordtype">float</span> chi2 = trackState.chi2(jhitstate);</div>
<div class="line"><a name="l00504"></a><span class="lineno">  504</span>&#160;            <span class="keywordflow">if</span> (<a class="code" href="../../d6/dca/classtrkf_1_1TrackKalmanFitter.html#acbd8f32e18621b3cc8387fc6f01fb190">dumpLevel_</a> &gt; 1 &amp;&amp; ihit != jhit)</div>
<div class="line"><a name="l00505"></a><span class="lineno">  505</span>&#160;              <a class="code" href="../../d8/df5/messageservice_8fcl.html#a6699b4dbd72f548e48d81c88697d35a6">std::cout</a> &lt;&lt; <span class="stringliteral">&quot;additional hit on the same wire with jhit=&quot;</span> &lt;&lt; jhit &lt;&lt; <span class="stringliteral">&quot; chi2=&quot;</span> &lt;&lt; chi2</div>
<div class="line"><a name="l00506"></a><span class="lineno">  506</span>&#160;                        &lt;&lt; <span class="stringliteral">&quot; ihit=&quot;</span> &lt;&lt; ihit &lt;&lt; <span class="stringliteral">&quot; min_chi2_wire=&quot;</span> &lt;&lt; min_chi2_wire &lt;&lt; std::endl;</div>
<div class="line"><a name="l00507"></a><span class="lineno">  507</span>&#160;            <span class="keywordflow">if</span> (chi2 &lt; min_chi2_wire) {</div>
<div class="line"><a name="l00508"></a><span class="lineno">  508</span>&#160;              min_chi2_wire = chi2;</div>
<div class="line"><a name="l00509"></a><span class="lineno">  509</span>&#160;              <span class="keywordflow">if</span> (<a class="code" href="../../d6/dca/classtrkf_1_1TrackKalmanFitter.html#acbd8f32e18621b3cc8387fc6f01fb190">dumpLevel_</a> &gt; 1 &amp;&amp; ihit != jhit) {</div>
<div class="line"><a name="l00510"></a><span class="lineno">  510</span>&#160;                <a class="code" href="../../d8/df5/messageservice_8fcl.html#a6699b4dbd72f548e48d81c88697d35a6">std::cout</a> &lt;&lt; <span class="stringliteral">&quot;\tnow using &quot;</span>;</div>
<div class="line"><a name="l00511"></a><span class="lineno">  511</span>&#160;                jhitstate.dump();</div>
<div class="line"><a name="l00512"></a><span class="lineno">  512</span>&#160;              }</div>
<div class="line"><a name="l00513"></a><span class="lineno">  513</span>&#160;              <span class="keywordflow">if</span> (ihit != jhit) rejectedhsidx.push_back(ihit);</div>
<div class="line"><a name="l00514"></a><span class="lineno">  514</span>&#160;              ihit = jhit;</div>
<div class="line"><a name="l00515"></a><span class="lineno">  515</span>&#160;            }</div>
<div class="line"><a name="l00516"></a><span class="lineno">  516</span>&#160;            <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00517"></a><span class="lineno">  517</span>&#160;              rejectedhsidx.push_back(jhit);</div>
<div class="line"><a name="l00518"></a><span class="lineno">  518</span>&#160;            }</div>
<div class="line"><a name="l00519"></a><span class="lineno">  519</span>&#160;          }</div>
<div class="line"><a name="l00520"></a><span class="lineno">  520</span>&#160;        }</div>
<div class="line"><a name="l00521"></a><span class="lineno">  521</span>&#160;</div>
<div class="line"><a name="l00522"></a><span class="lineno">  522</span>&#160;        hitstate = &amp;hitstatev[ihit];</div>
<div class="line"><a name="l00523"></a><span class="lineno">  523</span>&#160;        <span class="keyword">auto</span>&amp; hitflags = hitflagsv[ihit];</div>
<div class="line"><a name="l00524"></a><span class="lineno">  524</span>&#160;</div>
<div class="line"><a name="l00525"></a><span class="lineno">  525</span>&#160;        <span class="comment">//reject hits failing maxResidue, maxChi2, or maxDist cuts</span></div>
<div class="line"><a name="l00526"></a><span class="lineno">  526</span>&#160;        <span class="keywordflow">if</span> (fwdUpdTkState.size() &gt; 0 &amp;&amp; applySkipClean &amp;&amp;</div>
<div class="line"><a name="l00527"></a><span class="lineno">  527</span>&#160;            (<a class="code" href="../../dd/d59/sparse__vector__test_8cc.html#a39f16bf854ba527dee7eba5bbbd93f3f">std::abs</a>(trackState.residual(*hitstate)) &gt; <a class="code" href="../../d6/dca/classtrkf_1_1TrackKalmanFitter.html#ad91dc22bc6789376670625e65803e70a">maxResidue_</a> ||</div>
<div class="line"><a name="l00528"></a><span class="lineno">  528</span>&#160;             trackState.chi2(*hitstate) &gt; <a class="code" href="../../d6/dca/classtrkf_1_1TrackKalmanFitter.html#a32e405aa0e9672abe0f28d28d3af8777">maxChi2_</a> || min_dist &gt; <a class="code" href="../../d6/dca/classtrkf_1_1TrackKalmanFitter.html#a3637c0f4a1ead3c751c0a4cc687facdc">maxDist_</a>)) {</div>
<div class="line"><a name="l00529"></a><span class="lineno">  529</span>&#160;          <span class="comment">//</span></div>
<div class="line"><a name="l00530"></a><span class="lineno">  530</span>&#160;          <span class="keywordflow">if</span> (<a class="code" href="../../d6/dca/classtrkf_1_1TrackKalmanFitter.html#acbd8f32e18621b3cc8387fc6f01fb190">dumpLevel_</a> &gt; 1)</div>
<div class="line"><a name="l00531"></a><span class="lineno">  531</span>&#160;            <a class="code" href="../../d8/df5/messageservice_8fcl.html#a6699b4dbd72f548e48d81c88697d35a6">std::cout</a> &lt;&lt; <span class="stringliteral">&quot;rejecting hit with res=&quot;</span> &lt;&lt; <a class="code" href="../../dd/d59/sparse__vector__test_8cc.html#a39f16bf854ba527dee7eba5bbbd93f3f">std::abs</a>(trackState.residual(*hitstate))</div>
<div class="line"><a name="l00532"></a><span class="lineno">  532</span>&#160;                      &lt;&lt; <span class="stringliteral">&quot; chi2=&quot;</span> &lt;&lt; trackState.chi2(*hitstate) &lt;&lt; <span class="stringliteral">&quot; dist=&quot;</span> &lt;&lt; min_dist</div>
<div class="line"><a name="l00533"></a><span class="lineno">  533</span>&#160;                      &lt;&lt; std::endl;</div>
<div class="line"><a name="l00534"></a><span class="lineno">  534</span>&#160;          <span class="comment">// reset the current state, do not update the hit, and mark as excluded from the fit</span></div>
<div class="line"><a name="l00535"></a><span class="lineno">  535</span>&#160;          <span class="keywordflow">if</span> (fwdUpdTkState.size() &gt; 0)</div>
<div class="line"><a name="l00536"></a><span class="lineno">  536</span>&#160;            trackState = fwdUpdTkState.back();</div>
<div class="line"><a name="l00537"></a><span class="lineno">  537</span>&#160;          <span class="keywordflow">else</span></div>
<div class="line"><a name="l00538"></a><span class="lineno">  538</span>&#160;            trackState = startState;</div>
<div class="line"><a name="l00539"></a><span class="lineno">  539</span>&#160;          rejectedhsidx.push_back(ihit);</div>
<div class="line"><a name="l00540"></a><span class="lineno">  540</span>&#160;          hitflags.set(<a class="code" href="../../d4/dff/structrecob_1_1TrajectoryPointFlagTraits.html#a52e1b0d7701ede6b439780ccfe24dcf6">recob::TrajectoryPointFlagTraits::ExcludedFromFit</a>);</div>
<div class="line"><a name="l00541"></a><span class="lineno">  541</span>&#160;          hitflags.set(</div>
<div class="line"><a name="l00542"></a><span class="lineno">  542</span>&#160;            <a class="code" href="../../d4/dff/structrecob_1_1TrajectoryPointFlagTraits.html">recob::TrajectoryPointFlagTraits</a>::</div>
<div class="line"><a name="l00543"></a><span class="lineno">  543</span>&#160;              NoPoint); <span class="comment">//fixme: this is only for event display, also needed by current definition of ValidPoint</span></div>
<div class="line"><a name="l00544"></a><span class="lineno">  544</span>&#160;          <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l00545"></a><span class="lineno">  545</span>&#160;        }</div>
<div class="line"><a name="l00546"></a><span class="lineno">  546</span>&#160;</div>
<div class="line"><a name="l00547"></a><span class="lineno">  547</span>&#160;        hitstateidx.push_back(ihit);</div>
<div class="line"><a name="l00548"></a><span class="lineno">  548</span>&#160;        fwdPrdTkState.push_back(trackState);</div>
<div class="line"><a name="l00549"></a><span class="lineno">  549</span>&#160;</div>
<div class="line"><a name="l00550"></a><span class="lineno">  550</span>&#160;        <span class="comment">//hits with problematic flags are kept but not used for update and flagged as excluded from fit</span></div>
<div class="line"><a name="l00551"></a><span class="lineno">  551</span>&#160;        <span class="keywordflow">if</span> (hitflags.isSet(<a class="code" href="../../d4/dff/structrecob_1_1TrajectoryPointFlagTraits.html#a1ed6fcc21f6cf9a22bd3134bc6c9a460">recob::TrajectoryPointFlagTraits::HitIgnored</a>) ||</div>
<div class="line"><a name="l00552"></a><span class="lineno">  552</span>&#160;            hitflags.isSet(<a class="code" href="../../d4/dff/structrecob_1_1TrajectoryPointFlagTraits.html#a1760e570fd2707dae33daae0d530f600">recob::TrajectoryPointFlagTraits::Merged</a>) ||</div>
<div class="line"><a name="l00553"></a><span class="lineno">  553</span>&#160;            hitflags.isSet(<a class="code" href="../../d4/dff/structrecob_1_1TrajectoryPointFlagTraits.html#ab2d2e96ad3ccc48951e04a26e32c15b0">recob::TrajectoryPointFlagTraits::Shared</a>) ||</div>
<div class="line"><a name="l00554"></a><span class="lineno">  554</span>&#160;            hitflags.isSet(<a class="code" href="../../d4/dff/structrecob_1_1TrajectoryPointFlagTraits.html#aceef1d4ad4539248ca582a625e2b30b0">recob::TrajectoryPointFlagTraits::DeltaRay</a>) ||</div>
<div class="line"><a name="l00555"></a><span class="lineno">  555</span>&#160;            hitflags.isSet(<a class="code" href="../../d4/dff/structrecob_1_1TrajectoryPointFlagTraits.html#ab75fdf48bb4efcd78d060123086c0c7b">recob::TrajectoryPointFlagTraits::DetectorIssue</a>) ||</div>
<div class="line"><a name="l00556"></a><span class="lineno">  556</span>&#160;            hitflags.isSet(<a class="code" href="../../d4/dff/structrecob_1_1TrajectoryPointFlagTraits.html#a243c05ec9753836bcef283ecc16f8a00">recob::TrajectoryPointFlagTraits::Suspicious</a>)) {</div>
<div class="line"><a name="l00557"></a><span class="lineno">  557</span>&#160;          <span class="comment">//</span></div>
<div class="line"><a name="l00558"></a><span class="lineno">  558</span>&#160;          <span class="comment">// reset the current state, do not update the hit, and mark as excluded from the fit</span></div>
<div class="line"><a name="l00559"></a><span class="lineno">  559</span>&#160;          <span class="keywordflow">if</span> (fwdUpdTkState.size() &gt; 0)</div>
<div class="line"><a name="l00560"></a><span class="lineno">  560</span>&#160;            trackState = fwdUpdTkState.back();</div>
<div class="line"><a name="l00561"></a><span class="lineno">  561</span>&#160;          <span class="keywordflow">else</span></div>
<div class="line"><a name="l00562"></a><span class="lineno">  562</span>&#160;            trackState = startState;</div>
<div class="line"><a name="l00563"></a><span class="lineno">  563</span>&#160;          fwdUpdTkState.push_back(trackState);</div>
<div class="line"><a name="l00564"></a><span class="lineno">  564</span>&#160;          hitflags.set(<a class="code" href="../../d4/dff/structrecob_1_1TrajectoryPointFlagTraits.html#a52e1b0d7701ede6b439780ccfe24dcf6">recob::TrajectoryPointFlagTraits::ExcludedFromFit</a>);</div>
<div class="line"><a name="l00565"></a><span class="lineno">  565</span>&#160;          hitflags.set(</div>
<div class="line"><a name="l00566"></a><span class="lineno">  566</span>&#160;            <a class="code" href="../../d4/dff/structrecob_1_1TrajectoryPointFlagTraits.html">recob::TrajectoryPointFlagTraits</a>::</div>
<div class="line"><a name="l00567"></a><span class="lineno">  567</span>&#160;              NoPoint); <span class="comment">//fixme: this is only for event display, also needed by current definition of ValidPoint</span></div>
<div class="line"><a name="l00568"></a><span class="lineno">  568</span>&#160;          <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l00569"></a><span class="lineno">  569</span>&#160;        }</div>
<div class="line"><a name="l00570"></a><span class="lineno">  570</span>&#160;        <span class="comment">//now update the forward fitted track</span></div>
<div class="line"><a name="l00571"></a><span class="lineno">  571</span>&#160;        <span class="keywordtype">bool</span> upok = trackState.updateWithHitState(*hitstate);</div>
<div class="line"><a name="l00572"></a><span class="lineno">  572</span>&#160;        <span class="keywordflow">if</span> (upok == 0) {</div>
<div class="line"><a name="l00573"></a><span class="lineno">  573</span>&#160;          mf::LogWarning(<span class="stringliteral">&quot;TrackKalmanFitter&quot;</span>) &lt;&lt; <span class="stringliteral">&quot;Fit failure at &quot;</span> &lt;&lt; __FILE__ &lt;&lt; <span class="stringliteral">&quot; &quot;</span> &lt;&lt; __LINE__;</div>
<div class="line"><a name="l00574"></a><span class="lineno">  574</span>&#160;          <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l00575"></a><span class="lineno">  575</span>&#160;        }</div>
<div class="line"><a name="l00576"></a><span class="lineno">  576</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="../../d6/dca/classtrkf_1_1TrackKalmanFitter.html#acbd8f32e18621b3cc8387fc6f01fb190">dumpLevel_</a> &gt; 1) {</div>
<div class="line"><a name="l00577"></a><span class="lineno">  577</span>&#160;          <a class="code" href="../../d8/df5/messageservice_8fcl.html#a6699b4dbd72f548e48d81c88697d35a6">std::cout</a> &lt;&lt; <span class="stringliteral">&quot;updated state &quot;</span> &lt;&lt; std::endl;</div>
<div class="line"><a name="l00578"></a><span class="lineno">  578</span>&#160;          trackState.dump();</div>
<div class="line"><a name="l00579"></a><span class="lineno">  579</span>&#160;        }</div>
<div class="line"><a name="l00580"></a><span class="lineno">  580</span>&#160;        fwdUpdTkState.push_back(trackState);</div>
<div class="line"><a name="l00581"></a><span class="lineno">  581</span>&#160;      }</div>
<div class="line"><a name="l00582"></a><span class="lineno">  582</span>&#160;      <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00583"></a><span class="lineno">  583</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="../../d6/dca/classtrkf_1_1TrackKalmanFitter.html#acbd8f32e18621b3cc8387fc6f01fb190">dumpLevel_</a> &gt; 0)</div>
<div class="line"><a name="l00584"></a><span class="lineno">  584</span>&#160;          <a class="code" href="../../d8/df5/messageservice_8fcl.html#a6699b4dbd72f548e48d81c88697d35a6">std::cout</a> &lt;&lt; <span class="stringliteral">&quot;WARNING: forward propagation failed. Skip this hit...&quot;</span> &lt;&lt; std::endl;</div>
<div class="line"><a name="l00585"></a><span class="lineno">  585</span>&#160;        <span class="comment">// restore the last successful propagation</span></div>
<div class="line"><a name="l00586"></a><span class="lineno">  586</span>&#160;        <span class="keywordflow">if</span> (fwdPrdTkState.size() &gt; 0)</div>
<div class="line"><a name="l00587"></a><span class="lineno">  587</span>&#160;          trackState = fwdPrdTkState.back();</div>
<div class="line"><a name="l00588"></a><span class="lineno">  588</span>&#160;        <span class="keywordflow">else</span></div>
<div class="line"><a name="l00589"></a><span class="lineno">  589</span>&#160;          trackState = startState;</div>
<div class="line"><a name="l00590"></a><span class="lineno">  590</span>&#160;        rejectedhsidx.push_back(ihit);</div>
<div class="line"><a name="l00591"></a><span class="lineno">  591</span>&#160;        <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l00592"></a><span class="lineno">  592</span>&#160;      }</div>
<div class="line"><a name="l00593"></a><span class="lineno">  593</span>&#160;      <span class="keywordflow">if</span> (rejectedhsidx.size() + hitstateidx.size() == hitstatev.size()) <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00594"></a><span class="lineno">  594</span>&#160;    }</div>
<div class="line"><a name="l00595"></a><span class="lineno">  595</span>&#160;  }</div>
<div class="line"><a name="l00596"></a><span class="lineno">  596</span>&#160;  <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00597"></a><span class="lineno">  597</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> ihit = 0; ihit &lt; hitstatev.size(); ++ihit) {</div>
<div class="line"><a name="l00598"></a><span class="lineno">  598</span>&#160;      <span class="keyword">const</span> <span class="keyword">auto</span>&amp; hitstate = hitstatev[ihit];</div>
<div class="line"><a name="l00599"></a><span class="lineno">  599</span>&#160;      <span class="keywordflow">if</span> (<a class="code" href="../../d6/dca/classtrkf_1_1TrackKalmanFitter.html#acbd8f32e18621b3cc8387fc6f01fb190">dumpLevel_</a> &gt; 1) {</div>
<div class="line"><a name="l00600"></a><span class="lineno">  600</span>&#160;        <a class="code" href="../../d8/df5/messageservice_8fcl.html#a6699b4dbd72f548e48d81c88697d35a6">std::cout</a> &lt;&lt; std::endl &lt;&lt; <span class="stringliteral">&quot;processing hit #&quot;</span> &lt;&lt; ihit &lt;&lt; std::endl;</div>
<div class="line"><a name="l00601"></a><span class="lineno">  601</span>&#160;        hitstate.dump();</div>
<div class="line"><a name="l00602"></a><span class="lineno">  602</span>&#160;      }</div>
<div class="line"><a name="l00603"></a><span class="lineno">  603</span>&#160;      <span class="keyword">auto</span>&amp; hitflags = hitflagsv[ihit];</div>
<div class="line"><a name="l00604"></a><span class="lineno">  604</span>&#160;      <span class="keywordflow">if</span> (hitflags.isSet(<a class="code" href="../../d4/dff/structrecob_1_1TrajectoryPointFlagTraits.html#a52e1b0d7701ede6b439780ccfe24dcf6">recob::TrajectoryPointFlagTraits::ExcludedFromFit</a>) ||</div>
<div class="line"><a name="l00605"></a><span class="lineno">  605</span>&#160;          hitflags.isSet(<a class="code" href="../../d4/dff/structrecob_1_1TrajectoryPointFlagTraits.html#a06470c4691580dc3c0414f78f737aaf8">recob::TrajectoryPointFlagTraits::Rejected</a>)) {</div>
<div class="line"><a name="l00606"></a><span class="lineno">  606</span>&#160;        rejectedhsidx.push_back(ihit);</div>
<div class="line"><a name="l00607"></a><span class="lineno">  607</span>&#160;        <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l00608"></a><span class="lineno">  608</span>&#160;      }</div>
<div class="line"><a name="l00609"></a><span class="lineno">  609</span>&#160;      <span class="keywordtype">bool</span> success = <span class="keyword">true</span>;</div>
<div class="line"><a name="l00610"></a><span class="lineno">  610</span>&#160;      <span class="keyword">const</span> <span class="keywordtype">double</span> dist =</div>
<div class="line"><a name="l00611"></a><span class="lineno">  611</span>&#160;        <a class="code" href="../../d6/dca/classtrkf_1_1TrackKalmanFitter.html#a029821569a62274483456d270d7cd7e8">propagator</a>-&gt;<a class="code" href="../../dc/d5e/classtrkf_1_1TrackStatePropagator.html#ab4f06dfff7579a24d5748096cb49bf06">distanceToPlane</a>(success, trackState.trackState(), hitstate.plane());</div>
<div class="line"><a name="l00612"></a><span class="lineno">  612</span>&#160;      <span class="keywordflow">if</span> (applySkipClean &amp;&amp; fwdUpdTkState.size() &gt; 0 &amp;&amp; <a class="code" href="../../d6/dca/classtrkf_1_1TrackKalmanFitter.html#a439ce5d209c8590832ce4c5612dbf7b7">skipNegProp_</a>) {</div>
<div class="line"><a name="l00613"></a><span class="lineno">  613</span>&#160;        <span class="keywordflow">if</span> (dist &lt; 0. || success == <span class="keyword">false</span>) {</div>
<div class="line"><a name="l00614"></a><span class="lineno">  614</span>&#160;          <span class="keywordflow">if</span> (<a class="code" href="../../d6/dca/classtrkf_1_1TrackKalmanFitter.html#acbd8f32e18621b3cc8387fc6f01fb190">dumpLevel_</a> &gt; 0)</div>
<div class="line"><a name="l00615"></a><span class="lineno">  615</span>&#160;            <a class="code" href="../../d8/df5/messageservice_8fcl.html#a6699b4dbd72f548e48d81c88697d35a6">std::cout</a> &lt;&lt; <span class="stringliteral">&quot;WARNING: negative propagation distance. Skip this hit...&quot;</span> &lt;&lt; std::endl;</div>
<div class="line"><a name="l00616"></a><span class="lineno">  616</span>&#160;          ;</div>
<div class="line"><a name="l00617"></a><span class="lineno">  617</span>&#160;          rejectedhsidx.push_back(ihit);</div>
<div class="line"><a name="l00618"></a><span class="lineno">  618</span>&#160;          <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l00619"></a><span class="lineno">  619</span>&#160;        }</div>
<div class="line"><a name="l00620"></a><span class="lineno">  620</span>&#160;      }</div>
<div class="line"><a name="l00621"></a><span class="lineno">  621</span>&#160;      <span class="comment">//propagate to measurement surface</span></div>
<div class="line"><a name="l00622"></a><span class="lineno">  622</span>&#160;      <span class="keywordtype">bool</span> propok = <span class="keyword">true</span>;</div>
<div class="line"><a name="l00623"></a><span class="lineno">  623</span>&#160;      trackState = <a class="code" href="../../d6/dca/classtrkf_1_1TrackKalmanFitter.html#a029821569a62274483456d270d7cd7e8">propagator</a>-&gt;<a class="code" href="../../dc/d5e/classtrkf_1_1TrackStatePropagator.html#ae46e7c518db95bfca7418cd582682c95">propagateToPlane</a>(propok,</div>
<div class="line"><a name="l00624"></a><span class="lineno">  624</span>&#160;                                                <a class="code" href="../../d2/d1a/namespacedetsim.html#a560adbb3abf95a23d45a53ed25d8c0c7">detProp</a>,</div>
<div class="line"><a name="l00625"></a><span class="lineno">  625</span>&#160;                                                trackState.trackState(),</div>
<div class="line"><a name="l00626"></a><span class="lineno">  626</span>&#160;                                                hitstate.plane(),</div>
<div class="line"><a name="l00627"></a><span class="lineno">  627</span>&#160;                                                <span class="keyword">true</span>,</div>
<div class="line"><a name="l00628"></a><span class="lineno">  628</span>&#160;                                                <span class="keyword">true</span>,</div>
<div class="line"><a name="l00629"></a><span class="lineno">  629</span>&#160;                                                <a class="code" href="../../dc/d5e/classtrkf_1_1TrackStatePropagator.html#ae5eff788f74ea79d40466328fd943a1ba6351b029d52cf3f64d523db56d4a532a">TrackStatePropagator::FORWARD</a>);</div>
<div class="line"><a name="l00630"></a><span class="lineno">  630</span>&#160;      <span class="keywordflow">if</span> (!propok &amp;&amp; !(applySkipClean &amp;&amp; <a class="code" href="../../d6/dca/classtrkf_1_1TrackKalmanFitter.html#a439ce5d209c8590832ce4c5612dbf7b7">skipNegProp_</a>))</div>
<div class="line"><a name="l00631"></a><span class="lineno">  631</span>&#160;        trackState = <a class="code" href="../../d6/dca/classtrkf_1_1TrackKalmanFitter.html#a029821569a62274483456d270d7cd7e8">propagator</a>-&gt;<a class="code" href="../../dc/d5e/classtrkf_1_1TrackStatePropagator.html#ae46e7c518db95bfca7418cd582682c95">propagateToPlane</a>(propok,</div>
<div class="line"><a name="l00632"></a><span class="lineno">  632</span>&#160;                                                  <a class="code" href="../../d2/d1a/namespacedetsim.html#a560adbb3abf95a23d45a53ed25d8c0c7">detProp</a>,</div>
<div class="line"><a name="l00633"></a><span class="lineno">  633</span>&#160;                                                  trackState.trackState(),</div>
<div class="line"><a name="l00634"></a><span class="lineno">  634</span>&#160;                                                  hitstate.plane(),</div>
<div class="line"><a name="l00635"></a><span class="lineno">  635</span>&#160;                                                  <span class="keyword">true</span>,</div>
<div class="line"><a name="l00636"></a><span class="lineno">  636</span>&#160;                                                  <span class="keyword">true</span>,</div>
<div class="line"><a name="l00637"></a><span class="lineno">  637</span>&#160;                                                  <a class="code" href="../../dc/d5e/classtrkf_1_1TrackStatePropagator.html#ae5eff788f74ea79d40466328fd943a1ba815fdae095e62f7826692abe63e9e458">TrackStatePropagator::BACKWARD</a>);</div>
<div class="line"><a name="l00638"></a><span class="lineno">  638</span>&#160;      <span class="keywordflow">if</span> (propok) {</div>
<div class="line"><a name="l00639"></a><span class="lineno">  639</span>&#160;        hitstateidx.push_back(ihit);</div>
<div class="line"><a name="l00640"></a><span class="lineno">  640</span>&#160;        fwdPrdTkState.push_back(trackState);</div>
<div class="line"><a name="l00641"></a><span class="lineno">  641</span>&#160;        <span class="comment">//</span></div>
<div class="line"><a name="l00642"></a><span class="lineno">  642</span>&#160;        <span class="keywordflow">if</span> (hitflags.isSet(<a class="code" href="../../d4/dff/structrecob_1_1TrajectoryPointFlagTraits.html#a1ed6fcc21f6cf9a22bd3134bc6c9a460">recob::TrajectoryPointFlagTraits::HitIgnored</a>) ||</div>
<div class="line"><a name="l00643"></a><span class="lineno">  643</span>&#160;            hitflags.isSet(<a class="code" href="../../d4/dff/structrecob_1_1TrajectoryPointFlagTraits.html#a1760e570fd2707dae33daae0d530f600">recob::TrajectoryPointFlagTraits::Merged</a>) ||</div>
<div class="line"><a name="l00644"></a><span class="lineno">  644</span>&#160;            hitflags.isSet(<a class="code" href="../../d4/dff/structrecob_1_1TrajectoryPointFlagTraits.html#ab2d2e96ad3ccc48951e04a26e32c15b0">recob::TrajectoryPointFlagTraits::Shared</a>) ||</div>
<div class="line"><a name="l00645"></a><span class="lineno">  645</span>&#160;            hitflags.isSet(<a class="code" href="../../d4/dff/structrecob_1_1TrajectoryPointFlagTraits.html#aceef1d4ad4539248ca582a625e2b30b0">recob::TrajectoryPointFlagTraits::DeltaRay</a>) ||</div>
<div class="line"><a name="l00646"></a><span class="lineno">  646</span>&#160;            hitflags.isSet(<a class="code" href="../../d4/dff/structrecob_1_1TrajectoryPointFlagTraits.html#ab75fdf48bb4efcd78d060123086c0c7b">recob::TrajectoryPointFlagTraits::DetectorIssue</a>) ||</div>
<div class="line"><a name="l00647"></a><span class="lineno">  647</span>&#160;            hitflags.isSet(<a class="code" href="../../d4/dff/structrecob_1_1TrajectoryPointFlagTraits.html#a243c05ec9753836bcef283ecc16f8a00">recob::TrajectoryPointFlagTraits::Suspicious</a>) ||</div>
<div class="line"><a name="l00648"></a><span class="lineno">  648</span>&#160;            (fwdUpdTkState.size() &gt; 0 &amp;&amp; applySkipClean &amp;&amp;</div>
<div class="line"><a name="l00649"></a><span class="lineno">  649</span>&#160;             (<a class="code" href="../../dd/d59/sparse__vector__test_8cc.html#a39f16bf854ba527dee7eba5bbbd93f3f">std::abs</a>(trackState.residual(hitstate)) &gt; <a class="code" href="../../d6/dca/classtrkf_1_1TrackKalmanFitter.html#ad91dc22bc6789376670625e65803e70a">maxResidue_</a> ||</div>
<div class="line"><a name="l00650"></a><span class="lineno">  650</span>&#160;              trackState.chi2(hitstate) &gt; <a class="code" href="../../d6/dca/classtrkf_1_1TrackKalmanFitter.html#a32e405aa0e9672abe0f28d28d3af8777">maxChi2_</a> || dist &gt; <a class="code" href="../../d6/dca/classtrkf_1_1TrackKalmanFitter.html#a3637c0f4a1ead3c751c0a4cc687facdc">maxDist_</a>))) {</div>
<div class="line"><a name="l00651"></a><span class="lineno">  651</span>&#160;          <span class="keywordflow">if</span> (<a class="code" href="../../d6/dca/classtrkf_1_1TrackKalmanFitter.html#acbd8f32e18621b3cc8387fc6f01fb190">dumpLevel_</a> &gt; 1)</div>
<div class="line"><a name="l00652"></a><span class="lineno">  652</span>&#160;            <a class="code" href="../../d8/df5/messageservice_8fcl.html#a6699b4dbd72f548e48d81c88697d35a6">std::cout</a> &lt;&lt; <span class="stringliteral">&quot;rejecting hit with res=&quot;</span> &lt;&lt; <a class="code" href="../../dd/d59/sparse__vector__test_8cc.html#a39f16bf854ba527dee7eba5bbbd93f3f">std::abs</a>(trackState.residual(hitstate))</div>
<div class="line"><a name="l00653"></a><span class="lineno">  653</span>&#160;                      &lt;&lt; <span class="stringliteral">&quot; chi2=&quot;</span> &lt;&lt; trackState.chi2(hitstate) &lt;&lt; <span class="stringliteral">&quot; dist=&quot;</span> &lt;&lt; dist &lt;&lt; std::endl;</div>
<div class="line"><a name="l00654"></a><span class="lineno">  654</span>&#160;          <span class="comment">// reset the current state, do not update the hit, mark as excluded from the fit</span></div>
<div class="line"><a name="l00655"></a><span class="lineno">  655</span>&#160;          <span class="keywordflow">if</span> (fwdUpdTkState.size() &gt; 0)</div>
<div class="line"><a name="l00656"></a><span class="lineno">  656</span>&#160;            trackState = fwdUpdTkState.back();</div>
<div class="line"><a name="l00657"></a><span class="lineno">  657</span>&#160;          <span class="keywordflow">else</span></div>
<div class="line"><a name="l00658"></a><span class="lineno">  658</span>&#160;            trackState = startState;</div>
<div class="line"><a name="l00659"></a><span class="lineno">  659</span>&#160;          fwdUpdTkState.push_back(trackState);</div>
<div class="line"><a name="l00660"></a><span class="lineno">  660</span>&#160;          hitflags.set(<a class="code" href="../../d4/dff/structrecob_1_1TrajectoryPointFlagTraits.html#a52e1b0d7701ede6b439780ccfe24dcf6">recob::TrajectoryPointFlagTraits::ExcludedFromFit</a>);</div>
<div class="line"><a name="l00661"></a><span class="lineno">  661</span>&#160;          hitflags.set(</div>
<div class="line"><a name="l00662"></a><span class="lineno">  662</span>&#160;            <a class="code" href="../../d4/dff/structrecob_1_1TrajectoryPointFlagTraits.html">recob::TrajectoryPointFlagTraits</a>::</div>
<div class="line"><a name="l00663"></a><span class="lineno">  663</span>&#160;              NoPoint); <span class="comment">//fixme: this is only for event display, also needed by current definition of ValidPoint</span></div>
<div class="line"><a name="l00664"></a><span class="lineno">  664</span>&#160;          <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l00665"></a><span class="lineno">  665</span>&#160;        }</div>
<div class="line"><a name="l00666"></a><span class="lineno">  666</span>&#160;        <span class="comment">//</span></div>
<div class="line"><a name="l00667"></a><span class="lineno">  667</span>&#160;        <span class="keywordtype">bool</span> upok = trackState.updateWithHitState(hitstate);</div>
<div class="line"><a name="l00668"></a><span class="lineno">  668</span>&#160;        <span class="keywordflow">if</span> (upok == 0) {</div>
<div class="line"><a name="l00669"></a><span class="lineno">  669</span>&#160;          mf::LogWarning(<span class="stringliteral">&quot;TrackKalmanFitter&quot;</span>) &lt;&lt; <span class="stringliteral">&quot;Fit failure at &quot;</span> &lt;&lt; __FILE__ &lt;&lt; <span class="stringliteral">&quot; &quot;</span> &lt;&lt; __LINE__;</div>
<div class="line"><a name="l00670"></a><span class="lineno">  670</span>&#160;          <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l00671"></a><span class="lineno">  671</span>&#160;        }</div>
<div class="line"><a name="l00672"></a><span class="lineno">  672</span>&#160;        fwdUpdTkState.push_back(trackState);</div>
<div class="line"><a name="l00673"></a><span class="lineno">  673</span>&#160;      }</div>
<div class="line"><a name="l00674"></a><span class="lineno">  674</span>&#160;      <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00675"></a><span class="lineno">  675</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="../../d6/dca/classtrkf_1_1TrackKalmanFitter.html#acbd8f32e18621b3cc8387fc6f01fb190">dumpLevel_</a> &gt; 0)</div>
<div class="line"><a name="l00676"></a><span class="lineno">  676</span>&#160;          <a class="code" href="../../d8/df5/messageservice_8fcl.html#a6699b4dbd72f548e48d81c88697d35a6">std::cout</a> &lt;&lt; <span class="stringliteral">&quot;WARNING: forward propagation failed. Skip this hit...&quot;</span> &lt;&lt; std::endl;</div>
<div class="line"><a name="l00677"></a><span class="lineno">  677</span>&#160;        ;</div>
<div class="line"><a name="l00678"></a><span class="lineno">  678</span>&#160;        <span class="comment">// restore the last successful propagation</span></div>
<div class="line"><a name="l00679"></a><span class="lineno">  679</span>&#160;        <span class="keywordflow">if</span> (fwdPrdTkState.size() &gt; 0)</div>
<div class="line"><a name="l00680"></a><span class="lineno">  680</span>&#160;          trackState = fwdPrdTkState.back();</div>
<div class="line"><a name="l00681"></a><span class="lineno">  681</span>&#160;        <span class="keywordflow">else</span></div>
<div class="line"><a name="l00682"></a><span class="lineno">  682</span>&#160;          trackState = startState;</div>
<div class="line"><a name="l00683"></a><span class="lineno">  683</span>&#160;        rejectedhsidx.push_back(ihit);</div>
<div class="line"><a name="l00684"></a><span class="lineno">  684</span>&#160;        <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l00685"></a><span class="lineno">  685</span>&#160;      }</div>
<div class="line"><a name="l00686"></a><span class="lineno">  686</span>&#160;    } <span class="comment">//for (auto hitstate : hitstatev)</span></div>
<div class="line"><a name="l00687"></a><span class="lineno">  687</span>&#160;  }</div>
<div class="line"><a name="l00688"></a><span class="lineno">  688</span>&#160;</div>
<div class="line"><a name="l00689"></a><span class="lineno">  689</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="../../d6/dca/classtrkf_1_1TrackKalmanFitter.html#acbd8f32e18621b3cc8387fc6f01fb190">dumpLevel_</a> &gt; 2) assert(rejectedhsidx.size() + hitstateidx.size() == hitstatev.size());</div>
<div class="line"><a name="l00690"></a><span class="lineno">  690</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="../../d6/dca/classtrkf_1_1TrackKalmanFitter.html#acbd8f32e18621b3cc8387fc6f01fb190">dumpLevel_</a> &gt; 0) {</div>
<div class="line"><a name="l00691"></a><span class="lineno">  691</span>&#160;    <a class="code" href="../../d8/df5/messageservice_8fcl.html#a6699b4dbd72f548e48d81c88697d35a6">std::cout</a> &lt;&lt; <span class="stringliteral">&quot;TRACK AFTER FWD&quot;</span> &lt;&lt; std::endl;</div>
<div class="line"><a name="l00692"></a><span class="lineno">  692</span>&#160;    <a class="code" href="../../d8/df5/messageservice_8fcl.html#a6699b4dbd72f548e48d81c88697d35a6">std::cout</a> &lt;&lt; <span class="stringliteral">&quot;hit sizes=&quot;</span> &lt;&lt; rejectedhsidx.size() &lt;&lt; <span class="stringliteral">&quot; &quot;</span> &lt;&lt; hitstateidx.size() &lt;&lt; <span class="stringliteral">&quot; &quot;</span></div>
<div class="line"><a name="l00693"></a><span class="lineno">  693</span>&#160;              &lt;&lt; hitstatev.size() &lt;&lt; std::endl;</div>
<div class="line"><a name="l00694"></a><span class="lineno">  694</span>&#160;    trackState.dump();</div>
<div class="line"><a name="l00695"></a><span class="lineno">  695</span>&#160;  }</div>
<div class="line"><a name="l00696"></a><span class="lineno">  696</span>&#160;</div>
<div class="line"><a name="l00697"></a><span class="lineno">  697</span>&#160;  <span class="comment">//reinitialize trf for backward fit, scale the error to avoid biasing the backward fit</span></div>
<div class="line"><a name="l00698"></a><span class="lineno">  698</span>&#160;  trackState.setCovariance(100. * trackState.covariance());</div>
<div class="line"><a name="l00699"></a><span class="lineno">  699</span>&#160;</div>
<div class="line"><a name="l00700"></a><span class="lineno">  700</span>&#160;  startState = trackState;</div>
<div class="line"><a name="l00701"></a><span class="lineno">  701</span>&#160;</div>
<div class="line"><a name="l00702"></a><span class="lineno">  702</span>&#160;  <span class="comment">//backward loop over track states and hits in fwdUpdTracks: use hits for backward fit and fwd track states for smoothing</span></div>
<div class="line"><a name="l00703"></a><span class="lineno">  703</span>&#160;  <span class="keywordtype">int</span> nvalidhits = 0;</div>
<div class="line"><a name="l00704"></a><span class="lineno">  704</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">int</span> itk = fwdPrdTkState.size() - 1; itk &gt;= 0; itk--) {</div>
<div class="line"><a name="l00705"></a><span class="lineno">  705</span>&#160;    <span class="keyword">auto</span>&amp; fwdPrdTrackState = fwdPrdTkState[itk];</div>
<div class="line"><a name="l00706"></a><span class="lineno">  706</span>&#160;    <span class="keyword">auto</span>&amp; fwdUpdTrackState = fwdUpdTkState[itk];</div>
<div class="line"><a name="l00707"></a><span class="lineno">  707</span>&#160;    <span class="keyword">const</span> <span class="keyword">auto</span>&amp; hitstate = hitstatev[hitstateidx[itk]];</div>
<div class="line"><a name="l00708"></a><span class="lineno">  708</span>&#160;    <span class="keyword">auto</span>&amp; hitflags = hitflagsv[hitstateidx[itk]];</div>
<div class="line"><a name="l00709"></a><span class="lineno">  709</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="../../d6/dca/classtrkf_1_1TrackKalmanFitter.html#acbd8f32e18621b3cc8387fc6f01fb190">dumpLevel_</a> &gt; 1) {</div>
<div class="line"><a name="l00710"></a><span class="lineno">  710</span>&#160;      <a class="code" href="../../d8/df5/messageservice_8fcl.html#a6699b4dbd72f548e48d81c88697d35a6">std::cout</a> &lt;&lt; std::endl &lt;&lt; <span class="stringliteral">&quot;processing backward hit #&quot;</span> &lt;&lt; itk &lt;&lt; std::endl;</div>
<div class="line"><a name="l00711"></a><span class="lineno">  711</span>&#160;      hitstate.dump();</div>
<div class="line"><a name="l00712"></a><span class="lineno">  712</span>&#160;    }</div>
<div class="line"><a name="l00713"></a><span class="lineno">  713</span>&#160;    <span class="keywordtype">bool</span> propok = <span class="keyword">true</span>;</div>
<div class="line"><a name="l00714"></a><span class="lineno">  714</span>&#160;    trackState = <a class="code" href="../../d6/dca/classtrkf_1_1TrackKalmanFitter.html#a029821569a62274483456d270d7cd7e8">propagator</a>-&gt;<a class="code" href="../../dc/d5e/classtrkf_1_1TrackStatePropagator.html#ae46e7c518db95bfca7418cd582682c95">propagateToPlane</a>(propok,</div>
<div class="line"><a name="l00715"></a><span class="lineno">  715</span>&#160;                                              <a class="code" href="../../d2/d1a/namespacedetsim.html#a560adbb3abf95a23d45a53ed25d8c0c7">detProp</a>,</div>
<div class="line"><a name="l00716"></a><span class="lineno">  716</span>&#160;                                              trackState.trackState(),</div>
<div class="line"><a name="l00717"></a><span class="lineno">  717</span>&#160;                                              hitstate.plane(),</div>
<div class="line"><a name="l00718"></a><span class="lineno">  718</span>&#160;                                              <span class="keyword">true</span>,</div>
<div class="line"><a name="l00719"></a><span class="lineno">  719</span>&#160;                                              <span class="keyword">true</span>,</div>
<div class="line"><a name="l00720"></a><span class="lineno">  720</span>&#160;                                              <a class="code" href="../../dc/d5e/classtrkf_1_1TrackStatePropagator.html#ae5eff788f74ea79d40466328fd943a1ba815fdae095e62f7826692abe63e9e458">TrackStatePropagator::BACKWARD</a>);</div>
<div class="line"><a name="l00721"></a><span class="lineno">  721</span>&#160;    <span class="keywordflow">if</span> (!propok)</div>
<div class="line"><a name="l00722"></a><span class="lineno">  722</span>&#160;      trackState = <a class="code" href="../../d6/dca/classtrkf_1_1TrackKalmanFitter.html#a029821569a62274483456d270d7cd7e8">propagator</a>-&gt;<a class="code" href="../../dc/d5e/classtrkf_1_1TrackStatePropagator.html#ae46e7c518db95bfca7418cd582682c95">propagateToPlane</a>(propok,</div>
<div class="line"><a name="l00723"></a><span class="lineno">  723</span>&#160;                                                <a class="code" href="../../d2/d1a/namespacedetsim.html#a560adbb3abf95a23d45a53ed25d8c0c7">detProp</a>,</div>
<div class="line"><a name="l00724"></a><span class="lineno">  724</span>&#160;                                                trackState.trackState(),</div>
<div class="line"><a name="l00725"></a><span class="lineno">  725</span>&#160;                                                hitstate.plane(),</div>
<div class="line"><a name="l00726"></a><span class="lineno">  726</span>&#160;                                                <span class="keyword">true</span>,</div>
<div class="line"><a name="l00727"></a><span class="lineno">  727</span>&#160;                                                <span class="keyword">true</span>,</div>
<div class="line"><a name="l00728"></a><span class="lineno">  728</span>&#160;                                                <a class="code" href="../../dc/d5e/classtrkf_1_1TrackStatePropagator.html#ae5eff788f74ea79d40466328fd943a1ba6351b029d52cf3f64d523db56d4a532a">TrackStatePropagator::FORWARD</a>); <span class="comment">//do we want this?</span></div>
<div class="line"><a name="l00729"></a><span class="lineno">  729</span>&#160;    <span class="comment">//</span></div>
<div class="line"><a name="l00730"></a><span class="lineno">  730</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="../../d6/dca/classtrkf_1_1TrackKalmanFitter.html#acbd8f32e18621b3cc8387fc6f01fb190">dumpLevel_</a> &gt; 1) {</div>
<div class="line"><a name="l00731"></a><span class="lineno">  731</span>&#160;      <a class="code" href="../../d8/df5/messageservice_8fcl.html#a6699b4dbd72f548e48d81c88697d35a6">std::cout</a> &lt;&lt; <span class="stringliteral">&quot;propagation result=&quot;</span> &lt;&lt; propok &lt;&lt; std::endl;</div>
<div class="line"><a name="l00732"></a><span class="lineno">  732</span>&#160;      <a class="code" href="../../d8/df5/messageservice_8fcl.html#a6699b4dbd72f548e48d81c88697d35a6">std::cout</a> &lt;&lt; <span class="stringliteral">&quot;propagated state &quot;</span> &lt;&lt; std::endl;</div>
<div class="line"><a name="l00733"></a><span class="lineno">  733</span>&#160;      trackState.dump();</div>
<div class="line"><a name="l00734"></a><span class="lineno">  734</span>&#160;      <a class="code" href="../../d8/df5/messageservice_8fcl.html#a6699b4dbd72f548e48d81c88697d35a6">std::cout</a> &lt;&lt; <span class="stringliteral">&quot;propagated planarity=&quot;</span></div>
<div class="line"><a name="l00735"></a><span class="lineno">  735</span>&#160;                &lt;&lt; hitstate.plane().direction().Dot(hitstate.plane().position() -</div>
<div class="line"><a name="l00736"></a><span class="lineno">  736</span>&#160;                                                    trackState.position())</div>
<div class="line"><a name="l00737"></a><span class="lineno">  737</span>&#160;                &lt;&lt; std::endl;</div>
<div class="line"><a name="l00738"></a><span class="lineno">  738</span>&#160;    }</div>
<div class="line"><a name="l00739"></a><span class="lineno">  739</span>&#160;    <span class="keywordflow">if</span> (propok) {</div>
<div class="line"><a name="l00740"></a><span class="lineno">  740</span>&#160;      <span class="comment">//combine forward predicted and backward predicted</span></div>
<div class="line"><a name="l00741"></a><span class="lineno">  741</span>&#160;      <span class="keywordtype">bool</span> pcombok = fwdPrdTrackState.combineWithTrackState(trackState.trackState());</div>
<div class="line"><a name="l00742"></a><span class="lineno">  742</span>&#160;      <span class="keywordflow">if</span> (pcombok == 0) {</div>
<div class="line"><a name="l00743"></a><span class="lineno">  743</span>&#160;        mf::LogWarning(<span class="stringliteral">&quot;TrackKalmanFitter&quot;</span>) &lt;&lt; <span class="stringliteral">&quot;Fit failure at &quot;</span> &lt;&lt; __FILE__ &lt;&lt; <span class="stringliteral">&quot; &quot;</span> &lt;&lt; __LINE__;</div>
<div class="line"><a name="l00744"></a><span class="lineno">  744</span>&#160;        <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l00745"></a><span class="lineno">  745</span>&#160;      }</div>
<div class="line"><a name="l00746"></a><span class="lineno">  746</span>&#160;      <span class="keywordflow">if</span> (<a class="code" href="../../d6/dca/classtrkf_1_1TrackKalmanFitter.html#acbd8f32e18621b3cc8387fc6f01fb190">dumpLevel_</a> &gt; 1) {</div>
<div class="line"><a name="l00747"></a><span class="lineno">  747</span>&#160;        <a class="code" href="../../d8/df5/messageservice_8fcl.html#a6699b4dbd72f548e48d81c88697d35a6">std::cout</a> &lt;&lt; <span class="stringliteral">&quot;combined prd state &quot;</span> &lt;&lt; std::endl;</div>
<div class="line"><a name="l00748"></a><span class="lineno">  748</span>&#160;        fwdPrdTrackState.dump();</div>
<div class="line"><a name="l00749"></a><span class="lineno">  749</span>&#160;      }</div>
<div class="line"><a name="l00750"></a><span class="lineno">  750</span>&#160;      <span class="comment">// combine forward updated and backward predicted and update backward predicted, only if the hit was not excluded</span></div>
<div class="line"><a name="l00751"></a><span class="lineno">  751</span>&#160;      <span class="keywordflow">if</span> (hitflags.isSet(<a class="code" href="../../d4/dff/structrecob_1_1TrajectoryPointFlagTraits.html#a52e1b0d7701ede6b439780ccfe24dcf6">recob::TrajectoryPointFlagTraits::ExcludedFromFit</a>) == 0) {</div>
<div class="line"><a name="l00752"></a><span class="lineno">  752</span>&#160;        <span class="keywordtype">bool</span> ucombok = fwdUpdTrackState.combineWithTrackState(trackState.trackState());</div>
<div class="line"><a name="l00753"></a><span class="lineno">  753</span>&#160;        <span class="keywordflow">if</span> (ucombok == 0) {</div>
<div class="line"><a name="l00754"></a><span class="lineno">  754</span>&#160;          mf::LogWarning(<span class="stringliteral">&quot;TrackKalmanFitter&quot;</span>) &lt;&lt; <span class="stringliteral">&quot;Fit failure at &quot;</span> &lt;&lt; __FILE__ &lt;&lt; <span class="stringliteral">&quot; &quot;</span> &lt;&lt; __LINE__;</div>
<div class="line"><a name="l00755"></a><span class="lineno">  755</span>&#160;          <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l00756"></a><span class="lineno">  756</span>&#160;        }</div>
<div class="line"><a name="l00757"></a><span class="lineno">  757</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="../../d6/dca/classtrkf_1_1TrackKalmanFitter.html#acbd8f32e18621b3cc8387fc6f01fb190">dumpLevel_</a> &gt; 1) {</div>
<div class="line"><a name="l00758"></a><span class="lineno">  758</span>&#160;          <a class="code" href="../../d8/df5/messageservice_8fcl.html#a6699b4dbd72f548e48d81c88697d35a6">std::cout</a> &lt;&lt; <span class="stringliteral">&quot;combined upd state &quot;</span> &lt;&lt; std::endl;</div>
<div class="line"><a name="l00759"></a><span class="lineno">  759</span>&#160;          fwdUpdTrackState.dump();</div>
<div class="line"><a name="l00760"></a><span class="lineno">  760</span>&#160;        }</div>
<div class="line"><a name="l00761"></a><span class="lineno">  761</span>&#160;        <span class="keywordtype">bool</span> upok = trackState.updateWithHitState(hitstate);</div>
<div class="line"><a name="l00762"></a><span class="lineno">  762</span>&#160;        <span class="keywordflow">if</span> (upok == 0) {</div>
<div class="line"><a name="l00763"></a><span class="lineno">  763</span>&#160;          mf::LogWarning(<span class="stringliteral">&quot;TrackKalmanFitter&quot;</span>) &lt;&lt; <span class="stringliteral">&quot;Fit failure at &quot;</span> &lt;&lt; __FILE__ &lt;&lt; <span class="stringliteral">&quot; &quot;</span> &lt;&lt; __LINE__;</div>
<div class="line"><a name="l00764"></a><span class="lineno">  764</span>&#160;          <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l00765"></a><span class="lineno">  765</span>&#160;        }</div>
<div class="line"><a name="l00766"></a><span class="lineno">  766</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="../../d6/dca/classtrkf_1_1TrackKalmanFitter.html#acbd8f32e18621b3cc8387fc6f01fb190">dumpLevel_</a> &gt; 1) {</div>
<div class="line"><a name="l00767"></a><span class="lineno">  767</span>&#160;          <a class="code" href="../../d8/df5/messageservice_8fcl.html#a6699b4dbd72f548e48d81c88697d35a6">std::cout</a> &lt;&lt; <span class="stringliteral">&quot;updated state &quot;</span> &lt;&lt; std::endl;</div>
<div class="line"><a name="l00768"></a><span class="lineno">  768</span>&#160;          trackState.dump();</div>
<div class="line"><a name="l00769"></a><span class="lineno">  769</span>&#160;        }</div>
<div class="line"><a name="l00770"></a><span class="lineno">  770</span>&#160;        <span class="comment">// Keep a copy in case a future propagation fails</span></div>
<div class="line"><a name="l00771"></a><span class="lineno">  771</span>&#160;        startState = trackState;</div>
<div class="line"><a name="l00772"></a><span class="lineno">  772</span>&#160;        <span class="comment">//</span></div>
<div class="line"><a name="l00773"></a><span class="lineno">  773</span>&#160;        nvalidhits++;</div>
<div class="line"><a name="l00774"></a><span class="lineno">  774</span>&#160;      }</div>
<div class="line"><a name="l00775"></a><span class="lineno">  775</span>&#160;      <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00776"></a><span class="lineno">  776</span>&#160;        fwdUpdTrackState = fwdPrdTrackState;</div>
<div class="line"><a name="l00777"></a><span class="lineno">  777</span>&#160;      }</div>
<div class="line"><a name="l00778"></a><span class="lineno">  778</span>&#160;    }</div>
<div class="line"><a name="l00779"></a><span class="lineno">  779</span>&#160;    <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00780"></a><span class="lineno">  780</span>&#160;      <span class="comment">// ok, if the backward propagation failed we exclude this point from the rest of the fit,</span></div>
<div class="line"><a name="l00781"></a><span class="lineno">  781</span>&#160;      <span class="comment">// but we can still use its position from the forward fit, so just mark it as ExcludedFromFit</span></div>
<div class="line"><a name="l00782"></a><span class="lineno">  782</span>&#160;      hitflags.set(<a class="code" href="../../d4/dff/structrecob_1_1TrajectoryPointFlagTraits.html#a52e1b0d7701ede6b439780ccfe24dcf6">recob::TrajectoryPointFlagTraits::ExcludedFromFit</a>);</div>
<div class="line"><a name="l00783"></a><span class="lineno">  783</span>&#160;      hitflags.set(</div>
<div class="line"><a name="l00784"></a><span class="lineno">  784</span>&#160;        <a class="code" href="../../d4/dff/structrecob_1_1TrajectoryPointFlagTraits.html#a7a1b836f14bde0eb20ca4da2ead61a53">recob::TrajectoryPointFlagTraits::NoPoint</a>); <span class="comment">// fixme: this is only for event display, also</span></div>
<div class="line"><a name="l00785"></a><span class="lineno">  785</span>&#160;                                                    <span class="comment">// needed by current definition of ValidPoint</span></div>
<div class="line"><a name="l00786"></a><span class="lineno">  786</span>&#160;      <span class="keywordflow">if</span> (<a class="code" href="../../d6/dca/classtrkf_1_1TrackKalmanFitter.html#acbd8f32e18621b3cc8387fc6f01fb190">dumpLevel_</a> &gt; 0)</div>
<div class="line"><a name="l00787"></a><span class="lineno">  787</span>&#160;        <a class="code" href="../../d8/df5/messageservice_8fcl.html#a6699b4dbd72f548e48d81c88697d35a6">std::cout</a> &lt;&lt; <span class="stringliteral">&quot;WARNING: backward propagation failed. Skip this hit... hitstateidx[itk]=&quot;</span></div>
<div class="line"><a name="l00788"></a><span class="lineno">  788</span>&#160;                  &lt;&lt; hitstateidx[itk] &lt;&lt; <span class="stringliteral">&quot; itk=&quot;</span> &lt;&lt; itk &lt;&lt; std::endl;</div>
<div class="line"><a name="l00789"></a><span class="lineno">  789</span>&#160;      ;</div>
<div class="line"><a name="l00790"></a><span class="lineno">  790</span>&#160;      <span class="comment">// restore the last successful propagation</span></div>
<div class="line"><a name="l00791"></a><span class="lineno">  791</span>&#160;      trackState = startState;</div>
<div class="line"><a name="l00792"></a><span class="lineno">  792</span>&#160;      <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l00793"></a><span class="lineno">  793</span>&#160;    }</div>
<div class="line"><a name="l00794"></a><span class="lineno">  794</span>&#160;  } <span class="comment">//for (unsigned int itk = fwdPrdTkState.size()-1; itk&gt;=0; itk--) {</span></div>
<div class="line"><a name="l00795"></a><span class="lineno">  795</span>&#160;</div>
<div class="line"><a name="l00796"></a><span class="lineno">  796</span>&#160;  <span class="keywordflow">if</span> (nvalidhits &lt; 4) {</div>
<div class="line"><a name="l00797"></a><span class="lineno">  797</span>&#160;    mf::LogWarning(<span class="stringliteral">&quot;TrackKalmanFitter&quot;</span>) &lt;&lt; <span class="stringliteral">&quot;Fit failure at &quot;</span> &lt;&lt; __FILE__ &lt;&lt; <span class="stringliteral">&quot; &quot;</span> &lt;&lt; __LINE__ &lt;&lt; <span class="stringliteral">&quot; &quot;</span>;</div>
<div class="line"><a name="l00798"></a><span class="lineno">  798</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l00799"></a><span class="lineno">  799</span>&#160;  }</div>
<div class="line"><a name="l00800"></a><span class="lineno">  800</span>&#160;</div>
<div class="line"><a name="l00801"></a><span class="lineno">  801</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="../../d6/dca/classtrkf_1_1TrackKalmanFitter.html#acbd8f32e18621b3cc8387fc6f01fb190">dumpLevel_</a> &gt; 1) <a class="code" href="../../d8/df5/messageservice_8fcl.html#a6699b4dbd72f548e48d81c88697d35a6">std::cout</a> &lt;&lt; <span class="stringliteral">&quot;sort output with nvalidhits=&quot;</span> &lt;&lt; nvalidhits &lt;&lt; std::endl;</div>
<div class="line"><a name="l00802"></a><span class="lineno">  802</span>&#160;</div>
<div class="line"><a name="l00803"></a><span class="lineno">  803</span>&#160;  <span class="comment">// sort output states</span></div>
<div class="line"><a name="l00804"></a><span class="lineno">  804</span>&#160;  <a class="code" href="../../d6/dca/classtrkf_1_1TrackKalmanFitter.html#a1234a68e20de47fcd42999626d6c07e4">sortOutput</a>(</div>
<div class="line"><a name="l00805"></a><span class="lineno">  805</span>&#160;    hitstatev, fwdUpdTkState, hitstateidx, rejectedhsidx, sortedtksidx, hitflagsv, applySkipClean);</div>
<div class="line"><a name="l00806"></a><span class="lineno">  806</span>&#160;  <span class="keywordtype">size_t</span> nsortvalid = 0;</div>
<div class="line"><a name="l00807"></a><span class="lineno">  807</span>&#160;  <span class="keywordflow">for</span> (<span class="keyword">auto</span>&amp; idx : sortedtksidx) {</div>
<div class="line"><a name="l00808"></a><span class="lineno">  808</span>&#160;    <span class="keyword">auto</span>&amp; hitflags = hitflagsv[hitstateidx[idx]];</div>
<div class="line"><a name="l00809"></a><span class="lineno">  809</span>&#160;    <span class="keywordflow">if</span> (hitflags.isSet(<a class="code" href="../../d4/dff/structrecob_1_1TrajectoryPointFlagTraits.html#a52e1b0d7701ede6b439780ccfe24dcf6">recob::TrajectoryPointFlagTraits::ExcludedFromFit</a>) == 0) nsortvalid++;</div>
<div class="line"><a name="l00810"></a><span class="lineno">  810</span>&#160;  }</div>
<div class="line"><a name="l00811"></a><span class="lineno">  811</span>&#160;  <span class="keywordflow">if</span> (nsortvalid &lt; 4) {</div>
<div class="line"><a name="l00812"></a><span class="lineno">  812</span>&#160;    mf::LogWarning(<span class="stringliteral">&quot;TrackKalmanFitter&quot;</span>) &lt;&lt; <span class="stringliteral">&quot;Fit failure at &quot;</span> &lt;&lt; __FILE__ &lt;&lt; <span class="stringliteral">&quot; &quot;</span> &lt;&lt; __LINE__ &lt;&lt; <span class="stringliteral">&quot; &quot;</span>;</div>
<div class="line"><a name="l00813"></a><span class="lineno">  813</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l00814"></a><span class="lineno">  814</span>&#160;  }</div>
<div class="line"><a name="l00815"></a><span class="lineno">  815</span>&#160;</div>
<div class="line"><a name="l00816"></a><span class="lineno">  816</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="../../d6/dca/classtrkf_1_1TrackKalmanFitter.html#acbd8f32e18621b3cc8387fc6f01fb190">dumpLevel_</a> &gt; 2) assert(rejectedhsidx.size() + sortedtksidx.size() == hitstatev.size());</div>
<div class="line"><a name="l00817"></a><span class="lineno">  817</span>&#160;  <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l00818"></a><span class="lineno">  818</span>&#160;}</div>
<div class="ttc" id="structrecob_1_1TrajectoryPointFlagTraits_html_a1760e570fd2707dae33daae0d530f600"><div class="ttname"><a href="../../d4/dff/structrecob_1_1TrajectoryPointFlagTraits.html#a1760e570fd2707dae33daae0d530f600">recob::TrajectoryPointFlagTraits::Merged</a></div><div class="ttdeci">static constexpr Flag_t Merged</div><div class="ttdoc">The hit might have contribution from particles other than this. </div><div class="ttdef"><b>Definition:</b> <a href="../../dd/d67/TrajectoryPointFlags_8h_source.html#l00132">TrajectoryPointFlags.h:132</a></div></div>
<div class="ttc" id="structrecob_1_1TrajectoryPointFlagTraits_html_a243c05ec9753836bcef283ecc16f8a00"><div class="ttname"><a href="../../d4/dff/structrecob_1_1TrajectoryPointFlagTraits.html#a243c05ec9753836bcef283ecc16f8a00">recob::TrajectoryPointFlagTraits::Suspicious</a></div><div class="ttdeci">static constexpr Flag_t Suspicious</div><div class="ttdoc">The point reconstruction is somehow questionable. </div><div class="ttdef"><b>Definition:</b> <a href="../../dd/d67/TrajectoryPointFlags_8h_source.html#l00129">TrajectoryPointFlags.h:129</a></div></div>
<div class="ttc" id="structrecob_1_1TrajectoryPointFlagTraits_html_a7a1b836f14bde0eb20ca4da2ead61a53"><div class="ttname"><a href="../../d4/dff/structrecob_1_1TrajectoryPointFlagTraits.html#a7a1b836f14bde0eb20ca4da2ead61a53">recob::TrajectoryPointFlagTraits::NoPoint</a></div><div class="ttdeci">static constexpr Flag_t NoPoint</div><div class="ttdoc">The trajectory point is not defined. </div><div class="ttdef"><b>Definition:</b> <a href="../../dd/d67/TrajectoryPointFlags_8h_source.html#l00119">TrajectoryPointFlags.h:119</a></div></div>
<div class="ttc" id="classtrkf_1_1TrackKalmanFitter_html_ae5732efc6840b8ee63c1da7cae12dc92"><div class="ttname"><a href="../../d6/dca/classtrkf_1_1TrackKalmanFitter.html#ae5732efc6840b8ee63c1da7cae12dc92">trkf::TrackKalmanFitter::pickBestHitOnWire_</a></div><div class="ttdeci">bool pickBestHitOnWire_</div><div class="ttdef"><b>Definition:</b> <a href="../../d7/dcf/TrackKalmanFitter_8h_source.html#l00312">TrackKalmanFitter.h:312</a></div></div>
<div class="ttc" id="classtrkf_1_1TrackKalmanFitter_html_a444bcfb6fd6cdf59ae68f7ee2c366368"><div class="ttname"><a href="../../d6/dca/classtrkf_1_1TrackKalmanFitter.html#a444bcfb6fd6cdf59ae68f7ee2c366368">trkf::TrackKalmanFitter::sortHitsByPlane_</a></div><div class="ttdeci">bool sortHitsByPlane_</div><div class="ttdef"><b>Definition:</b> <a href="../../d7/dcf/TrackKalmanFitter_8h_source.html#l00302">TrackKalmanFitter.h:302</a></div></div>
<div class="ttc" id="classtrkf_1_1TrackKalmanFitter_html_a32e405aa0e9672abe0f28d28d3af8777"><div class="ttname"><a href="../../d6/dca/classtrkf_1_1TrackKalmanFitter.html#a32e405aa0e9672abe0f28d28d3af8777">trkf::TrackKalmanFitter::maxChi2_</a></div><div class="ttdeci">float maxChi2_</div><div class="ttdef"><b>Definition:</b> <a href="../../d7/dcf/TrackKalmanFitter_8h_source.html#l00315">TrackKalmanFitter.h:315</a></div></div>
<div class="ttc" id="classtrkf_1_1TrackKalmanFitter_html_a3637c0f4a1ead3c751c0a4cc687facdc"><div class="ttname"><a href="../../d6/dca/classtrkf_1_1TrackKalmanFitter.html#a3637c0f4a1ead3c751c0a4cc687facdc">trkf::TrackKalmanFitter::maxDist_</a></div><div class="ttdeci">float maxDist_</div><div class="ttdef"><b>Definition:</b> <a href="../../d7/dcf/TrackKalmanFitter_8h_source.html#l00316">TrackKalmanFitter.h:316</a></div></div>
<div class="ttc" id="classtrkf_1_1TrackKalmanFitter_html_aa38e65d72933ec4e4ff502510d9b3c12"><div class="ttname"><a href="../../d6/dca/classtrkf_1_1TrackKalmanFitter.html#aa38e65d72933ec4e4ff502510d9b3c12">trkf::TrackKalmanFitter::sortHitsByWire_</a></div><div class="ttdeci">bool sortHitsByWire_</div><div class="ttdef"><b>Definition:</b> <a href="../../d7/dcf/TrackKalmanFitter_8h_source.html#l00303">TrackKalmanFitter.h:303</a></div></div>
<div class="ttc" id="selectors_8fcl_html_a24c8335057af14a9b508d5ac18999ce5"><div class="ttname"><a href="../../d9/dd2/selectors_8fcl.html#a24c8335057af14a9b508d5ac18999ce5">p</a></div><div class="ttdeci">pdgs p</div><div class="ttdef"><b>Definition:</b> <a href="../../d9/dd2/selectors_8fcl_source.html#l00022">selectors.fcl:22</a></div></div>
<div class="ttc" id="classtrkf_1_1TrackStatePropagator_html_ae5eff788f74ea79d40466328fd943a1ba815fdae095e62f7826692abe63e9e458"><div class="ttname"><a href="../../dc/d5e/classtrkf_1_1TrackStatePropagator.html#ae5eff788f74ea79d40466328fd943a1ba815fdae095e62f7826692abe63e9e458">trkf::TrackStatePropagator::BACKWARD</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d3/d9d/TrackStatePropagator_8h_source.html#l00073">TrackStatePropagator.h:73</a></div></div>
<div class="ttc" id="structrecob_1_1TrajectoryPointFlagTraits_html"><div class="ttname"><a href="../../d4/dff/structrecob_1_1TrajectoryPointFlagTraits.html">recob::TrajectoryPointFlagTraits</a></div><div class="ttdoc">Namespace for the trajectory point flags. </div><div class="ttdef"><b>Definition:</b> <a href="../../dd/d67/TrajectoryPointFlags_8h_source.html#l00058">TrajectoryPointFlags.h:58</a></div></div>
<div class="ttc" id="classtrkf_1_1TrackKalmanFitter_html_a16bded3d3b4f7d0602c76a5b105af9f6"><div class="ttname"><a href="../../d6/dca/classtrkf_1_1TrackKalmanFitter.html#a16bded3d3b4f7d0602c76a5b105af9f6">trkf::TrackKalmanFitter::geom</a></div><div class="ttdeci">art::ServiceHandle&lt; geo::Geometry const  &gt; geom</div><div class="ttdef"><b>Definition:</b> <a href="../../d7/dcf/TrackKalmanFitter_8h_source.html#l00299">TrackKalmanFitter.h:299</a></div></div>
<div class="ttc" id="classtrkf_1_1TrackStatePropagator_html_ae46e7c518db95bfca7418cd582682c95"><div class="ttname"><a href="../../dc/d5e/classtrkf_1_1TrackStatePropagator.html#ae46e7c518db95bfca7418cd582682c95">trkf::TrackStatePropagator::propagateToPlane</a></div><div class="ttdeci">TrackState propagateToPlane(bool &amp;success, const detinfo::DetectorPropertiesData &amp;detProp, const TrackState &amp;origin, const Plane &amp;target, bool dodedx, bool domcs, PropDirection dir=FORWARD) const </div><div class="ttdoc">Main function for propagation of a TrackState to a Plane. </div><div class="ttdef"><b>Definition:</b> <a href="../../d8/d00/TrackStatePropagator_8cxx_source.html#l00030">TrackStatePropagator.cxx:30</a></div></div>
<div class="ttc" id="classtrkf_1_1TrackStatePropagator_html_ab4f06dfff7579a24d5748096cb49bf06"><div class="ttname"><a href="../../dc/d5e/classtrkf_1_1TrackStatePropagator.html#ab4f06dfff7579a24d5748096cb49bf06">trkf::TrackStatePropagator::distanceToPlane</a></div><div class="ttdeci">double distanceToPlane(bool &amp;success, const Point_t &amp;origpos, const Vector_t &amp;origdir, const Plane &amp;target) const </div><div class="ttdoc">Distance of a TrackState (Point and Vector) to a Plane, along the TrackState direction. </div><div class="ttdef"><b>Definition:</b> <a href="../../d8/d00/TrackStatePropagator_8cxx_source.html#l00216">TrackStatePropagator.cxx:216</a></div></div>
<div class="ttc" id="classtrkf_1_1TrackKalmanFitter_html_a1234a68e20de47fcd42999626d6c07e4"><div class="ttname"><a href="../../d6/dca/classtrkf_1_1TrackKalmanFitter.html#a1234a68e20de47fcd42999626d6c07e4">trkf::TrackKalmanFitter::sortOutput</a></div><div class="ttdeci">void sortOutput(std::vector&lt; HitState &gt; &amp;hitstatev, std::vector&lt; KFTrackState &gt; &amp;fwdUpdTkState, std::vector&lt; unsigned int &gt; &amp;hitstateidx, std::vector&lt; unsigned int &gt; &amp;rejectedhsidx, std::vector&lt; unsigned int &gt; &amp;sortedtksidx, std::vector&lt; recob::TrajectoryPointFlags::Mask_t &gt; &amp;hitflagsv, bool applySkipClean=true) const </div><div class="ttdoc">Sort the output states. </div><div class="ttdef"><b>Definition:</b> <a href="../../de/d68/TrackKalmanFitter_8cxx_source.html#l00821">TrackKalmanFitter.cxx:821</a></div></div>
<div class="ttc" id="classtrkf_1_1TrackKalmanFitter_html_acbd8f32e18621b3cc8387fc6f01fb190"><div class="ttname"><a href="../../d6/dca/classtrkf_1_1TrackKalmanFitter.html#acbd8f32e18621b3cc8387fc6f01fb190">trkf::TrackKalmanFitter::dumpLevel_</a></div><div class="ttdeci">int dumpLevel_</div><div class="ttdef"><b>Definition:</b> <a href="../../d7/dcf/TrackKalmanFitter_8h_source.html#l00318">TrackKalmanFitter.h:318</a></div></div>
<div class="ttc" id="decode__signalprocess__icarus_8fcl_html_a2a105cb669129f9c63eb7a4c15bf2d9b"><div class="ttname"><a href="../../d0/d8f/decode__signalprocess__icarus_8fcl.html#a2a105cb669129f9c63eb7a4c15bf2d9b">a</a></div><div class="ttdeci">process_name gaushit a</div><div class="ttdef"><b>Definition:</b> <a href="../../d0/d8f/decode__signalprocess__icarus_8fcl_source.html#l00037">decode_signalprocess_icarus.fcl:37</a></div></div>
<div class="ttc" id="classtrkf_1_1TrackKalmanFitter_html_ad91dc22bc6789376670625e65803e70a"><div class="ttname"><a href="../../d6/dca/classtrkf_1_1TrackKalmanFitter.html#ad91dc22bc6789376670625e65803e70a">trkf::TrackKalmanFitter::maxResidue_</a></div><div class="ttdeci">float maxResidue_</div><div class="ttdef"><b>Definition:</b> <a href="../../d7/dcf/TrackKalmanFitter_8h_source.html#l00313">TrackKalmanFitter.h:313</a></div></div>
<div class="ttc" id="getStatistics_8sh_html_a04d4c2131ccb24cc78386597e8a21c5b"><div class="ttname"><a href="../../dd/de2/getStatistics_8sh.html#a04d4c2131ccb24cc78386597e8a21c5b">h</a></div><div class="ttdeci">while getopts h</div><div class="ttdef"><b>Definition:</b> <a href="../../dd/de2/getStatistics_8sh_source.html#l00013">getStatistics.sh:13</a></div></div>
<div class="ttc" id="sparse__vector__test_8cc_html_a39f16bf854ba527dee7eba5bbbd93f3f"><div class="ttname"><a href="../../dd/d59/sparse__vector__test_8cc.html#a39f16bf854ba527dee7eba5bbbd93f3f">abs</a></div><div class="ttdeci">T abs(T value)</div><div class="ttdef"><b>Definition:</b> <a href="../../dd/d59/sparse__vector__test_8cc_source.html#l00030">sparse_vector_test.cc:30</a></div></div>
<div class="ttc" id="classtrkf_1_1TrackStatePropagator_html_ae5eff788f74ea79d40466328fd943a1ba6351b029d52cf3f64d523db56d4a532a"><div class="ttname"><a href="../../dc/d5e/classtrkf_1_1TrackStatePropagator.html#ae5eff788f74ea79d40466328fd943a1ba6351b029d52cf3f64d523db56d4a532a">trkf::TrackStatePropagator::FORWARD</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d3/d9d/TrackStatePropagator_8h_source.html#l00073">TrackStatePropagator.h:73</a></div></div>
<div class="ttc" id="classtrkf_1_1TrackKalmanFitter_html_a2efa447160c8b4b0cb5fddc93cd05352"><div class="ttname"><a href="../../d6/dca/classtrkf_1_1TrackKalmanFitter.html#a2efa447160c8b4b0cb5fddc93cd05352">trkf::TrackKalmanFitter::negDistTolerance_</a></div><div class="ttdeci">float negDistTolerance_</div><div class="ttdef"><b>Definition:</b> <a href="../../d7/dcf/TrackKalmanFitter_8h_source.html#l00317">TrackKalmanFitter.h:317</a></div></div>
<div class="ttc" id="namespaceicarus_1_1ns_1_1util_html_aac918da84f16d53ad17bab4f817da1c4"><div class="ttname"><a href="../../d5/d62/namespaceicarus_1_1ns_1_1util.html#aac918da84f16d53ad17bab4f817da1c4">icarus::ns::util::end</a></div><div class="ttdeci">auto end(FixedBins&lt; T, C &gt; const &amp;) noexcept</div><div class="ttdef"><b>Definition:</b> <a href="../../d3/dbd/FixedBins_8h_source.html#l00585">FixedBins.h:585</a></div></div>
<div class="ttc" id="classtrkf_1_1TrackKalmanFitter_html_a029821569a62274483456d270d7cd7e8"><div class="ttname"><a href="../../d6/dca/classtrkf_1_1TrackKalmanFitter.html#a029821569a62274483456d270d7cd7e8">trkf::TrackKalmanFitter::propagator</a></div><div class="ttdeci">const TrackStatePropagator * propagator</div><div class="ttdef"><b>Definition:</b> <a href="../../d7/dcf/TrackKalmanFitter_8h_source.html#l00300">TrackKalmanFitter.h:300</a></div></div>
<div class="ttc" id="structrecob_1_1TrajectoryPointFlagTraits_html_a1ed6fcc21f6cf9a22bd3134bc6c9a460"><div class="ttname"><a href="../../d4/dff/structrecob_1_1TrajectoryPointFlagTraits.html#a1ed6fcc21f6cf9a22bd3134bc6c9a460">recob::TrajectoryPointFlagTraits::HitIgnored</a></div><div class="ttdeci">static constexpr Flag_t HitIgnored</div><div class="ttdoc">Hit was not included for the computation of the trajectory. </div><div class="ttdef"><b>Definition:</b> <a href="../../dd/d67/TrajectoryPointFlags_8h_source.html#l00116">TrajectoryPointFlags.h:116</a></div></div>
<div class="ttc" id="structrecob_1_1TrajectoryPointFlagTraits_html_a06470c4691580dc3c0414f78f737aaf8"><div class="ttname"><a href="../../d4/dff/structrecob_1_1TrajectoryPointFlagTraits.html#a06470c4691580dc3c0414f78f737aaf8">recob::TrajectoryPointFlagTraits::Rejected</a></div><div class="ttdeci">static constexpr Flag_t Rejected</div><div class="ttdoc">The hit is extraneous to this track. </div><div class="ttdef"><b>Definition:</b> <a href="../../dd/d67/TrajectoryPointFlags_8h_source.html#l00172">TrajectoryPointFlags.h:172</a></div></div>
<div class="ttc" id="structrecob_1_1TrajectoryPointFlagTraits_html_a52e1b0d7701ede6b439780ccfe24dcf6"><div class="ttname"><a href="../../d4/dff/structrecob_1_1TrajectoryPointFlagTraits.html#a52e1b0d7701ede6b439780ccfe24dcf6">recob::TrajectoryPointFlagTraits::ExcludedFromFit</a></div><div class="ttdeci">static constexpr Flag_t ExcludedFromFit</div><div class="ttdef"><b>Definition:</b> <a href="../../dd/d67/TrajectoryPointFlags_8h_source.html#l00169">TrajectoryPointFlags.h:169</a></div></div>
<div class="ttc" id="namespaceicarus_1_1ns_1_1util_html_acc1957472e01a8d9ecd245e26338f0b9"><div class="ttname"><a href="../../d5/d62/namespaceicarus_1_1ns_1_1util.html#acc1957472e01a8d9ecd245e26338f0b9">icarus::ns::util::begin</a></div><div class="ttdeci">auto begin(FixedBins&lt; T, C &gt; const &amp;) noexcept</div><div class="ttdef"><b>Definition:</b> <a href="../../d3/dbd/FixedBins_8h_source.html#l00573">FixedBins.h:573</a></div></div>
<div class="ttc" id="classtrkf_1_1TrackKalmanFitter_html_a796c8a2d3ee31f64c073dca95a009964"><div class="ttname"><a href="../../d6/dca/classtrkf_1_1TrackKalmanFitter.html#a796c8a2d3ee31f64c073dca95a009964">trkf::TrackKalmanFitter::maxResidueFirstHit_</a></div><div class="ttdeci">float maxResidueFirstHit_</div><div class="ttdef"><b>Definition:</b> <a href="../../d7/dcf/TrackKalmanFitter_8h_source.html#l00314">TrackKalmanFitter.h:314</a></div></div>
<div class="ttc" id="namespacelarg4_html_a3b23adbb58bc71f7c54806914226f1f8"><div class="ttname"><a href="../../d7/d6f/namespacelarg4.html#a3b23adbb58bc71f7c54806914226f1f8">larg4::dist</a></div><div class="ttdeci">constexpr double dist(const TReal *x, const TReal *y, const unsigned int dimension)</div><div class="ttdef"><b>Definition:</b> <a href="../../d6/d8a/OpFastScintillation_8hh_source.html#l00563">OpFastScintillation.hh:563</a></div></div>
<div class="ttc" id="structrecob_1_1TrajectoryPointFlagTraits_html_ab75fdf48bb4efcd78d060123086c0c7b"><div class="ttname"><a href="../../d4/dff/structrecob_1_1TrajectoryPointFlagTraits.html#ab75fdf48bb4efcd78d060123086c0c7b">recob::TrajectoryPointFlagTraits::DetectorIssue</a></div><div class="ttdeci">static constexpr Flag_t DetectorIssue</div><div class="ttdoc">The hit is associated to a problematic channel. </div><div class="ttdef"><b>Definition:</b> <a href="../../dd/d67/TrajectoryPointFlags_8h_source.html#l00138">TrajectoryPointFlags.h:138</a></div></div>
<div class="ttc" id="structrecob_1_1TrajectoryPointFlagTraits_html_aceef1d4ad4539248ca582a625e2b30b0"><div class="ttname"><a href="../../d4/dff/structrecob_1_1TrajectoryPointFlagTraits.html#aceef1d4ad4539248ca582a625e2b30b0">recob::TrajectoryPointFlagTraits::DeltaRay</a></div><div class="ttdeci">static constexpr Flag_t DeltaRay</div><div class="ttdoc">The hit might have contribution from a  ray. </div><div class="ttdef"><b>Definition:</b> <a href="../../dd/d67/TrajectoryPointFlags_8h_source.html#l00135">TrajectoryPointFlags.h:135</a></div></div>
<div class="ttc" id="classtrkf_1_1TrackKalmanFitter_html_a439ce5d209c8590832ce4c5612dbf7b7"><div class="ttname"><a href="../../d6/dca/classtrkf_1_1TrackKalmanFitter.html#a439ce5d209c8590832ce4c5612dbf7b7">trkf::TrackKalmanFitter::skipNegProp_</a></div><div class="ttdeci">bool skipNegProp_</div><div class="ttdef"><b>Definition:</b> <a href="../../d7/dcf/TrackKalmanFitter_8h_source.html#l00305">TrackKalmanFitter.h:305</a></div></div>
<div class="ttc" id="structrecob_1_1TrajectoryPointFlagTraits_html_ab2d2e96ad3ccc48951e04a26e32c15b0"><div class="ttname"><a href="../../d4/dff/structrecob_1_1TrajectoryPointFlagTraits.html#ab2d2e96ad3ccc48951e04a26e32c15b0">recob::TrajectoryPointFlagTraits::Shared</a></div><div class="ttdeci">static constexpr Flag_t Shared</div><div class="ttdoc">The hit is known to be associated also to another trajectory. </div><div class="ttdef"><b>Definition:</b> <a href="../../dd/d67/TrajectoryPointFlags_8h_source.html#l00141">TrajectoryPointFlags.h:141</a></div></div>
<div class="ttc" id="PMAlgTracking_8cxx_html_aba288dcf8037152d32ec29330d952878"><div class="ttname"><a href="../../db/dfa/PMAlgTracking_8cxx.html#aba288dcf8037152d32ec29330d952878">Vector_t</a></div><div class="ttdeci">recob::tracking::Vector_t Vector_t</div><div class="ttdef"><b>Definition:</b> <a href="../../db/dfa/PMAlgTracking_8cxx_source.html#l00021">PMAlgTracking.cxx:21</a></div></div>
<div class="ttc" id="messageservice_8fcl_html_a6699b4dbd72f548e48d81c88697d35a6"><div class="ttname"><a href="../../d8/df5/messageservice_8fcl.html#a6699b4dbd72f548e48d81c88697d35a6">cout</a></div><div class="ttdeci">BEGIN_PROLOG could also be cout</div><div class="ttdef"><b>Definition:</b> <a href="../../d8/df5/messageservice_8fcl_source.html#l00010">messageservice.fcl:10</a></div></div>
<div class="ttc" id="namespacedetsim_html_a560adbb3abf95a23d45a53ed25d8c0c7"><div class="ttname"><a href="../../d2/d1a/namespacedetsim.html#a560adbb3abf95a23d45a53ed25d8c0c7">detsim::detProp</a></div><div class="ttdeci">auto const detProp</div><div class="ttdef"><b>Definition:</b> <a href="../../d9/df8/SimWire__module_8cc_source.html#l00157">SimWire_module.cc:157</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a84c42d9dadf9523f2261042da5bead99"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">bool trkf::TrackKalmanFitter::fillResult </td>
          <td>(</td>
          <td class="paramtype">const std::vector&lt; art::Ptr&lt; <a class="el" href="../../db/d4e/classrecob_1_1Hit.html">recob::Hit</a> &gt;&gt; &amp;&#160;</td>
          <td class="paramname"><em>inHits</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const int&#160;</td>
          <td class="paramname"><em>tkID</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const int&#160;</td>
          <td class="paramname"><em>pdgid</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">std::vector&lt; <a class="el" href="../../da/d57/classtrkf_1_1HitState.html">HitState</a> &gt; &amp;&#160;</td>
          <td class="paramname"><em>hitstatev</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">std::vector&lt; <a class="el" href="../../d3/d86/classrecob_1_1TrajectoryPointFlags.html#a1fa59abb69bb752ec069798b2f3b8202">recob::TrajectoryPointFlags::Mask_t</a> &gt; &amp;&#160;</td>
          <td class="paramname"><em>hitflagsv</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">std::vector&lt; <a class="el" href="../../d3/d02/classtrkf_1_1KFTrackState.html">KFTrackState</a> &gt; &amp;&#160;</td>
          <td class="paramname"><em>fwdPrdTkState</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">std::vector&lt; <a class="el" href="../../d3/d02/classtrkf_1_1KFTrackState.html">KFTrackState</a> &gt; &amp;&#160;</td>
          <td class="paramname"><em>fwdUpdTkState</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">std::vector&lt; unsigned int &gt; &amp;&#160;</td>
          <td class="paramname"><em>hitstateidx</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">std::vector&lt; unsigned int &gt; &amp;&#160;</td>
          <td class="paramname"><em>rejectedhsidx</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">std::vector&lt; unsigned int &gt; &amp;&#160;</td>
          <td class="paramname"><em>sortedtksidx</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="../../d9/dca/classrecob_1_1Track.html">recob::Track</a> &amp;&#160;</td>
          <td class="paramname"><em>outTrack</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">std::vector&lt; art::Ptr&lt; <a class="el" href="../../db/d4e/classrecob_1_1Hit.html">recob::Hit</a> &gt;&gt; &amp;&#160;</td>
          <td class="paramname"><em>outHits</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="../../d0/d41/structtrkmkr_1_1OptionalOutputs.html">trkmkr::OptionalOutputs</a> &amp;&#160;</td>
          <td class="paramname"><em>optionals</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td> const</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Fill the output objects. </p>

<p>Definition at line <a class="el" href="../../de/d68/TrackKalmanFitter_8cxx_source.html#l00946">946</a> of file <a class="el" href="../../de/d68/TrackKalmanFitter_8cxx_source.html">TrackKalmanFitter.cxx</a>.</p>
<div class="fragment"><div class="line"><a name="l00959"></a><span class="lineno">  959</span>&#160;{</div>
<div class="line"><a name="l00960"></a><span class="lineno">  960</span>&#160;  <span class="comment">// fill output trajectory objects with smoothed track and its hits</span></div>
<div class="line"><a name="l00961"></a><span class="lineno">  961</span>&#160;  <span class="keywordtype">int</span> nvalidhits = 0;</div>
<div class="line"><a name="l00962"></a><span class="lineno">  962</span>&#160;  <a class="code" href="../../df/dd3/classtrkmkr_1_1TrackCreationBookKeeper.html">trkmkr::TrackCreationBookKeeper</a> tcbk(outHits, optionals, tkID, pdgid, <span class="keyword">true</span>);</div>
<div class="line"><a name="l00963"></a><span class="lineno">  963</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="../../d9/dd2/selectors_8fcl.html#a24c8335057af14a9b508d5ac18999ce5">p</a> : sortedtksidx) {</div>
<div class="line"><a name="l00964"></a><span class="lineno">  964</span>&#160;    <span class="keyword">const</span> <span class="keyword">auto</span>&amp; trackstate = fwdUpdTkState[<a class="code" href="../../d9/dd2/selectors_8fcl.html#a24c8335057af14a9b508d5ac18999ce5">p</a>];</div>
<div class="line"><a name="l00965"></a><span class="lineno">  965</span>&#160;    <span class="keyword">const</span> <span class="keyword">auto</span>&amp; hitflags = hitflagsv[hitstateidx[<a class="code" href="../../d9/dd2/selectors_8fcl.html#a24c8335057af14a9b508d5ac18999ce5">p</a>]];</div>
<div class="line"><a name="l00966"></a><span class="lineno">  966</span>&#160;    <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> originalPos = hitstateidx[<a class="code" href="../../d9/dd2/selectors_8fcl.html#a24c8335057af14a9b508d5ac18999ce5">p</a>];</div>
<div class="line"><a name="l00967"></a><span class="lineno">  967</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="../../d6/dca/classtrkf_1_1TrackKalmanFitter.html#acbd8f32e18621b3cc8387fc6f01fb190">dumpLevel_</a> &gt; 2) assert(originalPos &gt;= 0 &amp;&amp; originalPos &lt; hitstatev.size());</div>
<div class="line"><a name="l00968"></a><span class="lineno">  968</span>&#160;    <span class="comment">//</span></div>
<div class="line"><a name="l00969"></a><span class="lineno">  969</span>&#160;    <span class="keyword">const</span> <span class="keyword">auto</span>&amp; prdtrack = fwdPrdTkState[<a class="code" href="../../d9/dd2/selectors_8fcl.html#a24c8335057af14a9b508d5ac18999ce5">p</a>];</div>
<div class="line"><a name="l00970"></a><span class="lineno">  970</span>&#160;    <span class="keyword">const</span> <span class="keyword">auto</span>&amp; hitstate = hitstatev[hitstateidx[<a class="code" href="../../d9/dd2/selectors_8fcl.html#a24c8335057af14a9b508d5ac18999ce5">p</a>]];</div>
<div class="line"><a name="l00971"></a><span class="lineno">  971</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="../../d6/dca/classtrkf_1_1TrackKalmanFitter.html#acbd8f32e18621b3cc8387fc6f01fb190">dumpLevel_</a> &gt; 2) assert(hitstate.wireId().Plane == inHits[originalPos]-&gt;WireID().Plane);</div>
<div class="line"><a name="l00972"></a><span class="lineno">  972</span>&#160;    <span class="comment">//</span></div>
<div class="line"><a name="l00973"></a><span class="lineno">  973</span>&#160;    <span class="keywordtype">float</span> chi2 =</div>
<div class="line"><a name="l00974"></a><span class="lineno">  974</span>&#160;      (hitflags.isSet(<a class="code" href="../../d4/dff/structrecob_1_1TrajectoryPointFlagTraits.html#a52e1b0d7701ede6b439780ccfe24dcf6">recob::TrajectoryPointFlagTraits::ExcludedFromFit</a>) ? -1. :</div>
<div class="line"><a name="l00975"></a><span class="lineno">  975</span>&#160;                                                                           prdtrack.chi2(hitstate));</div>
<div class="line"><a name="l00976"></a><span class="lineno">  976</span>&#160;    <span class="keywordflow">if</span> (hitflags.isSet(<a class="code" href="../../d4/dff/structrecob_1_1TrajectoryPointFlagTraits.html#a7a1b836f14bde0eb20ca4da2ead61a53">recob::TrajectoryPointFlagTraits::NoPoint</a>) == <span class="keyword">false</span>) nvalidhits++;</div>
<div class="line"><a name="l00977"></a><span class="lineno">  977</span>&#160;    <span class="comment">//</span></div>
<div class="line"><a name="l00978"></a><span class="lineno">  978</span>&#160;    <a class="code" href="../../db/d9c/structtrkmkr_1_1OptionalPointElement.html">trkmkr::OptionalPointElement</a> ope;</div>
<div class="line"><a name="l00979"></a><span class="lineno">  979</span>&#160;    <span class="keywordflow">if</span> (optionals.<a class="code" href="../../d0/d41/structtrkmkr_1_1OptionalOutputs.html#a67e40fa0c5a5119ca59c9cc7ad508c68">isTrackFitInfosInit</a>()) {</div>
<div class="line"><a name="l00980"></a><span class="lineno">  980</span>&#160;      ope.<a class="code" href="../../db/d9c/structtrkmkr_1_1OptionalPointElement.html#ab9b356956df77a52aa3be639d4de78db">setTrackFitHitInfo</a>(<a class="code" href="../../d8/d80/classrecob_1_1TrackFitHitInfo.html">recob::TrackFitHitInfo</a>(hitstate.hitMeas(),</div>
<div class="line"><a name="l00981"></a><span class="lineno">  981</span>&#160;                                                    hitstate.hitMeasErr2(),</div>
<div class="line"><a name="l00982"></a><span class="lineno">  982</span>&#160;                                                    prdtrack.parameters(),</div>
<div class="line"><a name="l00983"></a><span class="lineno">  983</span>&#160;                                                    prdtrack.covariance(),</div>
<div class="line"><a name="l00984"></a><span class="lineno">  984</span>&#160;                                                    hitstate.wireId()));</div>
<div class="line"><a name="l00985"></a><span class="lineno">  985</span>&#160;    }</div>
<div class="line"><a name="l00986"></a><span class="lineno">  986</span>&#160;    tcbk.addPoint(trackstate.position(),</div>
<div class="line"><a name="l00987"></a><span class="lineno">  987</span>&#160;                  trackstate.momentum(),</div>
<div class="line"><a name="l00988"></a><span class="lineno">  988</span>&#160;                  inHits[originalPos],</div>
<div class="line"><a name="l00989"></a><span class="lineno">  989</span>&#160;                  <a class="code" href="../../d3/d86/classrecob_1_1TrajectoryPointFlags.html">recob::TrajectoryPointFlags</a>(originalPos, hitflags),</div>
<div class="line"><a name="l00990"></a><span class="lineno">  990</span>&#160;                  chi2,</div>
<div class="line"><a name="l00991"></a><span class="lineno">  991</span>&#160;                  ope);</div>
<div class="line"><a name="l00992"></a><span class="lineno">  992</span>&#160;  }</div>
<div class="line"><a name="l00993"></a><span class="lineno">  993</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="../../d6/dca/classtrkf_1_1TrackKalmanFitter.html#acbd8f32e18621b3cc8387fc6f01fb190">dumpLevel_</a> &gt; 0) <a class="code" href="../../d8/df5/messageservice_8fcl.html#a6699b4dbd72f548e48d81c88697d35a6">std::cout</a> &lt;&lt; <span class="stringliteral">&quot;fillResult nvalidhits=&quot;</span> &lt;&lt; nvalidhits &lt;&lt; std::endl;</div>
<div class="line"><a name="l00994"></a><span class="lineno">  994</span>&#160;</div>
<div class="line"><a name="l00995"></a><span class="lineno">  995</span>&#160;  <span class="comment">// fill also with rejected hits information</span></div>
<div class="line"><a name="l00996"></a><span class="lineno">  996</span>&#160;  <a class="code" href="../../db/dfa/PMAlgTracking_8cxx.html#af99faac002e5718f9ea4ea0c456f6d72">SMatrixSym55</a> fakeCov55;</div>
<div class="line"><a name="l00997"></a><span class="lineno">  997</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; 5; i++)</div>
<div class="line"><a name="l00998"></a><span class="lineno">  998</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> j = i; j &lt; 5; j++)</div>
<div class="line"><a name="l00999"></a><span class="lineno">  999</span>&#160;      fakeCov55(i, j) = <a class="code" href="../../d6/d72/namespaceutil.html#a85007be2ce41bf247364673c302f8a5b">util::kBogusD</a>;</div>
<div class="line"><a name="l01000"></a><span class="lineno"> 1000</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> rejidx = 0; rejidx &lt; rejectedhsidx.size(); ++rejidx) {</div>
<div class="line"><a name="l01001"></a><span class="lineno"> 1001</span>&#160;    <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> originalPos = rejectedhsidx[rejidx];</div>
<div class="line"><a name="l01002"></a><span class="lineno"> 1002</span>&#160;    <span class="keyword">auto</span>&amp; <a class="code" href="../../de/d90/namespacesbn_1_1bits.html#a3b8fd0787ccd1963c6aa5c8bf17f4290">mask</a> = hitflagsv[rejectedhsidx[rejidx]];</div>
<div class="line"><a name="l01003"></a><span class="lineno"> 1003</span>&#160;    <a class="code" href="../../de/d90/namespacesbn_1_1bits.html#a3b8fd0787ccd1963c6aa5c8bf17f4290">mask</a>.set(<a class="code" href="../../d4/dff/structrecob_1_1TrajectoryPointFlagTraits.html#a1ed6fcc21f6cf9a22bd3134bc6c9a460">recob::TrajectoryPointFlagTraits::HitIgnored</a>,</div>
<div class="line"><a name="l01004"></a><span class="lineno"> 1004</span>&#160;             <a class="code" href="../../d4/dff/structrecob_1_1TrajectoryPointFlagTraits.html#a7a1b836f14bde0eb20ca4da2ead61a53">recob::TrajectoryPointFlagTraits::NoPoint</a>);</div>
<div class="line"><a name="l01005"></a><span class="lineno"> 1005</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="../../de/d90/namespacesbn_1_1bits.html#a3b8fd0787ccd1963c6aa5c8bf17f4290">mask</a>.isSet(<a class="code" href="../../d4/dff/structrecob_1_1TrajectoryPointFlagTraits.html#a06470c4691580dc3c0414f78f737aaf8">recob::TrajectoryPointFlagTraits::Rejected</a>) == 0)</div>
<div class="line"><a name="l01006"></a><span class="lineno"> 1006</span>&#160;      <a class="code" href="../../de/d90/namespacesbn_1_1bits.html#a3b8fd0787ccd1963c6aa5c8bf17f4290">mask</a>.set(<a class="code" href="../../d4/dff/structrecob_1_1TrajectoryPointFlagTraits.html#a52e1b0d7701ede6b439780ccfe24dcf6">recob::TrajectoryPointFlagTraits::ExcludedFromFit</a>);</div>
<div class="line"><a name="l01007"></a><span class="lineno"> 1007</span>&#160;    <span class="comment">//</span></div>
<div class="line"><a name="l01008"></a><span class="lineno"> 1008</span>&#160;    <span class="keyword">const</span> <span class="keyword">auto</span>&amp; hitstate = hitstatev[rejectedhsidx[rejidx]];</div>
<div class="line"><a name="l01009"></a><span class="lineno"> 1009</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="../../d6/dca/classtrkf_1_1TrackKalmanFitter.html#acbd8f32e18621b3cc8387fc6f01fb190">dumpLevel_</a> &gt; 2) assert(hitstate.wireId().Plane == inHits[originalPos]-&gt;WireID().Plane);</div>
<div class="line"><a name="l01010"></a><span class="lineno"> 1010</span>&#160;    <a class="code" href="../../db/d9c/structtrkmkr_1_1OptionalPointElement.html">trkmkr::OptionalPointElement</a> ope;</div>
<div class="line"><a name="l01011"></a><span class="lineno"> 1011</span>&#160;    <span class="keywordflow">if</span> (optionals.<a class="code" href="../../d0/d41/structtrkmkr_1_1OptionalOutputs.html#a67e40fa0c5a5119ca59c9cc7ad508c68">isTrackFitInfosInit</a>()) {</div>
<div class="line"><a name="l01012"></a><span class="lineno"> 1012</span>&#160;      ope.<a class="code" href="../../db/d9c/structtrkmkr_1_1OptionalPointElement.html#ab9b356956df77a52aa3be639d4de78db">setTrackFitHitInfo</a>(<a class="code" href="../../d8/d80/classrecob_1_1TrackFitHitInfo.html">recob::TrackFitHitInfo</a>(</div>
<div class="line"><a name="l01013"></a><span class="lineno"> 1013</span>&#160;        hitstate.hitMeas(),</div>
<div class="line"><a name="l01014"></a><span class="lineno"> 1014</span>&#160;        hitstate.hitMeasErr2(),</div>
<div class="line"><a name="l01015"></a><span class="lineno"> 1015</span>&#160;        <a class="code" href="../../d0/da2/namespacetrkf.html#a76b468986d4bcee16d17dfcae57efae2">SVector5</a>(<a class="code" href="../../d6/d72/namespaceutil.html#a85007be2ce41bf247364673c302f8a5b">util::kBogusD</a>, <a class="code" href="../../d6/d72/namespaceutil.html#a85007be2ce41bf247364673c302f8a5b">util::kBogusD</a>, <a class="code" href="../../d6/d72/namespaceutil.html#a85007be2ce41bf247364673c302f8a5b">util::kBogusD</a>, <a class="code" href="../../d6/d72/namespaceutil.html#a85007be2ce41bf247364673c302f8a5b">util::kBogusD</a>, <a class="code" href="../../d6/d72/namespaceutil.html#a85007be2ce41bf247364673c302f8a5b">util::kBogusD</a>),</div>
<div class="line"><a name="l01016"></a><span class="lineno"> 1016</span>&#160;        fakeCov55,</div>
<div class="line"><a name="l01017"></a><span class="lineno"> 1017</span>&#160;        hitstate.wireId()));</div>
<div class="line"><a name="l01018"></a><span class="lineno"> 1018</span>&#160;    }</div>
<div class="line"><a name="l01019"></a><span class="lineno"> 1019</span>&#160;    tcbk.addPoint(<a class="code" href="../../d0/da2/namespacetrkf.html#a38ab77d67362ad2a0af6a2a7997cbf5a">Point_t</a>(<a class="code" href="../../d6/d72/namespaceutil.html#a85007be2ce41bf247364673c302f8a5b">util::kBogusD</a>, <a class="code" href="../../d6/d72/namespaceutil.html#a85007be2ce41bf247364673c302f8a5b">util::kBogusD</a>, <a class="code" href="../../d6/d72/namespaceutil.html#a85007be2ce41bf247364673c302f8a5b">util::kBogusD</a>),</div>
<div class="line"><a name="l01020"></a><span class="lineno"> 1020</span>&#160;                  <a class="code" href="../../d0/da2/namespacetrkf.html#afce448b0c24542e8646ade72b3bd51b3">Vector_t</a>(<a class="code" href="../../d6/d72/namespaceutil.html#a85007be2ce41bf247364673c302f8a5b">util::kBogusD</a>, <a class="code" href="../../d6/d72/namespaceutil.html#a85007be2ce41bf247364673c302f8a5b">util::kBogusD</a>, <a class="code" href="../../d6/d72/namespaceutil.html#a85007be2ce41bf247364673c302f8a5b">util::kBogusD</a>),</div>
<div class="line"><a name="l01021"></a><span class="lineno"> 1021</span>&#160;                  inHits[originalPos],</div>
<div class="line"><a name="l01022"></a><span class="lineno"> 1022</span>&#160;                  <a class="code" href="../../d3/d86/classrecob_1_1TrajectoryPointFlags.html">recob::TrajectoryPointFlags</a>(originalPos, <a class="code" href="../../de/d90/namespacesbn_1_1bits.html#a3b8fd0787ccd1963c6aa5c8bf17f4290">mask</a>),</div>
<div class="line"><a name="l01023"></a><span class="lineno"> 1023</span>&#160;                  -1.,</div>
<div class="line"><a name="l01024"></a><span class="lineno"> 1024</span>&#160;                  ope);</div>
<div class="line"><a name="l01025"></a><span class="lineno"> 1025</span>&#160;  }</div>
<div class="line"><a name="l01026"></a><span class="lineno"> 1026</span>&#160;</div>
<div class="line"><a name="l01027"></a><span class="lineno"> 1027</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="../../d6/dca/classtrkf_1_1TrackKalmanFitter.html#acbd8f32e18621b3cc8387fc6f01fb190">dumpLevel_</a> &gt; 0)</div>
<div class="line"><a name="l01028"></a><span class="lineno"> 1028</span>&#160;    <a class="code" href="../../d8/df5/messageservice_8fcl.html#a6699b4dbd72f548e48d81c88697d35a6">std::cout</a> &lt;&lt; <span class="stringliteral">&quot;outHits.size()=&quot;</span> &lt;&lt; outHits.size() &lt;&lt; <span class="stringliteral">&quot; inHits.size()=&quot;</span> &lt;&lt; inHits.size()</div>
<div class="line"><a name="l01029"></a><span class="lineno"> 1029</span>&#160;              &lt;&lt; std::endl;</div>
<div class="line"><a name="l01030"></a><span class="lineno"> 1030</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="../../d6/dca/classtrkf_1_1TrackKalmanFitter.html#acbd8f32e18621b3cc8387fc6f01fb190">dumpLevel_</a> &gt; 2) assert(outHits.size() == inHits.size());</div>
<div class="line"><a name="l01031"></a><span class="lineno"> 1031</span>&#160;</div>
<div class="line"><a name="l01032"></a><span class="lineno"> 1032</span>&#160;  <span class="keywordtype">bool</span> propok = <span class="keyword">true</span>;</div>
<div class="line"><a name="l01033"></a><span class="lineno"> 1033</span>&#160;  KFTrackState resultF =</div>
<div class="line"><a name="l01034"></a><span class="lineno"> 1034</span>&#160;    <a class="code" href="../../d6/dca/classtrkf_1_1TrackKalmanFitter.html#a029821569a62274483456d270d7cd7e8">propagator</a>-&gt;<a class="code" href="../../dc/d5e/classtrkf_1_1TrackStatePropagator.html#a0b604e378ad14c086e7ac6dc481ab9c2">rotateToPlane</a>(propok,</div>
<div class="line"><a name="l01035"></a><span class="lineno"> 1035</span>&#160;                              fwdUpdTkState[sortedtksidx.front()].trackState(),</div>
<div class="line"><a name="l01036"></a><span class="lineno"> 1036</span>&#160;                              <a class="code" href="../../d0/da2/namespacetrkf.html#a41d627d46d1a30e41d4f191ff6acebd8">Plane</a>(fwdUpdTkState[sortedtksidx.front()].position(),</div>
<div class="line"><a name="l01037"></a><span class="lineno"> 1037</span>&#160;                                    fwdUpdTkState[sortedtksidx.front()].momentum()));</div>
<div class="line"><a name="l01038"></a><span class="lineno"> 1038</span>&#160;  KFTrackState resultB =</div>
<div class="line"><a name="l01039"></a><span class="lineno"> 1039</span>&#160;    <a class="code" href="../../d6/dca/classtrkf_1_1TrackKalmanFitter.html#a029821569a62274483456d270d7cd7e8">propagator</a>-&gt;<a class="code" href="../../dc/d5e/classtrkf_1_1TrackStatePropagator.html#a0b604e378ad14c086e7ac6dc481ab9c2">rotateToPlane</a>(propok,</div>
<div class="line"><a name="l01040"></a><span class="lineno"> 1040</span>&#160;                              fwdUpdTkState[sortedtksidx.back()].trackState(),</div>
<div class="line"><a name="l01041"></a><span class="lineno"> 1041</span>&#160;                              <a class="code" href="../../d0/da2/namespacetrkf.html#a41d627d46d1a30e41d4f191ff6acebd8">Plane</a>(fwdUpdTkState[sortedtksidx.back()].position(),</div>
<div class="line"><a name="l01042"></a><span class="lineno"> 1042</span>&#160;                                    fwdUpdTkState[sortedtksidx.back()].momentum()));</div>
<div class="line"><a name="l01043"></a><span class="lineno"> 1043</span>&#160;</div>
<div class="line"><a name="l01044"></a><span class="lineno"> 1044</span>&#160;  outTrack =</div>
<div class="line"><a name="l01045"></a><span class="lineno"> 1045</span>&#160;    tcbk.finalizeTrack(<a class="code" href="../../d0/da2/namespacetrkf.html#afce9d7f4b81473c0ba04bac01ee6fa51">SMatrixSym55</a>(resultF.covariance()), <a class="code" href="../../d0/da2/namespacetrkf.html#afce9d7f4b81473c0ba04bac01ee6fa51">SMatrixSym55</a>(resultB.covariance()));</div>
<div class="line"><a name="l01046"></a><span class="lineno"> 1046</span>&#160;</div>
<div class="line"><a name="l01047"></a><span class="lineno"> 1047</span>&#160;  <span class="comment">//if there are points with zero momentum return false</span></div>
<div class="line"><a name="l01048"></a><span class="lineno"> 1048</span>&#160;  <span class="keywordtype">size_t</span> point = 0;</div>
<div class="line"><a name="l01049"></a><span class="lineno"> 1049</span>&#160;  <span class="keywordflow">while</span> (outTrack.<a class="code" href="../../d9/dca/classrecob_1_1Track.html#a98b528b4fd2230652784752e6842d1d8">HasValidPoint</a>(point)) {</div>
<div class="line"><a name="l01050"></a><span class="lineno"> 1050</span>&#160;    <span class="keywordflow">if</span> (outTrack.<a class="code" href="../../d9/dca/classrecob_1_1Track.html#a40f088c86a6d4b10623b15ddf8126ee4">MomentumAtPoint</a>(outTrack.<a class="code" href="../../d9/dca/classrecob_1_1Track.html#a02de134e5abf432a8701cf41b97cefe3">NextValidPoint</a>(point++)) &lt;= 1.0<a class="code" href="../../d4/dca/updateVersionList_8sh.html#a067a8c1534d6da9b2c501a6cf4ef89bd">e</a>-9) {</div>
<div class="line"><a name="l01051"></a><span class="lineno"> 1051</span>&#160;      mf::LogWarning(<span class="stringliteral">&quot;TrackKalmanFitter&quot;</span>) &lt;&lt; <span class="stringliteral">&quot;found point with zero momentum!&quot;</span> &lt;&lt; std::endl;</div>
<div class="line"><a name="l01052"></a><span class="lineno"> 1052</span>&#160;      <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l01053"></a><span class="lineno"> 1053</span>&#160;    }</div>
<div class="line"><a name="l01054"></a><span class="lineno"> 1054</span>&#160;  }</div>
<div class="line"><a name="l01055"></a><span class="lineno"> 1055</span>&#160;</div>
<div class="line"><a name="l01056"></a><span class="lineno"> 1056</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="../../d6/dca/classtrkf_1_1TrackKalmanFitter.html#acbd8f32e18621b3cc8387fc6f01fb190">dumpLevel_</a> &gt; 0) {</div>
<div class="line"><a name="l01057"></a><span class="lineno"> 1057</span>&#160;    <a class="code" href="../../d8/df5/messageservice_8fcl.html#a6699b4dbd72f548e48d81c88697d35a6">std::cout</a> &lt;&lt; <span class="stringliteral">&quot;outTrack vertex=&quot;</span> &lt;&lt; outTrack.<a class="code" href="../../d9/dca/classrecob_1_1Track.html#a76e9771d081560878e111a75bbab91b4">Start</a>() &lt;&lt; <span class="stringliteral">&quot;\ndir=&quot;</span> &lt;&lt; outTrack.<a class="code" href="../../d9/dca/classrecob_1_1Track.html#a7b44fa66507dbe6c4f57bcfde1ed5fcf">StartDirection</a>()</div>
<div class="line"><a name="l01058"></a><span class="lineno"> 1058</span>&#160;              &lt;&lt; <span class="stringliteral">&quot;\ncov=\n&quot;</span></div>
<div class="line"><a name="l01059"></a><span class="lineno"> 1059</span>&#160;              &lt;&lt; outTrack.<a class="code" href="../../d9/dca/classrecob_1_1Track.html#a8c94d26198e160650e0e4fcf29b56cec">StartCovariance</a>() &lt;&lt; <span class="stringliteral">&quot;\nlength=&quot;</span> &lt;&lt; outTrack.<a class="code" href="../../d9/dca/classrecob_1_1Track.html#ab5c191137394eb6fcc600ea0ef1b6fb7">Length</a>()</div>
<div class="line"><a name="l01060"></a><span class="lineno"> 1060</span>&#160;              &lt;&lt; <span class="stringliteral">&quot;\nchi2/ndof=&quot;</span> &lt;&lt; outTrack.<a class="code" href="../../d9/dca/classrecob_1_1Track.html#a466f94c50481c6257a84a2fec51f13c4">Chi2PerNdof</a>() &lt;&lt; std::endl;</div>
<div class="line"><a name="l01061"></a><span class="lineno"> 1061</span>&#160;  }</div>
<div class="line"><a name="l01062"></a><span class="lineno"> 1062</span>&#160;</div>
<div class="line"><a name="l01063"></a><span class="lineno"> 1063</span>&#160;  <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l01064"></a><span class="lineno"> 1064</span>&#160;}</div>
<div class="ttc" id="structrecob_1_1TrajectoryPointFlagTraits_html_a7a1b836f14bde0eb20ca4da2ead61a53"><div class="ttname"><a href="../../d4/dff/structrecob_1_1TrajectoryPointFlagTraits.html#a7a1b836f14bde0eb20ca4da2ead61a53">recob::TrajectoryPointFlagTraits::NoPoint</a></div><div class="ttdeci">static constexpr Flag_t NoPoint</div><div class="ttdoc">The trajectory point is not defined. </div><div class="ttdef"><b>Definition:</b> <a href="../../dd/d67/TrajectoryPointFlags_8h_source.html#l00119">TrajectoryPointFlags.h:119</a></div></div>
<div class="ttc" id="namespacetrkf_html_a38ab77d67362ad2a0af6a2a7997cbf5a"><div class="ttname"><a href="../../d0/da2/namespacetrkf.html#a38ab77d67362ad2a0af6a2a7997cbf5a">trkf::Point_t</a></div><div class="ttdeci">recob::tracking::Point_t Point_t</div><div class="ttdef"><b>Definition:</b> <a href="../../d6/d2f/TrackState_8h_source.html#l00018">TrackState.h:18</a></div></div>
<div class="ttc" id="namespacetrkf_html_afce448b0c24542e8646ade72b3bd51b3"><div class="ttname"><a href="../../d0/da2/namespacetrkf.html#afce448b0c24542e8646ade72b3bd51b3">trkf::Vector_t</a></div><div class="ttdeci">recob::tracking::Vector_t Vector_t</div><div class="ttdef"><b>Definition:</b> <a href="../../d6/d2f/TrackState_8h_source.html#l00019">TrackState.h:19</a></div></div>
<div class="ttc" id="selectors_8fcl_html_a24c8335057af14a9b508d5ac18999ce5"><div class="ttname"><a href="../../d9/dd2/selectors_8fcl.html#a24c8335057af14a9b508d5ac18999ce5">p</a></div><div class="ttdeci">pdgs p</div><div class="ttdef"><b>Definition:</b> <a href="../../d9/dd2/selectors_8fcl_source.html#l00022">selectors.fcl:22</a></div></div>
<div class="ttc" id="namespacetrkf_html_afce9d7f4b81473c0ba04bac01ee6fa51"><div class="ttname"><a href="../../d0/da2/namespacetrkf.html#afce9d7f4b81473c0ba04bac01ee6fa51">trkf::SMatrixSym55</a></div><div class="ttdeci">recob::tracking::SMatrixSym55 SMatrixSym55</div><div class="ttdef"><b>Definition:</b> <a href="../../d6/d2f/TrackState_8h_source.html#l00015">TrackState.h:15</a></div></div>
<div class="ttc" id="classrecob_1_1Track_html_a98b528b4fd2230652784752e6842d1d8"><div class="ttname"><a href="../../d9/dca/classrecob_1_1Track.html#a98b528b4fd2230652784752e6842d1d8">recob::Track::HasValidPoint</a></div><div class="ttdeci">bool HasValidPoint(size_t i) const </div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d53/bj_2lardataobj_2RecoBase_2Track_8h_source.html#l00111">bj/lardataobj/RecoBase/Track.h:111</a></div></div>
<div class="ttc" id="classrecob_1_1Track_html_a40f088c86a6d4b10623b15ddf8126ee4"><div class="ttname"><a href="../../d9/dca/classrecob_1_1Track.html#a40f088c86a6d4b10623b15ddf8126ee4">recob::Track::MomentumAtPoint</a></div><div class="ttdeci">double MomentumAtPoint(unsigned int p) const </div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d53/bj_2lardataobj_2RecoBase_2Track_8h_source.html#l00141">bj/lardataobj/RecoBase/Track.h:141</a></div></div>
<div class="ttc" id="classtrkf_1_1TrackKalmanFitter_html_acbd8f32e18621b3cc8387fc6f01fb190"><div class="ttname"><a href="../../d6/dca/classtrkf_1_1TrackKalmanFitter.html#acbd8f32e18621b3cc8387fc6f01fb190">trkf::TrackKalmanFitter::dumpLevel_</a></div><div class="ttdeci">int dumpLevel_</div><div class="ttdef"><b>Definition:</b> <a href="../../d7/dcf/TrackKalmanFitter_8h_source.html#l00318">TrackKalmanFitter.h:318</a></div></div>
<div class="ttc" id="classrecob_1_1Track_html_a7b44fa66507dbe6c4f57bcfde1ed5fcf"><div class="ttname"><a href="../../d9/dca/classrecob_1_1Track.html#a7b44fa66507dbe6c4f57bcfde1ed5fcf">recob::Track::StartDirection</a></div><div class="ttdeci">Vector_t StartDirection() const </div><div class="ttdoc">Access to track direction at different points. </div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d53/bj_2lardataobj_2RecoBase_2Track_8h_source.html#l00131">bj/lardataobj/RecoBase/Track.h:131</a></div></div>
<div class="ttc" id="classrecob_1_1Track_html_ab5c191137394eb6fcc600ea0ef1b6fb7"><div class="ttname"><a href="../../d9/dca/classrecob_1_1Track.html#ab5c191137394eb6fcc600ea0ef1b6fb7">recob::Track::Length</a></div><div class="ttdeci">double Length(size_t p=0) const </div><div class="ttdoc">Access to various track properties. </div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d53/bj_2lardataobj_2RecoBase_2Track_8h_source.html#l00167">bj/lardataobj/RecoBase/Track.h:167</a></div></div>
<div class="ttc" id="namespacetrkf_html_a76b468986d4bcee16d17dfcae57efae2"><div class="ttname"><a href="../../d0/da2/namespacetrkf.html#a76b468986d4bcee16d17dfcae57efae2">trkf::SVector5</a></div><div class="ttdeci">recob::tracking::SVector5 SVector5</div><div class="ttdef"><b>Definition:</b> <a href="../../d6/d2f/TrackState_8h_source.html#l00012">TrackState.h:12</a></div></div>
<div class="ttc" id="namespacesbn_1_1bits_html_a3b8fd0787ccd1963c6aa5c8bf17f4290"><div class="ttname"><a href="../../de/d90/namespacesbn_1_1bits.html#a3b8fd0787ccd1963c6aa5c8bf17f4290">sbn::bits::mask</a></div><div class="ttdeci">constexpr mask_t&lt; EnumType &gt; mask(EnumType bit, OtherBits...otherBits)</div><div class="ttdoc">Returns a mask with all specified bits set. </div></div>
<div class="ttc" id="classrecob_1_1Track_html_a76e9771d081560878e111a75bbab91b4"><div class="ttname"><a href="../../d9/dca/classrecob_1_1Track.html#a76e9771d081560878e111a75bbab91b4">recob::Track::Start</a></div><div class="ttdeci">Point_t const &amp; Start() const </div><div class="ttdoc">Access to track position at different points. </div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d53/bj_2lardataobj_2RecoBase_2Track_8h_source.html#l00123">bj/lardataobj/RecoBase/Track.h:123</a></div></div>
<div class="ttc" id="classrecob_1_1TrackFitHitInfo_html"><div class="ttname"><a href="../../d8/d80/classrecob_1_1TrackFitHitInfo.html">recob::TrackFitHitInfo</a></div><div class="ttdoc">Object storing per-hit information from a track fit. </div><div class="ttdef"><b>Definition:</b> <a href="../../de/de3/TrackFitHitInfo_8h_source.html#l00029">TrackFitHitInfo.h:29</a></div></div>
<div class="ttc" id="structtrkmkr_1_1OptionalPointElement_html"><div class="ttname"><a href="../../db/d9c/structtrkmkr_1_1OptionalPointElement.html">trkmkr::OptionalPointElement</a></div><div class="ttdoc">Struct holding point-by-point elements used in OptionalOutputs. </div><div class="ttdef"><b>Definition:</b> <a href="../../d4/d4b/TrackMaker_8h_source.html#l00047">TrackMaker.h:47</a></div></div>
<div class="ttc" id="classrecob_1_1Track_html_a466f94c50481c6257a84a2fec51f13c4"><div class="ttname"><a href="../../d9/dca/classrecob_1_1Track.html#a466f94c50481c6257a84a2fec51f13c4">recob::Track::Chi2PerNdof</a></div><div class="ttdeci">float Chi2PerNdof() const </div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d53/bj_2lardataobj_2RecoBase_2Track_8h_source.html#l00169">bj/lardataobj/RecoBase/Track.h:169</a></div></div>
<div class="ttc" id="classtrkf_1_1TrackStatePropagator_html_a0b604e378ad14c086e7ac6dc481ab9c2"><div class="ttname"><a href="../../dc/d5e/classtrkf_1_1TrackStatePropagator.html#a0b604e378ad14c086e7ac6dc481ab9c2">trkf::TrackStatePropagator::rotateToPlane</a></div><div class="ttdeci">TrackState rotateToPlane(bool &amp;success, const TrackState &amp;origin, const Plane &amp;target) const </div><div class="ttdoc">Rotation of a TrackState to a Plane (zero distance propagation) </div><div class="ttdef"><b>Definition:</b> <a href="../../d3/d9d/TrackStatePropagator_8h_source.html#l00104">TrackStatePropagator.h:104</a></div></div>
<div class="ttc" id="classtrkf_1_1TrackKalmanFitter_html_a029821569a62274483456d270d7cd7e8"><div class="ttname"><a href="../../d6/dca/classtrkf_1_1TrackKalmanFitter.html#a029821569a62274483456d270d7cd7e8">trkf::TrackKalmanFitter::propagator</a></div><div class="ttdeci">const TrackStatePropagator * propagator</div><div class="ttdef"><b>Definition:</b> <a href="../../d7/dcf/TrackKalmanFitter_8h_source.html#l00300">TrackKalmanFitter.h:300</a></div></div>
<div class="ttc" id="structrecob_1_1TrajectoryPointFlagTraits_html_a1ed6fcc21f6cf9a22bd3134bc6c9a460"><div class="ttname"><a href="../../d4/dff/structrecob_1_1TrajectoryPointFlagTraits.html#a1ed6fcc21f6cf9a22bd3134bc6c9a460">recob::TrajectoryPointFlagTraits::HitIgnored</a></div><div class="ttdeci">static constexpr Flag_t HitIgnored</div><div class="ttdoc">Hit was not included for the computation of the trajectory. </div><div class="ttdef"><b>Definition:</b> <a href="../../dd/d67/TrajectoryPointFlags_8h_source.html#l00116">TrajectoryPointFlags.h:116</a></div></div>
<div class="ttc" id="structrecob_1_1TrajectoryPointFlagTraits_html_a06470c4691580dc3c0414f78f737aaf8"><div class="ttname"><a href="../../d4/dff/structrecob_1_1TrajectoryPointFlagTraits.html#a06470c4691580dc3c0414f78f737aaf8">recob::TrajectoryPointFlagTraits::Rejected</a></div><div class="ttdeci">static constexpr Flag_t Rejected</div><div class="ttdoc">The hit is extraneous to this track. </div><div class="ttdef"><b>Definition:</b> <a href="../../dd/d67/TrajectoryPointFlags_8h_source.html#l00172">TrajectoryPointFlags.h:172</a></div></div>
<div class="ttc" id="structrecob_1_1TrajectoryPointFlagTraits_html_a52e1b0d7701ede6b439780ccfe24dcf6"><div class="ttname"><a href="../../d4/dff/structrecob_1_1TrajectoryPointFlagTraits.html#a52e1b0d7701ede6b439780ccfe24dcf6">recob::TrajectoryPointFlagTraits::ExcludedFromFit</a></div><div class="ttdeci">static constexpr Flag_t ExcludedFromFit</div><div class="ttdef"><b>Definition:</b> <a href="../../dd/d67/TrajectoryPointFlags_8h_source.html#l00169">TrajectoryPointFlags.h:169</a></div></div>
<div class="ttc" id="PMAlgTracking_8cxx_html_af99faac002e5718f9ea4ea0c456f6d72"><div class="ttname"><a href="../../db/dfa/PMAlgTracking_8cxx.html#af99faac002e5718f9ea4ea0c456f6d72">SMatrixSym55</a></div><div class="ttdeci">recob::tracking::SMatrixSym55 SMatrixSym55</div><div class="ttdef"><b>Definition:</b> <a href="../../db/dfa/PMAlgTracking_8cxx_source.html#l00022">PMAlgTracking.cxx:22</a></div></div>
<div class="ttc" id="classrecob_1_1Track_html_a02de134e5abf432a8701cf41b97cefe3"><div class="ttname"><a href="../../d9/dca/classrecob_1_1Track.html#a02de134e5abf432a8701cf41b97cefe3">recob::Track::NextValidPoint</a></div><div class="ttdeci">size_t NextValidPoint(size_t index) const </div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d53/bj_2lardataobj_2RecoBase_2Track_8h_source.html#l00107">bj/lardataobj/RecoBase/Track.h:107</a></div></div>
<div class="ttc" id="classtrkmkr_1_1TrackCreationBookKeeper_html"><div class="ttname"><a href="../../df/dd3/classtrkmkr_1_1TrackCreationBookKeeper.html">trkmkr::TrackCreationBookKeeper</a></div><div class="ttdoc">Helper class to aid the creation of a recob::Track, keeping data vectors in sync. ...</div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d67/TrackCreationBookKeeper_8h_source.html#l00032">TrackCreationBookKeeper.h:32</a></div></div>
<div class="ttc" id="updateVersionList_8sh_html_a067a8c1534d6da9b2c501a6cf4ef89bd"><div class="ttname"><a href="../../d4/dca/updateVersionList_8sh.html#a067a8c1534d6da9b2c501a6cf4ef89bd">e</a></div><div class="ttdeci">do i e</div><div class="ttdef"><b>Definition:</b> <a href="../../d4/dca/updateVersionList_8sh_source.html#l00068">updateVersionList.sh:68</a></div></div>
<div class="ttc" id="structtrkmkr_1_1OptionalOutputs_html_a67e40fa0c5a5119ca59c9cc7ad508c68"><div class="ttname"><a href="../../d0/d41/structtrkmkr_1_1OptionalOutputs.html#a67e40fa0c5a5119ca59c9cc7ad508c68">trkmkr::OptionalOutputs::isTrackFitInfosInit</a></div><div class="ttdeci">bool isTrackFitInfosInit()</div><div class="ttdoc">check initialization of the output vector of TrackFitHitInfos </div><div class="ttdef"><b>Definition:</b> <a href="../../d4/d4b/TrackMaker_8h_source.html#l00173">TrackMaker.h:173</a></div></div>
<div class="ttc" id="namespaceutil_html_a85007be2ce41bf247364673c302f8a5b"><div class="ttname"><a href="../../d6/d72/namespaceutil.html#a85007be2ce41bf247364673c302f8a5b">util::kBogusD</a></div><div class="ttdeci">constexpr double kBogusD</div><div class="ttdoc">obviously bogus double value </div><div class="ttdef"><b>Definition:</b> <a href="../../dd/d09/PhysicalConstants_8h_source.html#l00071">PhysicalConstants.h:71</a></div></div>
<div class="ttc" id="structtrkmkr_1_1OptionalPointElement_html_ab9b356956df77a52aa3be639d4de78db"><div class="ttname"><a href="../../db/d9c/structtrkmkr_1_1OptionalPointElement.html#ab9b356956df77a52aa3be639d4de78db">trkmkr::OptionalPointElement::setTrackFitHitInfo</a></div><div class="ttdeci">void setTrackFitHitInfo(recob::TrackFitHitInfo &amp;&amp;aTrackFitHitInfo)</div><div class="ttdoc">set the recob::TrackFitHitInfo unique_ptr </div><div class="ttdef"><b>Definition:</b> <a href="../../d4/d4b/TrackMaker_8h_source.html#l00051">TrackMaker.h:51</a></div></div>
<div class="ttc" id="namespacetrkf_html_a41d627d46d1a30e41d4f191ff6acebd8"><div class="ttname"><a href="../../d0/da2/namespacetrkf.html#a41d627d46d1a30e41d4f191ff6acebd8">trkf::Plane</a></div><div class="ttdeci">recob::tracking::Plane Plane</div><div class="ttdef"><b>Definition:</b> <a href="../../d6/d2f/TrackState_8h_source.html#l00017">TrackState.h:17</a></div></div>
<div class="ttc" id="classrecob_1_1TrajectoryPointFlags_html"><div class="ttname"><a href="../../d3/d86/classrecob_1_1TrajectoryPointFlags.html">recob::TrajectoryPointFlags</a></div><div class="ttdoc">Set of flags pertaining a point of the track. </div><div class="ttdef"><b>Definition:</b> <a href="../../dd/d67/TrajectoryPointFlags_8h_source.html#l00315">TrajectoryPointFlags.h:315</a></div></div>
<div class="ttc" id="messageservice_8fcl_html_a6699b4dbd72f548e48d81c88697d35a6"><div class="ttname"><a href="../../d8/df5/messageservice_8fcl.html#a6699b4dbd72f548e48d81c88697d35a6">cout</a></div><div class="ttdeci">BEGIN_PROLOG could also be cout</div><div class="ttdef"><b>Definition:</b> <a href="../../d8/df5/messageservice_8fcl_source.html#l00010">messageservice.fcl:10</a></div></div>
<div class="ttc" id="classrecob_1_1Track_html_a8c94d26198e160650e0e4fcf29b56cec"><div class="ttname"><a href="../../d9/dca/classrecob_1_1Track.html#a8c94d26198e160650e0e4fcf29b56cec">recob::Track::StartCovariance</a></div><div class="ttdeci">const SMatrixSym55 &amp; StartCovariance() const </div><div class="ttdoc">Access to covariance matrices. </div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d53/bj_2lardataobj_2RecoBase_2Track_8h_source.html#l00153">bj/lardataobj/RecoBase/Track.h:153</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a736d6f1efc6e9f76d7be5bde86faa030"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool trkf::TrackKalmanFitter::fitTrack </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="../../d1/d11/classdetinfo_1_1DetectorPropertiesData.html">detinfo::DetectorPropertiesData</a> const &amp;&#160;</td>
          <td class="paramname"><em>detProp</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="../../de/de5/classrecob_1_1TrackTrajectory.html">recob::TrackTrajectory</a> &amp;&#160;</td>
          <td class="paramname"><em>traj</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>tkID</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="../../d0/da2/namespacetrkf.html#afce9d7f4b81473c0ba04bac01ee6fa51">SMatrixSym55</a> &amp;&#160;</td>
          <td class="paramname"><em>covVtx</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="../../d0/da2/namespacetrkf.html#afce9d7f4b81473c0ba04bac01ee6fa51">SMatrixSym55</a> &amp;&#160;</td>
          <td class="paramname"><em>covEnd</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const std::vector&lt; art::Ptr&lt; <a class="el" href="../../db/d4e/classrecob_1_1Hit.html">recob::Hit</a> &gt;&gt; &amp;&#160;</td>
          <td class="paramname"><em>hits</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const double&#160;</td>
          <td class="paramname"><em>pval</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const int&#160;</td>
          <td class="paramname"><em>pdgid</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const bool&#160;</td>
          <td class="paramname"><em>flipDirection</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="../../d9/dca/classrecob_1_1Track.html">recob::Track</a> &amp;&#160;</td>
          <td class="paramname"><em>outTrack</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">std::vector&lt; art::Ptr&lt; <a class="el" href="../../db/d4e/classrecob_1_1Hit.html">recob::Hit</a> &gt;&gt; &amp;&#160;</td>
          <td class="paramname"><em>outHits</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="../../d0/d41/structtrkmkr_1_1OptionalOutputs.html">trkmkr::OptionalOutputs</a> &amp;&#160;</td>
          <td class="paramname"><em>optionals</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td> const</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Fit track starting from TrackTrajectory. </p>

<p>Definition at line <a class="el" href="../../de/d68/TrackKalmanFitter_8cxx_source.html#l00037">37</a> of file <a class="el" href="../../de/d68/TrackKalmanFitter_8cxx_source.html">TrackKalmanFitter.cxx</a>.</p>
<div class="fragment"><div class="line"><a name="l00049"></a><span class="lineno">   49</span>&#160;{</div>
<div class="line"><a name="l00050"></a><span class="lineno">   50</span>&#160;  <span class="keyword">auto</span> position = traj.<a class="code" href="../../de/de5/classrecob_1_1TrackTrajectory.html#a7a9804a4f9d6a7ff1d6832a66461c008">Vertex</a>();</div>
<div class="line"><a name="l00051"></a><span class="lineno">   51</span>&#160;  <span class="keyword">auto</span> direction = traj.<a class="code" href="../../de/de5/classrecob_1_1TrackTrajectory.html#a4d4a2f95e08394043d655517b24a089e">VertexDirection</a>();</div>
<div class="line"><a name="l00052"></a><span class="lineno">   52</span>&#160;</div>
<div class="line"><a name="l00053"></a><span class="lineno">   53</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="../../d6/dca/classtrkf_1_1TrackKalmanFitter.html#a2f527686a3b82eaab63104dbb3e870b2">tryBothDirs_</a>) {</div>
<div class="line"><a name="l00054"></a><span class="lineno">   54</span>&#160;    <a class="code" href="../../d9/dca/classrecob_1_1Track.html">recob::Track</a> fwdTrack;</div>
<div class="line"><a name="l00055"></a><span class="lineno">   55</span>&#160;    std::vector&lt;art::Ptr&lt;recob::Hit&gt;&gt; fwdHits;</div>
<div class="line"><a name="l00056"></a><span class="lineno">   56</span>&#160;    <a class="code" href="../../d0/d41/structtrkmkr_1_1OptionalOutputs.html">trkmkr::OptionalOutputs</a> fwdoptionals;</div>
<div class="line"><a name="l00057"></a><span class="lineno">   57</span>&#160;    <a class="code" href="../../db/dfa/PMAlgTracking_8cxx.html#af99faac002e5718f9ea4ea0c456f6d72">SMatrixSym55</a> fwdcov = covVtx;</div>
<div class="line"><a name="l00058"></a><span class="lineno">   58</span>&#160;    <span class="keywordtype">bool</span> okfwd = <a class="code" href="../../d6/dca/classtrkf_1_1TrackKalmanFitter.html#a736d6f1efc6e9f76d7be5bde86faa030">fitTrack</a>(<a class="code" href="../../d2/d1a/namespacedetsim.html#a560adbb3abf95a23d45a53ed25d8c0c7">detProp</a>,</div>
<div class="line"><a name="l00059"></a><span class="lineno">   59</span>&#160;                          position,</div>
<div class="line"><a name="l00060"></a><span class="lineno">   60</span>&#160;                          direction,</div>
<div class="line"><a name="l00061"></a><span class="lineno">   61</span>&#160;                          fwdcov,</div>
<div class="line"><a name="l00062"></a><span class="lineno">   62</span>&#160;                          hits,</div>
<div class="line"><a name="l00063"></a><span class="lineno">   63</span>&#160;                          traj.<a class="code" href="../../de/de5/classrecob_1_1TrackTrajectory.html#a2b2874c09cbc03f7b6d65f9dc145235e">Flags</a>(),</div>
<div class="line"><a name="l00064"></a><span class="lineno">   64</span>&#160;                          tkID,</div>
<div class="line"><a name="l00065"></a><span class="lineno">   65</span>&#160;                          pval,</div>
<div class="line"><a name="l00066"></a><span class="lineno">   66</span>&#160;                          pdgid,</div>
<div class="line"><a name="l00067"></a><span class="lineno">   67</span>&#160;                          fwdTrack,</div>
<div class="line"><a name="l00068"></a><span class="lineno">   68</span>&#160;                          fwdHits,</div>
<div class="line"><a name="l00069"></a><span class="lineno">   69</span>&#160;                          fwdoptionals);</div>
<div class="line"><a name="l00070"></a><span class="lineno">   70</span>&#160;</div>
<div class="line"><a name="l00071"></a><span class="lineno">   71</span>&#160;    <a class="code" href="../../d9/dca/classrecob_1_1Track.html">recob::Track</a> bwdTrack;</div>
<div class="line"><a name="l00072"></a><span class="lineno">   72</span>&#160;    std::vector&lt;art::Ptr&lt;recob::Hit&gt;&gt; bwdHits;</div>
<div class="line"><a name="l00073"></a><span class="lineno">   73</span>&#160;    <a class="code" href="../../d0/d41/structtrkmkr_1_1OptionalOutputs.html">trkmkr::OptionalOutputs</a> bwdoptionals;</div>
<div class="line"><a name="l00074"></a><span class="lineno">   74</span>&#160;    <a class="code" href="../../db/dfa/PMAlgTracking_8cxx.html#af99faac002e5718f9ea4ea0c456f6d72">SMatrixSym55</a> bwdcov = covEnd;</div>
<div class="line"><a name="l00075"></a><span class="lineno">   75</span>&#160;    <span class="keywordtype">bool</span> okbwd = <a class="code" href="../../d6/dca/classtrkf_1_1TrackKalmanFitter.html#a736d6f1efc6e9f76d7be5bde86faa030">fitTrack</a>(<a class="code" href="../../d2/d1a/namespacedetsim.html#a560adbb3abf95a23d45a53ed25d8c0c7">detProp</a>,</div>
<div class="line"><a name="l00076"></a><span class="lineno">   76</span>&#160;                          position,</div>
<div class="line"><a name="l00077"></a><span class="lineno">   77</span>&#160;                          -direction,</div>
<div class="line"><a name="l00078"></a><span class="lineno">   78</span>&#160;                          bwdcov,</div>
<div class="line"><a name="l00079"></a><span class="lineno">   79</span>&#160;                          hits,</div>
<div class="line"><a name="l00080"></a><span class="lineno">   80</span>&#160;                          traj.<a class="code" href="../../de/de5/classrecob_1_1TrackTrajectory.html#a2b2874c09cbc03f7b6d65f9dc145235e">Flags</a>(),</div>
<div class="line"><a name="l00081"></a><span class="lineno">   81</span>&#160;                          tkID,</div>
<div class="line"><a name="l00082"></a><span class="lineno">   82</span>&#160;                          pval,</div>
<div class="line"><a name="l00083"></a><span class="lineno">   83</span>&#160;                          pdgid,</div>
<div class="line"><a name="l00084"></a><span class="lineno">   84</span>&#160;                          bwdTrack,</div>
<div class="line"><a name="l00085"></a><span class="lineno">   85</span>&#160;                          bwdHits,</div>
<div class="line"><a name="l00086"></a><span class="lineno">   86</span>&#160;                          bwdoptionals);</div>
<div class="line"><a name="l00087"></a><span class="lineno">   87</span>&#160;</div>
<div class="line"><a name="l00088"></a><span class="lineno">   88</span>&#160;    <span class="keywordflow">if</span> (okfwd == <span class="keyword">false</span> &amp;&amp; okbwd == <span class="keyword">false</span>) { <span class="keywordflow">return</span> <span class="keyword">false</span>; }</div>
<div class="line"><a name="l00089"></a><span class="lineno">   89</span>&#160;    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (okfwd == <span class="keyword">true</span> &amp;&amp; okbwd == <span class="keyword">true</span>) {</div>
<div class="line"><a name="l00090"></a><span class="lineno">   90</span>&#160;      <span class="keywordflow">if</span> ((fwdTrack.CountValidPoints() / (fwdTrack.Length() * fwdTrack.Chi2PerNdof())) &gt;=</div>
<div class="line"><a name="l00091"></a><span class="lineno">   91</span>&#160;          (bwdTrack.CountValidPoints() / (bwdTrack.Length() * bwdTrack.Chi2PerNdof()))) {</div>
<div class="line"><a name="l00092"></a><span class="lineno">   92</span>&#160;        outTrack = fwdTrack;</div>
<div class="line"><a name="l00093"></a><span class="lineno">   93</span>&#160;        outHits = fwdHits;</div>
<div class="line"><a name="l00094"></a><span class="lineno">   94</span>&#160;        optionals = std::move(fwdoptionals);</div>
<div class="line"><a name="l00095"></a><span class="lineno">   95</span>&#160;      }</div>
<div class="line"><a name="l00096"></a><span class="lineno">   96</span>&#160;      <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00097"></a><span class="lineno">   97</span>&#160;        outTrack = bwdTrack;</div>
<div class="line"><a name="l00098"></a><span class="lineno">   98</span>&#160;        outHits = bwdHits;</div>
<div class="line"><a name="l00099"></a><span class="lineno">   99</span>&#160;        optionals = std::move(bwdoptionals);</div>
<div class="line"><a name="l00100"></a><span class="lineno">  100</span>&#160;      }</div>
<div class="line"><a name="l00101"></a><span class="lineno">  101</span>&#160;    }</div>
<div class="line"><a name="l00102"></a><span class="lineno">  102</span>&#160;    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (okfwd == <span class="keyword">true</span>) {</div>
<div class="line"><a name="l00103"></a><span class="lineno">  103</span>&#160;      outTrack = fwdTrack;</div>
<div class="line"><a name="l00104"></a><span class="lineno">  104</span>&#160;      outHits = fwdHits;</div>
<div class="line"><a name="l00105"></a><span class="lineno">  105</span>&#160;      optionals = std::move(fwdoptionals);</div>
<div class="line"><a name="l00106"></a><span class="lineno">  106</span>&#160;    }</div>
<div class="line"><a name="l00107"></a><span class="lineno">  107</span>&#160;    <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00108"></a><span class="lineno">  108</span>&#160;      outTrack = bwdTrack;</div>
<div class="line"><a name="l00109"></a><span class="lineno">  109</span>&#160;      outHits = bwdHits;</div>
<div class="line"><a name="l00110"></a><span class="lineno">  110</span>&#160;      optionals = std::move(bwdoptionals);</div>
<div class="line"><a name="l00111"></a><span class="lineno">  111</span>&#160;    }</div>
<div class="line"><a name="l00112"></a><span class="lineno">  112</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l00113"></a><span class="lineno">  113</span>&#160;  }</div>
<div class="line"><a name="l00114"></a><span class="lineno">  114</span>&#160;  <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00115"></a><span class="lineno">  115</span>&#160;    <span class="keywordflow">if</span> (flipDirection) {</div>
<div class="line"><a name="l00116"></a><span class="lineno">  116</span>&#160;      position = traj.<a class="code" href="../../de/de5/classrecob_1_1TrackTrajectory.html#ae4ec67beaff30ba7eee4c6c6b377540c">End</a>();</div>
<div class="line"><a name="l00117"></a><span class="lineno">  117</span>&#160;      direction = -traj.<a class="code" href="../../de/de5/classrecob_1_1TrackTrajectory.html#ab0cc936e357b4a3474b11e92b844e474">EndDirection</a>();</div>
<div class="line"><a name="l00118"></a><span class="lineno">  118</span>&#160;    }</div>
<div class="line"><a name="l00119"></a><span class="lineno">  119</span>&#160;</div>
<div class="line"><a name="l00120"></a><span class="lineno">  120</span>&#160;    <span class="keyword">auto</span> trackStateCov = (flipDirection ? covEnd : covVtx);</div>
<div class="line"><a name="l00121"></a><span class="lineno">  121</span>&#160;</div>
<div class="line"><a name="l00122"></a><span class="lineno">  122</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="../../d6/dca/classtrkf_1_1TrackKalmanFitter.html#a736d6f1efc6e9f76d7be5bde86faa030">fitTrack</a>(<a class="code" href="../../d2/d1a/namespacedetsim.html#a560adbb3abf95a23d45a53ed25d8c0c7">detProp</a>,</div>
<div class="line"><a name="l00123"></a><span class="lineno">  123</span>&#160;                    position,</div>
<div class="line"><a name="l00124"></a><span class="lineno">  124</span>&#160;                    direction,</div>
<div class="line"><a name="l00125"></a><span class="lineno">  125</span>&#160;                    trackStateCov,</div>
<div class="line"><a name="l00126"></a><span class="lineno">  126</span>&#160;                    hits,</div>
<div class="line"><a name="l00127"></a><span class="lineno">  127</span>&#160;                    traj.<a class="code" href="../../de/de5/classrecob_1_1TrackTrajectory.html#a2b2874c09cbc03f7b6d65f9dc145235e">Flags</a>(),</div>
<div class="line"><a name="l00128"></a><span class="lineno">  128</span>&#160;                    tkID,</div>
<div class="line"><a name="l00129"></a><span class="lineno">  129</span>&#160;                    pval,</div>
<div class="line"><a name="l00130"></a><span class="lineno">  130</span>&#160;                    pdgid,</div>
<div class="line"><a name="l00131"></a><span class="lineno">  131</span>&#160;                    outTrack,</div>
<div class="line"><a name="l00132"></a><span class="lineno">  132</span>&#160;                    outHits,</div>
<div class="line"><a name="l00133"></a><span class="lineno">  133</span>&#160;                    optionals);</div>
<div class="line"><a name="l00134"></a><span class="lineno">  134</span>&#160;  }</div>
<div class="line"><a name="l00135"></a><span class="lineno">  135</span>&#160;}</div>
<div class="ttc" id="classrecob_1_1TrackTrajectory_html_a2b2874c09cbc03f7b6d65f9dc145235e"><div class="ttname"><a href="../../de/de5/classrecob_1_1TrackTrajectory.html#a2b2874c09cbc03f7b6d65f9dc145235e">recob::TrackTrajectory::Flags</a></div><div class="ttdeci">Flags_t const &amp; Flags() const </div><div class="ttdoc">Returns all flags. </div><div class="ttdef"><b>Definition:</b> <a href="../../dc/df6/TrackTrajectory_8h_source.html#l00171">TrackTrajectory.h:171</a></div></div>
<div class="ttc" id="classtrkf_1_1TrackKalmanFitter_html_a736d6f1efc6e9f76d7be5bde86faa030"><div class="ttname"><a href="../../d6/dca/classtrkf_1_1TrackKalmanFitter.html#a736d6f1efc6e9f76d7be5bde86faa030">trkf::TrackKalmanFitter::fitTrack</a></div><div class="ttdeci">bool fitTrack(detinfo::DetectorPropertiesData const &amp;detProp, const recob::TrackTrajectory &amp;traj, int tkID, const SMatrixSym55 &amp;covVtx, const SMatrixSym55 &amp;covEnd, const std::vector&lt; art::Ptr&lt; recob::Hit &gt;&gt; &amp;hits, const double pval, const int pdgid, const bool flipDirection, recob::Track &amp;outTrack, std::vector&lt; art::Ptr&lt; recob::Hit &gt;&gt; &amp;outHits, trkmkr::OptionalOutputs &amp;optionals) const </div><div class="ttdoc">Fit track starting from TrackTrajectory. </div><div class="ttdef"><b>Definition:</b> <a href="../../de/d68/TrackKalmanFitter_8cxx_source.html#l00037">TrackKalmanFitter.cxx:37</a></div></div>
<div class="ttc" id="classrecob_1_1TrackTrajectory_html_a4d4a2f95e08394043d655517b24a089e"><div class="ttname"><a href="../../de/de5/classrecob_1_1TrackTrajectory.html#a4d4a2f95e08394043d655517b24a089e">recob::TrackTrajectory::VertexDirection</a></div><div class="ttdeci">Vector_t VertexDirection() const </div><div class="ttdoc">Returns the direction of the trajectory at the first point. </div><div class="ttdef"><b>Definition:</b> <a href="../../dc/df6/TrackTrajectory_8h_source.html#l00313">TrackTrajectory.h:313</a></div></div>
<div class="ttc" id="classrecob_1_1TrackTrajectory_html_a7a9804a4f9d6a7ff1d6832a66461c008"><div class="ttname"><a href="../../de/de5/classrecob_1_1TrackTrajectory.html#a7a9804a4f9d6a7ff1d6832a66461c008">recob::TrackTrajectory::Vertex</a></div><div class="ttdeci">Point_t const &amp; Vertex() const </div><div class="ttdoc">Returns the position of the first valid point of the trajectory [cm]. </div><div class="ttdef"><b>Definition:</b> <a href="../../dc/df6/TrackTrajectory_8h_source.html#l00249">TrackTrajectory.h:249</a></div></div>
<div class="ttc" id="classrecob_1_1TrackTrajectory_html_ab0cc936e357b4a3474b11e92b844e474"><div class="ttname"><a href="../../de/de5/classrecob_1_1TrackTrajectory.html#ab0cc936e357b4a3474b11e92b844e474">recob::TrackTrajectory::EndDirection</a></div><div class="ttdeci">Vector_t EndDirection() const </div><div class="ttdoc">Returns the direction of the trajectory at the last point. </div><div class="ttdef"><b>Definition:</b> <a href="../../dc/df6/TrackTrajectory_8h_source.html#l00321">TrackTrajectory.h:321</a></div></div>
<div class="ttc" id="PMAlgTracking_8cxx_html_af99faac002e5718f9ea4ea0c456f6d72"><div class="ttname"><a href="../../db/dfa/PMAlgTracking_8cxx.html#af99faac002e5718f9ea4ea0c456f6d72">SMatrixSym55</a></div><div class="ttdeci">recob::tracking::SMatrixSym55 SMatrixSym55</div><div class="ttdef"><b>Definition:</b> <a href="../../db/dfa/PMAlgTracking_8cxx_source.html#l00022">PMAlgTracking.cxx:22</a></div></div>
<div class="ttc" id="classtrkf_1_1TrackKalmanFitter_html_a2f527686a3b82eaab63104dbb3e870b2"><div class="ttname"><a href="../../d6/dca/classtrkf_1_1TrackKalmanFitter.html#a2f527686a3b82eaab63104dbb3e870b2">trkf::TrackKalmanFitter::tryBothDirs_</a></div><div class="ttdeci">bool tryBothDirs_</div><div class="ttdef"><b>Definition:</b> <a href="../../d7/dcf/TrackKalmanFitter_8h_source.html#l00311">TrackKalmanFitter.h:311</a></div></div>
<div class="ttc" id="classrecob_1_1TrackTrajectory_html_ae4ec67beaff30ba7eee4c6c6b377540c"><div class="ttname"><a href="../../de/de5/classrecob_1_1TrackTrajectory.html#ae4ec67beaff30ba7eee4c6c6b377540c">recob::TrackTrajectory::End</a></div><div class="ttdeci">Point_t const &amp; End() const </div><div class="ttdoc">Returns the position of the last valid point of the trajectory [cm]. </div><div class="ttdef"><b>Definition:</b> <a href="../../dc/df6/TrackTrajectory_8h_source.html#l00257">TrackTrajectory.h:257</a></div></div>
<div class="ttc" id="structtrkmkr_1_1OptionalOutputs_html"><div class="ttname"><a href="../../d0/d41/structtrkmkr_1_1OptionalOutputs.html">trkmkr::OptionalOutputs</a></div><div class="ttdoc">Struct holding optional TrackMaker outputs. </div><div class="ttdef"><b>Definition:</b> <a href="../../d4/d4b/TrackMaker_8h_source.html#l00125">TrackMaker.h:125</a></div></div>
<div class="ttc" id="namespacedetsim_html_a560adbb3abf95a23d45a53ed25d8c0c7"><div class="ttname"><a href="../../d2/d1a/namespacedetsim.html#a560adbb3abf95a23d45a53ed25d8c0c7">detsim::detProp</a></div><div class="ttdeci">auto const detProp</div><div class="ttdef"><b>Definition:</b> <a href="../../d9/df8/SimWire__module_8cc_source.html#l00157">SimWire_module.cc:157</a></div></div>
<div class="ttc" id="classrecob_1_1Track_html"><div class="ttname"><a href="../../d9/dca/classrecob_1_1Track.html">recob::Track</a></div><div class="ttdoc">Track from a non-cascading particle.A recob::Track consists of a recob::TrackTrajectory, plus additional members relevant for a &amp;quot;fitted&amp;quot; track: </div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d53/bj_2lardataobj_2RecoBase_2Track_8h_source.html#l00049">bj/lardataobj/RecoBase/Track.h:49</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a0d7c02137f7bf515122e293b505c8cb1"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool trkf::TrackKalmanFitter::fitTrack </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="../../d1/d11/classdetinfo_1_1DetectorPropertiesData.html">detinfo::DetectorPropertiesData</a> const &amp;&#160;</td>
          <td class="paramname"><em>detProp</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="../../d0/da2/namespacetrkf.html#a38ab77d67362ad2a0af6a2a7997cbf5a">Point_t</a> &amp;&#160;</td>
          <td class="paramname"><em>position</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="../../d0/da2/namespacetrkf.html#afce448b0c24542e8646ade72b3bd51b3">Vector_t</a> &amp;&#160;</td>
          <td class="paramname"><em>direction</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="../../d0/da2/namespacetrkf.html#afce9d7f4b81473c0ba04bac01ee6fa51">SMatrixSym55</a> &amp;&#160;</td>
          <td class="paramname"><em>trackStateCov</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const std::vector&lt; art::Ptr&lt; <a class="el" href="../../db/d4e/classrecob_1_1Hit.html">recob::Hit</a> &gt;&gt; &amp;&#160;</td>
          <td class="paramname"><em>hits</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const std::vector&lt; <a class="el" href="../../d3/d86/classrecob_1_1TrajectoryPointFlags.html">recob::TrajectoryPointFlags</a> &gt; &amp;&#160;</td>
          <td class="paramname"><em>flags</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const int&#160;</td>
          <td class="paramname"><em>tkID</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const double&#160;</td>
          <td class="paramname"><em>pval</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const int&#160;</td>
          <td class="paramname"><em>pdgid</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="../../d9/dca/classrecob_1_1Track.html">recob::Track</a> &amp;&#160;</td>
          <td class="paramname"><em>outTrack</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">std::vector&lt; art::Ptr&lt; <a class="el" href="../../db/d4e/classrecob_1_1Hit.html">recob::Hit</a> &gt;&gt; &amp;&#160;</td>
          <td class="paramname"><em>outHits</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="../../d0/d41/structtrkmkr_1_1OptionalOutputs.html">trkmkr::OptionalOutputs</a> &amp;&#160;</td>
          <td class="paramname"><em>optionals</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td> const</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Fit track starting from intial position, direction, and flags. </p>

<p>Definition at line <a class="el" href="../../de/d68/TrackKalmanFitter_8cxx_source.html#l00138">138</a> of file <a class="el" href="../../de/d68/TrackKalmanFitter_8cxx_source.html">TrackKalmanFitter.cxx</a>.</p>
<div class="fragment"><div class="line"><a name="l00150"></a><span class="lineno">  150</span>&#160;{</div>
<div class="line"><a name="l00151"></a><span class="lineno">  151</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="../../d6/dca/classtrkf_1_1TrackKalmanFitter.html#acbd8f32e18621b3cc8387fc6f01fb190">dumpLevel_</a> &gt; 1)</div>
<div class="line"><a name="l00152"></a><span class="lineno">  152</span>&#160;    <a class="code" href="../../d8/df5/messageservice_8fcl.html#a6699b4dbd72f548e48d81c88697d35a6">std::cout</a> &lt;&lt; <span class="stringliteral">&quot;Fitting track with tkID=&quot;</span> &lt;&lt; tkID &lt;&lt; <span class="stringliteral">&quot; start pos=&quot;</span> &lt;&lt; position</div>
<div class="line"><a name="l00153"></a><span class="lineno">  153</span>&#160;              &lt;&lt; <span class="stringliteral">&quot; dir=&quot;</span> &lt;&lt; direction &lt;&lt; <span class="stringliteral">&quot; nHits=&quot;</span> &lt;&lt; hits.size() &lt;&lt; <span class="stringliteral">&quot; mom=&quot;</span> &lt;&lt; pval</div>
<div class="line"><a name="l00154"></a><span class="lineno">  154</span>&#160;              &lt;&lt; <span class="stringliteral">&quot; pdg=&quot;</span> &lt;&lt; pdgid &lt;&lt; std::endl;</div>
<div class="line"><a name="l00155"></a><span class="lineno">  155</span>&#160;  <span class="keywordflow">if</span> (hits.size() &lt; 4) {</div>
<div class="line"><a name="l00156"></a><span class="lineno">  156</span>&#160;    mf::LogWarning(<span class="stringliteral">&quot;TrackKalmanFitter&quot;</span>) &lt;&lt; <span class="stringliteral">&quot;Fit failure at &quot;</span> &lt;&lt; __FILE__ &lt;&lt; <span class="stringliteral">&quot; &quot;</span> &lt;&lt; __LINE__;</div>
<div class="line"><a name="l00157"></a><span class="lineno">  157</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l00158"></a><span class="lineno">  158</span>&#160;  }</div>
<div class="line"><a name="l00159"></a><span class="lineno">  159</span>&#160;</div>
<div class="line"><a name="l00160"></a><span class="lineno">  160</span>&#160;  <span class="comment">// setup the KFTrackState we&#39;ll use throughout the fit</span></div>
<div class="line"><a name="l00161"></a><span class="lineno">  161</span>&#160;  KFTrackState trackState = <a class="code" href="../../d6/dca/classtrkf_1_1TrackKalmanFitter.html#a231eecc69d011725afd8e5b55295976e">setupInitialTrackState</a>(position, direction, trackStateCov, pval, pdgid);</div>
<div class="line"><a name="l00162"></a><span class="lineno">  162</span>&#160;</div>
<div class="line"><a name="l00163"></a><span class="lineno">  163</span>&#160;  <span class="comment">// setup vector of HitStates and flags, with either same or inverse order as input hit vector</span></div>
<div class="line"><a name="l00164"></a><span class="lineno">  164</span>&#160;  <span class="comment">// this is what we&#39;ll loop over during the fit</span></div>
<div class="line"><a name="l00165"></a><span class="lineno">  165</span>&#160;  std::vector&lt;HitState&gt; hitstatev;</div>
<div class="line"><a name="l00166"></a><span class="lineno">  166</span>&#160;  std::vector&lt;recob::TrajectoryPointFlags::Mask_t&gt; hitflagsv;</div>
<div class="line"><a name="l00167"></a><span class="lineno">  167</span>&#160;  <span class="keywordtype">bool</span> inputok = <a class="code" href="../../d6/dca/classtrkf_1_1TrackKalmanFitter.html#a7a47ff89ff45737db6fd90055305af0c">setupInputStates</a>(<a class="code" href="../../d2/d1a/namespacedetsim.html#a560adbb3abf95a23d45a53ed25d8c0c7">detProp</a>, hits, flags, trackState, hitstatev, hitflagsv);</div>
<div class="line"><a name="l00168"></a><span class="lineno">  168</span>&#160;  <span class="keywordflow">if</span> (!inputok) <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l00169"></a><span class="lineno">  169</span>&#160;</div>
<div class="line"><a name="l00170"></a><span class="lineno">  170</span>&#160;  <span class="comment">// track and index vectors we use to store the fit results</span></div>
<div class="line"><a name="l00171"></a><span class="lineno">  171</span>&#160;  std::vector&lt;KFTrackState&gt; fwdPrdTkState;</div>
<div class="line"><a name="l00172"></a><span class="lineno">  172</span>&#160;  std::vector&lt;KFTrackState&gt; fwdUpdTkState;</div>
<div class="line"><a name="l00173"></a><span class="lineno">  173</span>&#160;  std::vector&lt;unsigned int&gt; hitstateidx;</div>
<div class="line"><a name="l00174"></a><span class="lineno">  174</span>&#160;  std::vector&lt;unsigned int&gt; rejectedhsidx;</div>
<div class="line"><a name="l00175"></a><span class="lineno">  175</span>&#160;  std::vector&lt;unsigned int&gt; sortedtksidx;</div>
<div class="line"><a name="l00176"></a><span class="lineno">  176</span>&#160;</div>
<div class="line"><a name="l00177"></a><span class="lineno">  177</span>&#160;  <span class="comment">// do the actual fit</span></div>
<div class="line"><a name="l00178"></a><span class="lineno">  178</span>&#160;  <span class="keywordtype">bool</span> fitok = <a class="code" href="../../d6/dca/classtrkf_1_1TrackKalmanFitter.html#a4e8612ccdaee7e850a7330f6d955bb1d">doFitWork</a>(trackState,</div>
<div class="line"><a name="l00179"></a><span class="lineno">  179</span>&#160;                         <a class="code" href="../../d2/d1a/namespacedetsim.html#a560adbb3abf95a23d45a53ed25d8c0c7">detProp</a>,</div>
<div class="line"><a name="l00180"></a><span class="lineno">  180</span>&#160;                         hitstatev,</div>
<div class="line"><a name="l00181"></a><span class="lineno">  181</span>&#160;                         hitflagsv,</div>
<div class="line"><a name="l00182"></a><span class="lineno">  182</span>&#160;                         fwdPrdTkState,</div>
<div class="line"><a name="l00183"></a><span class="lineno">  183</span>&#160;                         fwdUpdTkState,</div>
<div class="line"><a name="l00184"></a><span class="lineno">  184</span>&#160;                         hitstateidx,</div>
<div class="line"><a name="l00185"></a><span class="lineno">  185</span>&#160;                         rejectedhsidx,</div>
<div class="line"><a name="l00186"></a><span class="lineno">  186</span>&#160;                         sortedtksidx);</div>
<div class="line"><a name="l00187"></a><span class="lineno">  187</span>&#160;  <span class="keywordflow">if</span> (!fitok &amp;&amp; (<a class="code" href="../../d6/dca/classtrkf_1_1TrackKalmanFitter.html#a439ce5d209c8590832ce4c5612dbf7b7">skipNegProp_</a> || <a class="code" href="../../d6/dca/classtrkf_1_1TrackKalmanFitter.html#ae0c319b72c3d58667842962a195a7752">cleanZigzag_</a>) &amp;&amp; <a class="code" href="../../d6/dca/classtrkf_1_1TrackKalmanFitter.html#a27d510c7be11bd82373d8ab30ac8e6d9">tryNoSkipWhenFails_</a>) {</div>
<div class="line"><a name="l00188"></a><span class="lineno">  188</span>&#160;    mf::LogWarning(<span class="stringliteral">&quot;TrackKalmanFitter&quot;</span>)</div>
<div class="line"><a name="l00189"></a><span class="lineno">  189</span>&#160;      &lt;&lt; <span class="stringliteral">&quot;Trying to recover with skipNegProp = false and cleanZigzag = false\n&quot;</span>;</div>
<div class="line"><a name="l00190"></a><span class="lineno">  190</span>&#160;    fitok = <a class="code" href="../../d6/dca/classtrkf_1_1TrackKalmanFitter.html#a4e8612ccdaee7e850a7330f6d955bb1d">doFitWork</a>(trackState,</div>
<div class="line"><a name="l00191"></a><span class="lineno">  191</span>&#160;                      <a class="code" href="../../d2/d1a/namespacedetsim.html#a560adbb3abf95a23d45a53ed25d8c0c7">detProp</a>,</div>
<div class="line"><a name="l00192"></a><span class="lineno">  192</span>&#160;                      hitstatev,</div>
<div class="line"><a name="l00193"></a><span class="lineno">  193</span>&#160;                      hitflagsv,</div>
<div class="line"><a name="l00194"></a><span class="lineno">  194</span>&#160;                      fwdPrdTkState,</div>
<div class="line"><a name="l00195"></a><span class="lineno">  195</span>&#160;                      fwdUpdTkState,</div>
<div class="line"><a name="l00196"></a><span class="lineno">  196</span>&#160;                      hitstateidx,</div>
<div class="line"><a name="l00197"></a><span class="lineno">  197</span>&#160;                      rejectedhsidx,</div>
<div class="line"><a name="l00198"></a><span class="lineno">  198</span>&#160;                      sortedtksidx,</div>
<div class="line"><a name="l00199"></a><span class="lineno">  199</span>&#160;                      <span class="keyword">false</span>);</div>
<div class="line"><a name="l00200"></a><span class="lineno">  200</span>&#160;  }</div>
<div class="line"><a name="l00201"></a><span class="lineno">  201</span>&#160;  <span class="keywordflow">if</span> (!fitok) {</div>
<div class="line"><a name="l00202"></a><span class="lineno">  202</span>&#160;    mf::LogWarning(<span class="stringliteral">&quot;TrackKalmanFitter&quot;</span>) &lt;&lt; <span class="stringliteral">&quot;Fit failed for track with ID=&quot;</span> &lt;&lt; tkID &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>;</div>
<div class="line"><a name="l00203"></a><span class="lineno">  203</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l00204"></a><span class="lineno">  204</span>&#160;  }</div>
<div class="line"><a name="l00205"></a><span class="lineno">  205</span>&#160;</div>
<div class="line"><a name="l00206"></a><span class="lineno">  206</span>&#160;  <span class="comment">// fill the track, the output hit vector, and the optional output products</span></div>
<div class="line"><a name="l00207"></a><span class="lineno">  207</span>&#160;  <span class="keywordtype">bool</span> fillok = <a class="code" href="../../d6/dca/classtrkf_1_1TrackKalmanFitter.html#a84c42d9dadf9523f2261042da5bead99">fillResult</a>(hits,</div>
<div class="line"><a name="l00208"></a><span class="lineno">  208</span>&#160;                           tkID,</div>
<div class="line"><a name="l00209"></a><span class="lineno">  209</span>&#160;                           pdgid,</div>
<div class="line"><a name="l00210"></a><span class="lineno">  210</span>&#160;                           hitstatev,</div>
<div class="line"><a name="l00211"></a><span class="lineno">  211</span>&#160;                           hitflagsv,</div>
<div class="line"><a name="l00212"></a><span class="lineno">  212</span>&#160;                           fwdPrdTkState,</div>
<div class="line"><a name="l00213"></a><span class="lineno">  213</span>&#160;                           fwdUpdTkState,</div>
<div class="line"><a name="l00214"></a><span class="lineno">  214</span>&#160;                           hitstateidx,</div>
<div class="line"><a name="l00215"></a><span class="lineno">  215</span>&#160;                           rejectedhsidx,</div>
<div class="line"><a name="l00216"></a><span class="lineno">  216</span>&#160;                           sortedtksidx,</div>
<div class="line"><a name="l00217"></a><span class="lineno">  217</span>&#160;                           outTrack,</div>
<div class="line"><a name="l00218"></a><span class="lineno">  218</span>&#160;                           outHits,</div>
<div class="line"><a name="l00219"></a><span class="lineno">  219</span>&#160;                           optionals);</div>
<div class="line"><a name="l00220"></a><span class="lineno">  220</span>&#160;  <span class="keywordflow">return</span> fillok;</div>
<div class="line"><a name="l00221"></a><span class="lineno">  221</span>&#160;}</div>
<div class="ttc" id="classtrkf_1_1TrackKalmanFitter_html_ae0c319b72c3d58667842962a195a7752"><div class="ttname"><a href="../../d6/dca/classtrkf_1_1TrackKalmanFitter.html#ae0c319b72c3d58667842962a195a7752">trkf::TrackKalmanFitter::cleanZigzag_</a></div><div class="ttdeci">bool cleanZigzag_</div><div class="ttdef"><b>Definition:</b> <a href="../../d7/dcf/TrackKalmanFitter_8h_source.html#l00306">TrackKalmanFitter.h:306</a></div></div>
<div class="ttc" id="classtrkf_1_1TrackKalmanFitter_html_a4e8612ccdaee7e850a7330f6d955bb1d"><div class="ttname"><a href="../../d6/dca/classtrkf_1_1TrackKalmanFitter.html#a4e8612ccdaee7e850a7330f6d955bb1d">trkf::TrackKalmanFitter::doFitWork</a></div><div class="ttdeci">bool doFitWork(KFTrackState &amp;trackState, detinfo::DetectorPropertiesData const &amp;detProp, std::vector&lt; HitState &gt; &amp;hitstatev, std::vector&lt; recob::TrajectoryPointFlags::Mask_t &gt; &amp;hitflagsv, std::vector&lt; KFTrackState &gt; &amp;fwdPrdTkState, std::vector&lt; KFTrackState &gt; &amp;fwdUpdTkState, std::vector&lt; unsigned int &gt; &amp;hitstateidx, std::vector&lt; unsigned int &gt; &amp;rejectedhsidx, std::vector&lt; unsigned int &gt; &amp;sortedtksidx, bool applySkipClean=true) const </div><div class="ttdoc">Function where the core of the fit is performed. </div><div class="ttdef"><b>Definition:</b> <a href="../../de/d68/TrackKalmanFitter_8cxx_source.html#l00301">TrackKalmanFitter.cxx:301</a></div></div>
<div class="ttc" id="classtrkf_1_1TrackKalmanFitter_html_a7a47ff89ff45737db6fd90055305af0c"><div class="ttname"><a href="../../d6/dca/classtrkf_1_1TrackKalmanFitter.html#a7a47ff89ff45737db6fd90055305af0c">trkf::TrackKalmanFitter::setupInputStates</a></div><div class="ttdeci">bool setupInputStates(detinfo::DetectorPropertiesData const &amp;detProp, const std::vector&lt; art::Ptr&lt; recob::Hit &gt;&gt; &amp;hits, const std::vector&lt; recob::TrajectoryPointFlags &gt; &amp;flags, const KFTrackState &amp;trackState, std::vector&lt; HitState &gt; &amp;hitstatev, std::vector&lt; recob::TrajectoryPointFlags::Mask_t &gt; &amp;hitflagsv) const </div><div class="ttdoc">Setup vectors of HitState and Masks to be used during the fit. </div><div class="ttdef"><b>Definition:</b> <a href="../../de/d68/TrackKalmanFitter_8cxx_source.html#l00250">TrackKalmanFitter.cxx:250</a></div></div>
<div class="ttc" id="classtrkf_1_1TrackKalmanFitter_html_a27d510c7be11bd82373d8ab30ac8e6d9"><div class="ttname"><a href="../../d6/dca/classtrkf_1_1TrackKalmanFitter.html#a27d510c7be11bd82373d8ab30ac8e6d9">trkf::TrackKalmanFitter::tryNoSkipWhenFails_</a></div><div class="ttdeci">bool tryNoSkipWhenFails_</div><div class="ttdef"><b>Definition:</b> <a href="../../d7/dcf/TrackKalmanFitter_8h_source.html#l00310">TrackKalmanFitter.h:310</a></div></div>
<div class="ttc" id="classtrkf_1_1TrackKalmanFitter_html_acbd8f32e18621b3cc8387fc6f01fb190"><div class="ttname"><a href="../../d6/dca/classtrkf_1_1TrackKalmanFitter.html#acbd8f32e18621b3cc8387fc6f01fb190">trkf::TrackKalmanFitter::dumpLevel_</a></div><div class="ttdeci">int dumpLevel_</div><div class="ttdef"><b>Definition:</b> <a href="../../d7/dcf/TrackKalmanFitter_8h_source.html#l00318">TrackKalmanFitter.h:318</a></div></div>
<div class="ttc" id="classtrkf_1_1TrackKalmanFitter_html_a84c42d9dadf9523f2261042da5bead99"><div class="ttname"><a href="../../d6/dca/classtrkf_1_1TrackKalmanFitter.html#a84c42d9dadf9523f2261042da5bead99">trkf::TrackKalmanFitter::fillResult</a></div><div class="ttdeci">bool fillResult(const std::vector&lt; art::Ptr&lt; recob::Hit &gt;&gt; &amp;inHits, const int tkID, const int pdgid, std::vector&lt; HitState &gt; &amp;hitstatev, std::vector&lt; recob::TrajectoryPointFlags::Mask_t &gt; &amp;hitflagsv, std::vector&lt; KFTrackState &gt; &amp;fwdPrdTkState, std::vector&lt; KFTrackState &gt; &amp;fwdUpdTkState, std::vector&lt; unsigned int &gt; &amp;hitstateidx, std::vector&lt; unsigned int &gt; &amp;rejectedhsidx, std::vector&lt; unsigned int &gt; &amp;sortedtksidx, recob::Track &amp;outTrack, std::vector&lt; art::Ptr&lt; recob::Hit &gt;&gt; &amp;outHits, trkmkr::OptionalOutputs &amp;optionals) const </div><div class="ttdoc">Fill the output objects. </div><div class="ttdef"><b>Definition:</b> <a href="../../de/d68/TrackKalmanFitter_8cxx_source.html#l00946">TrackKalmanFitter.cxx:946</a></div></div>
<div class="ttc" id="classtrkf_1_1TrackKalmanFitter_html_a231eecc69d011725afd8e5b55295976e"><div class="ttname"><a href="../../d6/dca/classtrkf_1_1TrackKalmanFitter.html#a231eecc69d011725afd8e5b55295976e">trkf::TrackKalmanFitter::setupInitialTrackState</a></div><div class="ttdeci">KFTrackState setupInitialTrackState(const Point_t &amp;position, const Vector_t &amp;direction, SMatrixSym55 &amp;trackStateCov, const double pval, const int pdgid) const </div><div class="ttdoc">Return track state from intial position, direction, and covariance. </div><div class="ttdef"><b>Definition:</b> <a href="../../de/d68/TrackKalmanFitter_8cxx_source.html#l00224">TrackKalmanFitter.cxx:224</a></div></div>
<div class="ttc" id="classtrkf_1_1TrackKalmanFitter_html_a439ce5d209c8590832ce4c5612dbf7b7"><div class="ttname"><a href="../../d6/dca/classtrkf_1_1TrackKalmanFitter.html#a439ce5d209c8590832ce4c5612dbf7b7">trkf::TrackKalmanFitter::skipNegProp_</a></div><div class="ttdeci">bool skipNegProp_</div><div class="ttdef"><b>Definition:</b> <a href="../../d7/dcf/TrackKalmanFitter_8h_source.html#l00305">TrackKalmanFitter.h:305</a></div></div>
<div class="ttc" id="messageservice_8fcl_html_a6699b4dbd72f548e48d81c88697d35a6"><div class="ttname"><a href="../../d8/df5/messageservice_8fcl.html#a6699b4dbd72f548e48d81c88697d35a6">cout</a></div><div class="ttdeci">BEGIN_PROLOG could also be cout</div><div class="ttdef"><b>Definition:</b> <a href="../../d8/df5/messageservice_8fcl_source.html#l00010">messageservice.fcl:10</a></div></div>
<div class="ttc" id="namespacedetsim_html_a560adbb3abf95a23d45a53ed25d8c0c7"><div class="ttname"><a href="../../d2/d1a/namespacedetsim.html#a560adbb3abf95a23d45a53ed25d8c0c7">detsim::detProp</a></div><div class="ttdeci">auto const detProp</div><div class="ttdef"><b>Definition:</b> <a href="../../d9/df8/SimWire__module_8cc_source.html#l00157">SimWire_module.cc:157</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a231eecc69d011725afd8e5b55295976e"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="../../d3/d02/classtrkf_1_1KFTrackState.html">trkf::KFTrackState</a> trkf::TrackKalmanFitter::setupInitialTrackState </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="../../d0/da2/namespacetrkf.html#a38ab77d67362ad2a0af6a2a7997cbf5a">Point_t</a> &amp;&#160;</td>
          <td class="paramname"><em>position</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="../../d0/da2/namespacetrkf.html#afce448b0c24542e8646ade72b3bd51b3">Vector_t</a> &amp;&#160;</td>
          <td class="paramname"><em>direction</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="../../d0/da2/namespacetrkf.html#afce9d7f4b81473c0ba04bac01ee6fa51">SMatrixSym55</a> &amp;&#160;</td>
          <td class="paramname"><em>trackStateCov</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const double&#160;</td>
          <td class="paramname"><em>pval</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const int&#160;</td>
          <td class="paramname"><em>pdgid</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td> const</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Return track state from intial position, direction, and covariance. </p>

<p>Definition at line <a class="el" href="../../de/d68/TrackKalmanFitter_8cxx_source.html#l00224">224</a> of file <a class="el" href="../../de/d68/TrackKalmanFitter_8cxx_source.html">TrackKalmanFitter.cxx</a>.</p>
<div class="fragment"><div class="line"><a name="l00229"></a><span class="lineno">  229</span>&#160;{</div>
<div class="line"><a name="l00230"></a><span class="lineno">  230</span>&#160;  <span class="comment">//start from large enough covariance matrix so that the fit is not biased</span></div>
<div class="line"><a name="l00231"></a><span class="lineno">  231</span>&#160;  <span class="keywordflow">if</span> (trackStateCov == <a class="code" href="../../d0/da2/namespacetrkf.html#afce9d7f4b81473c0ba04bac01ee6fa51">SMatrixSym55</a>()) {</div>
<div class="line"><a name="l00232"></a><span class="lineno">  232</span>&#160;    trackStateCov(0, 0) = 1000.;</div>
<div class="line"><a name="l00233"></a><span class="lineno">  233</span>&#160;    trackStateCov(1, 1) = 1000.;</div>
<div class="line"><a name="l00234"></a><span class="lineno">  234</span>&#160;    trackStateCov(2, 2) = 0.25;</div>
<div class="line"><a name="l00235"></a><span class="lineno">  235</span>&#160;    trackStateCov(3, 3) = 0.25;</div>
<div class="line"><a name="l00236"></a><span class="lineno">  236</span>&#160;    trackStateCov(4, 4) = 10.;</div>
<div class="line"><a name="l00237"></a><span class="lineno">  237</span>&#160;  }</div>
<div class="line"><a name="l00238"></a><span class="lineno">  238</span>&#160;  <span class="keywordflow">else</span></div>
<div class="line"><a name="l00239"></a><span class="lineno">  239</span>&#160;    trackStateCov *= 100.;</div>
<div class="line"><a name="l00240"></a><span class="lineno">  240</span>&#160;  <span class="comment">// build vector of parameters on plane with point on the track and direction normal to the plane parallel to the track (so the first four parameters are zero by construction)</span></div>
<div class="line"><a name="l00241"></a><span class="lineno">  241</span>&#160;  <a class="code" href="../../d0/da2/namespacetrkf.html#a76b468986d4bcee16d17dfcae57efae2">SVector5</a> trackStatePar(0., 0., 0., 0., 1. / pval);</div>
<div class="line"><a name="l00242"></a><span class="lineno">  242</span>&#160;  <span class="keywordflow">return</span> KFTrackState(trackStatePar,</div>
<div class="line"><a name="l00243"></a><span class="lineno">  243</span>&#160;                      trackStateCov,</div>
<div class="line"><a name="l00244"></a><span class="lineno">  244</span>&#160;                      <a class="code" href="../../d0/da2/namespacetrkf.html#a41d627d46d1a30e41d4f191ff6acebd8">Plane</a>(position, direction),</div>
<div class="line"><a name="l00245"></a><span class="lineno">  245</span>&#160;                      <span class="keyword">true</span>,</div>
<div class="line"><a name="l00246"></a><span class="lineno">  246</span>&#160;                      pdgid); <span class="comment">//along direction by definition</span></div>
<div class="line"><a name="l00247"></a><span class="lineno">  247</span>&#160;}</div>
<div class="ttc" id="namespacetrkf_html_afce9d7f4b81473c0ba04bac01ee6fa51"><div class="ttname"><a href="../../d0/da2/namespacetrkf.html#afce9d7f4b81473c0ba04bac01ee6fa51">trkf::SMatrixSym55</a></div><div class="ttdeci">recob::tracking::SMatrixSym55 SMatrixSym55</div><div class="ttdef"><b>Definition:</b> <a href="../../d6/d2f/TrackState_8h_source.html#l00015">TrackState.h:15</a></div></div>
<div class="ttc" id="namespacetrkf_html_a76b468986d4bcee16d17dfcae57efae2"><div class="ttname"><a href="../../d0/da2/namespacetrkf.html#a76b468986d4bcee16d17dfcae57efae2">trkf::SVector5</a></div><div class="ttdeci">recob::tracking::SVector5 SVector5</div><div class="ttdef"><b>Definition:</b> <a href="../../d6/d2f/TrackState_8h_source.html#l00012">TrackState.h:12</a></div></div>
<div class="ttc" id="namespacetrkf_html_a41d627d46d1a30e41d4f191ff6acebd8"><div class="ttname"><a href="../../d0/da2/namespacetrkf.html#a41d627d46d1a30e41d4f191ff6acebd8">trkf::Plane</a></div><div class="ttdeci">recob::tracking::Plane Plane</div><div class="ttdef"><b>Definition:</b> <a href="../../d6/d2f/TrackState_8h_source.html#l00017">TrackState.h:17</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a7a47ff89ff45737db6fd90055305af0c"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">bool trkf::TrackKalmanFitter::setupInputStates </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="../../d1/d11/classdetinfo_1_1DetectorPropertiesData.html">detinfo::DetectorPropertiesData</a> const &amp;&#160;</td>
          <td class="paramname"><em>detProp</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const std::vector&lt; art::Ptr&lt; <a class="el" href="../../db/d4e/classrecob_1_1Hit.html">recob::Hit</a> &gt;&gt; &amp;&#160;</td>
          <td class="paramname"><em>hits</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const std::vector&lt; <a class="el" href="../../d3/d86/classrecob_1_1TrajectoryPointFlags.html">recob::TrajectoryPointFlags</a> &gt; &amp;&#160;</td>
          <td class="paramname"><em>flags</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="../../d3/d02/classtrkf_1_1KFTrackState.html">KFTrackState</a> &amp;&#160;</td>
          <td class="paramname"><em>trackState</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">std::vector&lt; <a class="el" href="../../da/d57/classtrkf_1_1HitState.html">HitState</a> &gt; &amp;&#160;</td>
          <td class="paramname"><em>hitstatev</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">std::vector&lt; <a class="el" href="../../d3/d86/classrecob_1_1TrajectoryPointFlags.html#a1fa59abb69bb752ec069798b2f3b8202">recob::TrajectoryPointFlags::Mask_t</a> &gt; &amp;&#160;</td>
          <td class="paramname"><em>hitflagsv</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td> const</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Setup vectors of <a class="el" href="../../da/d57/classtrkf_1_1HitState.html" title="Class for a measurement on a recob::tracking::Plane (plane defined by a wire and the drift direction)...">HitState</a> and Masks to be used during the fit. </p>

<p>Definition at line <a class="el" href="../../de/d68/TrackKalmanFitter_8cxx_source.html#l00250">250</a> of file <a class="el" href="../../de/d68/TrackKalmanFitter_8cxx_source.html">TrackKalmanFitter.cxx</a>.</p>
<div class="fragment"><div class="line"><a name="l00257"></a><span class="lineno">  257</span>&#160;{</div>
<div class="line"><a name="l00258"></a><span class="lineno">  258</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="../../d6/dca/classtrkf_1_1TrackKalmanFitter.html#acbd8f32e18621b3cc8387fc6f01fb190">dumpLevel_</a> &gt; 1)</div>
<div class="line"><a name="l00259"></a><span class="lineno">  259</span>&#160;    <a class="code" href="../../d8/df5/messageservice_8fcl.html#a6699b4dbd72f548e48d81c88697d35a6">std::cout</a> &lt;&lt; <span class="stringliteral">&quot;flags.size()=&quot;</span> &lt;&lt; flags.size() &lt;&lt; <span class="stringliteral">&quot; hits.size()=&quot;</span> &lt;&lt; hits.size() &lt;&lt; std::endl;</div>
<div class="line"><a name="l00260"></a><span class="lineno">  260</span>&#160;</div>
<div class="line"><a name="l00261"></a><span class="lineno">  261</span>&#160;  <span class="comment">// setup vector of HitStates and flags, with either same or inverse order as input hit vector</span></div>
<div class="line"><a name="l00262"></a><span class="lineno">  262</span>&#160;  <span class="comment">// this is what we&#39;ll loop over during the fit</span></div>
<div class="line"><a name="l00263"></a><span class="lineno">  263</span>&#160;  <span class="keyword">const</span> <span class="keywordtype">size_t</span> fsize = flags.size();</div>
<div class="line"><a name="l00264"></a><span class="lineno">  264</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> ihit = 0; ihit != hits.size(); ihit++) {</div>
<div class="line"><a name="l00265"></a><span class="lineno">  265</span>&#160;    <span class="keyword">const</span> <span class="keyword">auto</span>&amp; <a class="code" href="../../d2/d36/cheaterreco_8fcl.html#abf2e819dbf4c327e098bebd4b2dc0597">hit</a> = hits[ihit];</div>
<div class="line"><a name="l00266"></a><span class="lineno">  266</span>&#160;    <span class="keywordtype">double</span> t = <a class="code" href="../../d2/d36/cheaterreco_8fcl.html#abf2e819dbf4c327e098bebd4b2dc0597">hit</a>-&gt;PeakTime();</div>
<div class="line"><a name="l00267"></a><span class="lineno">  267</span>&#160;    <span class="keywordtype">double</span> terr = (<a class="code" href="../../d6/dca/classtrkf_1_1TrackKalmanFitter.html#a36f86ceceded941eb34ee8a1e762c40f">useRMS_</a> ? <a class="code" href="../../d2/d36/cheaterreco_8fcl.html#abf2e819dbf4c327e098bebd4b2dc0597">hit</a>-&gt;RMS() : <a class="code" href="../../d2/d36/cheaterreco_8fcl.html#abf2e819dbf4c327e098bebd4b2dc0597">hit</a>-&gt;SigmaPeakTime());</div>
<div class="line"><a name="l00268"></a><span class="lineno">  268</span>&#160;    <span class="keywordtype">double</span> <a class="code" href="../../d0/d84/run__opflash__electron_8fcl.html#a6673f03521899f7844189bcfd8ee5941">x</a> =</div>
<div class="line"><a name="l00269"></a><span class="lineno">  269</span>&#160;      <a class="code" href="../../d2/d1a/namespacedetsim.html#a560adbb3abf95a23d45a53ed25d8c0c7">detProp</a>.ConvertTicksToX(t, <a class="code" href="../../d2/d36/cheaterreco_8fcl.html#abf2e819dbf4c327e098bebd4b2dc0597">hit</a>-&gt;WireID().Plane, <a class="code" href="../../d2/d36/cheaterreco_8fcl.html#abf2e819dbf4c327e098bebd4b2dc0597">hit</a>-&gt;WireID().TPC, <a class="code" href="../../d2/d36/cheaterreco_8fcl.html#abf2e819dbf4c327e098bebd4b2dc0597">hit</a>-&gt;WireID().Cryostat);</div>
<div class="line"><a name="l00270"></a><span class="lineno">  270</span>&#160;    <span class="keywordtype">double</span> xerr = terr * <a class="code" href="../../d2/d1a/namespacedetsim.html#a560adbb3abf95a23d45a53ed25d8c0c7">detProp</a>.GetXTicksCoefficient();</div>
<div class="line"><a name="l00271"></a><span class="lineno">  271</span>&#160;    hitstatev.emplace_back(</div>
<div class="line"><a name="l00272"></a><span class="lineno">  272</span>&#160;      x, <a class="code" href="../../d6/dca/classtrkf_1_1TrackKalmanFitter.html#a14e5957cb48a5d5b764883a16e38d960">hitErr2ScaleFact_</a> * xerr * xerr, <a class="code" href="../../d2/d36/cheaterreco_8fcl.html#abf2e819dbf4c327e098bebd4b2dc0597">hit</a>-&gt;WireID(), <a class="code" href="../../d6/dca/classtrkf_1_1TrackKalmanFitter.html#a16bded3d3b4f7d0602c76a5b105af9f6">geom</a>-&gt;WireIDToWireGeo(<a class="code" href="../../d2/d36/cheaterreco_8fcl.html#abf2e819dbf4c327e098bebd4b2dc0597">hit</a>-&gt;WireID()));</div>
<div class="line"><a name="l00273"></a><span class="lineno">  273</span>&#160;    <span class="comment">//</span></div>
<div class="line"><a name="l00274"></a><span class="lineno">  274</span>&#160;    <span class="keywordflow">if</span> (fsize &gt; 0 &amp;&amp; ihit &lt; fsize)</div>
<div class="line"><a name="l00275"></a><span class="lineno">  275</span>&#160;      hitflagsv.push_back(flags[ihit].<a class="code" href="../../de/d90/namespacesbn_1_1bits.html#a3b8fd0787ccd1963c6aa5c8bf17f4290">mask</a>());</div>
<div class="line"><a name="l00276"></a><span class="lineno">  276</span>&#160;    <span class="keywordflow">else</span></div>
<div class="line"><a name="l00277"></a><span class="lineno">  277</span>&#160;      hitflagsv.push_back(<a class="code" href="../../d3/d86/classrecob_1_1TrajectoryPointFlags.html#a932d27e481b479d7945b68604cfd2d0e">recob::TrajectoryPointFlags::DefaultFlagsMask</a>());</div>
<div class="line"><a name="l00278"></a><span class="lineno">  278</span>&#160;    <span class="comment">//</span></div>
<div class="line"><a name="l00279"></a><span class="lineno">  279</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="../../d6/dca/classtrkf_1_1TrackKalmanFitter.html#aee1a59befcc52425c5f57815310eb096">rejectHighMultHits_</a> &amp;&amp; <a class="code" href="../../d2/d36/cheaterreco_8fcl.html#abf2e819dbf4c327e098bebd4b2dc0597">hit</a>-&gt;Multiplicity() &gt; 1) {</div>
<div class="line"><a name="l00280"></a><span class="lineno">  280</span>&#160;      hitflagsv.back().set(<a class="code" href="../../d4/dff/structrecob_1_1TrajectoryPointFlagTraits.html#a1760e570fd2707dae33daae0d530f600">recob::TrajectoryPointFlagTraits::Merged</a>);</div>
<div class="line"><a name="l00281"></a><span class="lineno">  281</span>&#160;      hitflagsv.back().set(<a class="code" href="../../d4/dff/structrecob_1_1TrajectoryPointFlagTraits.html#a52e1b0d7701ede6b439780ccfe24dcf6">recob::TrajectoryPointFlagTraits::ExcludedFromFit</a>);</div>
<div class="line"><a name="l00282"></a><span class="lineno">  282</span>&#160;    }</div>
<div class="line"><a name="l00283"></a><span class="lineno">  283</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="../../d6/dca/classtrkf_1_1TrackKalmanFitter.html#a072e8273342653ea9a4150d1b60939b7">rejectHitsNegativeGOF_</a> &amp;&amp; <a class="code" href="../../d2/d36/cheaterreco_8fcl.html#abf2e819dbf4c327e098bebd4b2dc0597">hit</a>-&gt;GoodnessOfFit() &lt; 0) {</div>
<div class="line"><a name="l00284"></a><span class="lineno">  284</span>&#160;      hitflagsv.back().set(<a class="code" href="../../d4/dff/structrecob_1_1TrajectoryPointFlagTraits.html#a243c05ec9753836bcef283ecc16f8a00">recob::TrajectoryPointFlagTraits::Suspicious</a>);</div>
<div class="line"><a name="l00285"></a><span class="lineno">  285</span>&#160;      hitflagsv.back().set(<a class="code" href="../../d4/dff/structrecob_1_1TrajectoryPointFlagTraits.html#a52e1b0d7701ede6b439780ccfe24dcf6">recob::TrajectoryPointFlagTraits::ExcludedFromFit</a>);</div>
<div class="line"><a name="l00286"></a><span class="lineno">  286</span>&#160;    }</div>
<div class="line"><a name="l00287"></a><span class="lineno">  287</span>&#160;    <span class="comment">//</span></div>
<div class="line"><a name="l00288"></a><span class="lineno">  288</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="../../d6/dca/classtrkf_1_1TrackKalmanFitter.html#acbd8f32e18621b3cc8387fc6f01fb190">dumpLevel_</a> &gt; 2)</div>
<div class="line"><a name="l00289"></a><span class="lineno">  289</span>&#160;      <a class="code" href="../../d8/df5/messageservice_8fcl.html#a6699b4dbd72f548e48d81c88697d35a6">std::cout</a> &lt;&lt; <span class="stringliteral">&quot;pushed flag mask=&quot;</span> &lt;&lt; hitflagsv.back()</div>
<div class="line"><a name="l00290"></a><span class="lineno">  290</span>&#160;                &lt;&lt; <span class="stringliteral">&quot; merged=&quot;</span> &lt;&lt; hitflagsv.back().isSet(<a class="code" href="../../d4/dff/structrecob_1_1TrajectoryPointFlagTraits.html#a1760e570fd2707dae33daae0d530f600">recob::TrajectoryPointFlagTraits::Merged</a>)</div>
<div class="line"><a name="l00291"></a><span class="lineno">  291</span>&#160;                &lt;&lt; <span class="stringliteral">&quot; suspicious=&quot;</span></div>
<div class="line"><a name="l00292"></a><span class="lineno">  292</span>&#160;                &lt;&lt; hitflagsv.back().isSet(<a class="code" href="../../d4/dff/structrecob_1_1TrajectoryPointFlagTraits.html#a243c05ec9753836bcef283ecc16f8a00">recob::TrajectoryPointFlagTraits::Suspicious</a>)</div>
<div class="line"><a name="l00293"></a><span class="lineno">  293</span>&#160;                &lt;&lt; <span class="stringliteral">&quot; nopoint=&quot;</span> &lt;&lt; hitflagsv.back().isSet(<a class="code" href="../../d4/dff/structrecob_1_1TrajectoryPointFlagTraits.html#a7a1b836f14bde0eb20ca4da2ead61a53">recob::TrajectoryPointFlagTraits::NoPoint</a>)</div>
<div class="line"><a name="l00294"></a><span class="lineno">  294</span>&#160;                &lt;&lt; std::endl;</div>
<div class="line"><a name="l00295"></a><span class="lineno">  295</span>&#160;  }</div>
<div class="line"><a name="l00296"></a><span class="lineno">  296</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="../../d6/dca/classtrkf_1_1TrackKalmanFitter.html#acbd8f32e18621b3cc8387fc6f01fb190">dumpLevel_</a> &gt; 2) assert(hits.size() == hitstatev.size());</div>
<div class="line"><a name="l00297"></a><span class="lineno">  297</span>&#160;  <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l00298"></a><span class="lineno">  298</span>&#160;}</div>
<div class="ttc" id="structrecob_1_1TrajectoryPointFlagTraits_html_a1760e570fd2707dae33daae0d530f600"><div class="ttname"><a href="../../d4/dff/structrecob_1_1TrajectoryPointFlagTraits.html#a1760e570fd2707dae33daae0d530f600">recob::TrajectoryPointFlagTraits::Merged</a></div><div class="ttdeci">static constexpr Flag_t Merged</div><div class="ttdoc">The hit might have contribution from particles other than this. </div><div class="ttdef"><b>Definition:</b> <a href="../../dd/d67/TrajectoryPointFlags_8h_source.html#l00132">TrajectoryPointFlags.h:132</a></div></div>
<div class="ttc" id="structrecob_1_1TrajectoryPointFlagTraits_html_a243c05ec9753836bcef283ecc16f8a00"><div class="ttname"><a href="../../d4/dff/structrecob_1_1TrajectoryPointFlagTraits.html#a243c05ec9753836bcef283ecc16f8a00">recob::TrajectoryPointFlagTraits::Suspicious</a></div><div class="ttdeci">static constexpr Flag_t Suspicious</div><div class="ttdoc">The point reconstruction is somehow questionable. </div><div class="ttdef"><b>Definition:</b> <a href="../../dd/d67/TrajectoryPointFlags_8h_source.html#l00129">TrajectoryPointFlags.h:129</a></div></div>
<div class="ttc" id="classtrkf_1_1TrackKalmanFitter_html_a14e5957cb48a5d5b764883a16e38d960"><div class="ttname"><a href="../../d6/dca/classtrkf_1_1TrackKalmanFitter.html#a14e5957cb48a5d5b764883a16e38d960">trkf::TrackKalmanFitter::hitErr2ScaleFact_</a></div><div class="ttdeci">float hitErr2ScaleFact_</div><div class="ttdef"><b>Definition:</b> <a href="../../d7/dcf/TrackKalmanFitter_8h_source.html#l00309">TrackKalmanFitter.h:309</a></div></div>
<div class="ttc" id="run__opflash__electron_8fcl_html_a6673f03521899f7844189bcfd8ee5941"><div class="ttname"><a href="../../d0/d84/run__opflash__electron_8fcl.html#a6673f03521899f7844189bcfd8ee5941">x</a></div><div class="ttdeci">process_name opflash particleana ie x</div><div class="ttdef"><b>Definition:</b> <a href="../../d0/d84/run__opflash__electron_8fcl_source.html#l00090">run_opflash_electron.fcl:90</a></div></div>
<div class="ttc" id="structrecob_1_1TrajectoryPointFlagTraits_html_a7a1b836f14bde0eb20ca4da2ead61a53"><div class="ttname"><a href="../../d4/dff/structrecob_1_1TrajectoryPointFlagTraits.html#a7a1b836f14bde0eb20ca4da2ead61a53">recob::TrajectoryPointFlagTraits::NoPoint</a></div><div class="ttdeci">static constexpr Flag_t NoPoint</div><div class="ttdoc">The trajectory point is not defined. </div><div class="ttdef"><b>Definition:</b> <a href="../../dd/d67/TrajectoryPointFlags_8h_source.html#l00119">TrajectoryPointFlags.h:119</a></div></div>
<div class="ttc" id="classrecob_1_1TrajectoryPointFlags_html_a932d27e481b479d7945b68604cfd2d0e"><div class="ttname"><a href="../../d3/d86/classrecob_1_1TrajectoryPointFlags.html#a932d27e481b479d7945b68604cfd2d0e">recob::TrajectoryPointFlags::DefaultFlagsMask</a></div><div class="ttdeci">static constexpr Mask_t DefaultFlagsMask()</div><div class="ttdoc">Flags used in default construction. </div><div class="ttdef"><b>Definition:</b> <a href="../../dd/d67/TrajectoryPointFlags_8h_source.html#l00789">TrajectoryPointFlags.h:789</a></div></div>
<div class="ttc" id="classtrkf_1_1TrackKalmanFitter_html_a16bded3d3b4f7d0602c76a5b105af9f6"><div class="ttname"><a href="../../d6/dca/classtrkf_1_1TrackKalmanFitter.html#a16bded3d3b4f7d0602c76a5b105af9f6">trkf::TrackKalmanFitter::geom</a></div><div class="ttdeci">art::ServiceHandle&lt; geo::Geometry const  &gt; geom</div><div class="ttdef"><b>Definition:</b> <a href="../../d7/dcf/TrackKalmanFitter_8h_source.html#l00299">TrackKalmanFitter.h:299</a></div></div>
<div class="ttc" id="cheaterreco_8fcl_html_abf2e819dbf4c327e098bebd4b2dc0597"><div class="ttname"><a href="../../d2/d36/cheaterreco_8fcl.html#abf2e819dbf4c327e098bebd4b2dc0597">hit</a></div><div class="ttdeci">process_name hit</div><div class="ttdef"><b>Definition:</b> <a href="../../d2/d36/cheaterreco_8fcl_source.html#l00051">cheaterreco.fcl:51</a></div></div>
<div class="ttc" id="classtrkf_1_1TrackKalmanFitter_html_acbd8f32e18621b3cc8387fc6f01fb190"><div class="ttname"><a href="../../d6/dca/classtrkf_1_1TrackKalmanFitter.html#acbd8f32e18621b3cc8387fc6f01fb190">trkf::TrackKalmanFitter::dumpLevel_</a></div><div class="ttdeci">int dumpLevel_</div><div class="ttdef"><b>Definition:</b> <a href="../../d7/dcf/TrackKalmanFitter_8h_source.html#l00318">TrackKalmanFitter.h:318</a></div></div>
<div class="ttc" id="classtrkf_1_1TrackKalmanFitter_html_a072e8273342653ea9a4150d1b60939b7"><div class="ttname"><a href="../../d6/dca/classtrkf_1_1TrackKalmanFitter.html#a072e8273342653ea9a4150d1b60939b7">trkf::TrackKalmanFitter::rejectHitsNegativeGOF_</a></div><div class="ttdeci">bool rejectHitsNegativeGOF_</div><div class="ttdef"><b>Definition:</b> <a href="../../d7/dcf/TrackKalmanFitter_8h_source.html#l00308">TrackKalmanFitter.h:308</a></div></div>
<div class="ttc" id="namespacesbn_1_1bits_html_a3b8fd0787ccd1963c6aa5c8bf17f4290"><div class="ttname"><a href="../../de/d90/namespacesbn_1_1bits.html#a3b8fd0787ccd1963c6aa5c8bf17f4290">sbn::bits::mask</a></div><div class="ttdeci">constexpr mask_t&lt; EnumType &gt; mask(EnumType bit, OtherBits...otherBits)</div><div class="ttdoc">Returns a mask with all specified bits set. </div></div>
<div class="ttc" id="classtrkf_1_1TrackKalmanFitter_html_a36f86ceceded941eb34ee8a1e762c40f"><div class="ttname"><a href="../../d6/dca/classtrkf_1_1TrackKalmanFitter.html#a36f86ceceded941eb34ee8a1e762c40f">trkf::TrackKalmanFitter::useRMS_</a></div><div class="ttdeci">bool useRMS_</div><div class="ttdef"><b>Definition:</b> <a href="../../d7/dcf/TrackKalmanFitter_8h_source.html#l00301">TrackKalmanFitter.h:301</a></div></div>
<div class="ttc" id="classtrkf_1_1TrackKalmanFitter_html_aee1a59befcc52425c5f57815310eb096"><div class="ttname"><a href="../../d6/dca/classtrkf_1_1TrackKalmanFitter.html#aee1a59befcc52425c5f57815310eb096">trkf::TrackKalmanFitter::rejectHighMultHits_</a></div><div class="ttdeci">bool rejectHighMultHits_</div><div class="ttdef"><b>Definition:</b> <a href="../../d7/dcf/TrackKalmanFitter_8h_source.html#l00307">TrackKalmanFitter.h:307</a></div></div>
<div class="ttc" id="structrecob_1_1TrajectoryPointFlagTraits_html_a52e1b0d7701ede6b439780ccfe24dcf6"><div class="ttname"><a href="../../d4/dff/structrecob_1_1TrajectoryPointFlagTraits.html#a52e1b0d7701ede6b439780ccfe24dcf6">recob::TrajectoryPointFlagTraits::ExcludedFromFit</a></div><div class="ttdeci">static constexpr Flag_t ExcludedFromFit</div><div class="ttdef"><b>Definition:</b> <a href="../../dd/d67/TrajectoryPointFlags_8h_source.html#l00169">TrajectoryPointFlags.h:169</a></div></div>
<div class="ttc" id="messageservice_8fcl_html_a6699b4dbd72f548e48d81c88697d35a6"><div class="ttname"><a href="../../d8/df5/messageservice_8fcl.html#a6699b4dbd72f548e48d81c88697d35a6">cout</a></div><div class="ttdeci">BEGIN_PROLOG could also be cout</div><div class="ttdef"><b>Definition:</b> <a href="../../d8/df5/messageservice_8fcl_source.html#l00010">messageservice.fcl:10</a></div></div>
<div class="ttc" id="namespacedetsim_html_a560adbb3abf95a23d45a53ed25d8c0c7"><div class="ttname"><a href="../../d2/d1a/namespacedetsim.html#a560adbb3abf95a23d45a53ed25d8c0c7">detsim::detProp</a></div><div class="ttdeci">auto const detProp</div><div class="ttdef"><b>Definition:</b> <a href="../../d9/df8/SimWire__module_8cc_source.html#l00157">SimWire_module.cc:157</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a1234a68e20de47fcd42999626d6c07e4"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">void trkf::TrackKalmanFitter::sortOutput </td>
          <td>(</td>
          <td class="paramtype">std::vector&lt; <a class="el" href="../../da/d57/classtrkf_1_1HitState.html">HitState</a> &gt; &amp;&#160;</td>
          <td class="paramname"><em>hitstatev</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">std::vector&lt; <a class="el" href="../../d3/d02/classtrkf_1_1KFTrackState.html">KFTrackState</a> &gt; &amp;&#160;</td>
          <td class="paramname"><em>fwdUpdTkState</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">std::vector&lt; unsigned int &gt; &amp;&#160;</td>
          <td class="paramname"><em>hitstateidx</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">std::vector&lt; unsigned int &gt; &amp;&#160;</td>
          <td class="paramname"><em>rejectedhsidx</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">std::vector&lt; unsigned int &gt; &amp;&#160;</td>
          <td class="paramname"><em>sortedtksidx</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">std::vector&lt; <a class="el" href="../../d3/d86/classrecob_1_1TrajectoryPointFlags.html#a1fa59abb69bb752ec069798b2f3b8202">recob::TrajectoryPointFlags::Mask_t</a> &gt; &amp;&#160;</td>
          <td class="paramname"><em>hitflagsv</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">bool&#160;</td>
          <td class="paramname"><em>applySkipClean</em> = <code><a class="el" href="../../de/d36/crtt0matchingalg__sbnd_8fcl.html#af8bc618309fb2d0f55f7f5ae0760b466">true</a></code>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td> const</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Sort the output states. </p>

<p>Definition at line <a class="el" href="../../de/d68/TrackKalmanFitter_8cxx_source.html#l00821">821</a> of file <a class="el" href="../../de/d68/TrackKalmanFitter_8cxx_source.html">TrackKalmanFitter.cxx</a>.</p>
<div class="fragment"><div class="line"><a name="l00828"></a><span class="lineno">  828</span>&#160;{</div>
<div class="line"><a name="l00829"></a><span class="lineno">  829</span>&#160;  <span class="comment">//</span></div>
<div class="line"><a name="l00830"></a><span class="lineno">  830</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="../../d6/dca/classtrkf_1_1TrackKalmanFitter.html#a48c558422473744a041b99ee95c59d95">sortOutputHitsMinLength_</a>) {</div>
<div class="line"><a name="l00831"></a><span class="lineno">  831</span>&#160;    <span class="comment">//sort hits keeping fixed the order on planes and picking the closest next plane</span></div>
<div class="line"><a name="l00832"></a><span class="lineno">  832</span>&#160;    <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> nplanes = <a class="code" href="../../d6/dca/classtrkf_1_1TrackKalmanFitter.html#a16bded3d3b4f7d0602c76a5b105af9f6">geom</a>-&gt;MaxPlanes();</div>
<div class="line"><a name="l00833"></a><span class="lineno">  833</span>&#160;    std::vector&lt;std::vector&lt;unsigned int&gt;&gt; tracksInPlanes(nplanes);</div>
<div class="line"><a name="l00834"></a><span class="lineno">  834</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="../../d9/dd2/selectors_8fcl.html#a24c8335057af14a9b508d5ac18999ce5">p</a> = 0; <a class="code" href="../../d9/dd2/selectors_8fcl.html#a24c8335057af14a9b508d5ac18999ce5">p</a> &lt; hitstateidx.size(); ++<a class="code" href="../../d9/dd2/selectors_8fcl.html#a24c8335057af14a9b508d5ac18999ce5">p</a>) {</div>
<div class="line"><a name="l00835"></a><span class="lineno">  835</span>&#160;      <span class="keyword">const</span> <span class="keyword">auto</span>&amp; hitstate = hitstatev[hitstateidx[<a class="code" href="../../d9/dd2/selectors_8fcl.html#a24c8335057af14a9b508d5ac18999ce5">p</a>]];</div>
<div class="line"><a name="l00836"></a><span class="lineno">  836</span>&#160;      tracksInPlanes[hitstate.wireId().Plane].push_back(<a class="code" href="../../d9/dd2/selectors_8fcl.html#a24c8335057af14a9b508d5ac18999ce5">p</a>);</div>
<div class="line"><a name="l00837"></a><span class="lineno">  837</span>&#160;    }</div>
<div class="line"><a name="l00838"></a><span class="lineno">  838</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="../../d6/dca/classtrkf_1_1TrackKalmanFitter.html#acbd8f32e18621b3cc8387fc6f01fb190">dumpLevel_</a> &gt; 2) {</div>
<div class="line"><a name="l00839"></a><span class="lineno">  839</span>&#160;      <span class="keywordflow">for</span> (<span class="keyword">auto</span> <a class="code" href="../../d0/dea/file__to__url_8sh.html#a096ad3d3698082826189c839d7a6e46f">s</a> : fwdUpdTkState) {</div>
<div class="line"><a name="l00840"></a><span class="lineno">  840</span>&#160;        <a class="code" href="../../d8/df5/messageservice_8fcl.html#a6699b4dbd72f548e48d81c88697d35a6">std::cout</a> &lt;&lt; <span class="stringliteral">&quot;state pos=&quot;</span> &lt;&lt; <a class="code" href="../../d0/dea/file__to__url_8sh.html#a096ad3d3698082826189c839d7a6e46f">s</a>.position() &lt;&lt; std::endl;</div>
<div class="line"><a name="l00841"></a><span class="lineno">  841</span>&#160;      }</div>
<div class="line"><a name="l00842"></a><span class="lineno">  842</span>&#160;    }</div>
<div class="line"><a name="l00843"></a><span class="lineno">  843</span>&#160;    <span class="comment">//find good starting point</span></div>
<div class="line"><a name="l00844"></a><span class="lineno">  844</span>&#160;    std::vector&lt;unsigned int&gt; iterTracksInPlanes;</div>
<div class="line"><a name="l00845"></a><span class="lineno">  845</span>&#160;    <span class="keywordflow">for</span> (<span class="keyword">auto</span> it : tracksInPlanes)</div>
<div class="line"><a name="l00846"></a><span class="lineno">  846</span>&#160;      iterTracksInPlanes.push_back(0);</div>
<div class="line"><a name="l00847"></a><span class="lineno">  847</span>&#160;    <span class="keyword">auto</span> pos = fwdUpdTkState.front().position();</div>
<div class="line"><a name="l00848"></a><span class="lineno">  848</span>&#160;    <span class="keyword">auto</span> <a class="code" href="../../de/d9a/namespacedropbox.html#a407b5b895ba9265893768748aaa73825">dir</a> = fwdUpdTkState.front().momentum();</div>
<div class="line"><a name="l00849"></a><span class="lineno">  849</span>&#160;    <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="../../d9/dd2/selectors_8fcl.html#a24c8335057af14a9b508d5ac18999ce5">p</a> = 0;</div>
<div class="line"><a name="l00850"></a><span class="lineno">  850</span>&#160;    <span class="keywordflow">for</span> (; p &lt; fwdUpdTkState.size(); ++<a class="code" href="../../d9/dd2/selectors_8fcl.html#a24c8335057af14a9b508d5ac18999ce5">p</a>) {</div>
<div class="line"><a name="l00851"></a><span class="lineno">  851</span>&#160;      <span class="keywordflow">if</span> (hitflagsv[hitstateidx[p]].isSet(<a class="code" href="../../d4/dff/structrecob_1_1TrajectoryPointFlagTraits.html#a52e1b0d7701ede6b439780ccfe24dcf6">recob::TrajectoryPointFlagTraits::ExcludedFromFit</a>) == 0) {</div>
<div class="line"><a name="l00852"></a><span class="lineno">  852</span>&#160;        pos = fwdUpdTkState[<a class="code" href="../../d9/dd2/selectors_8fcl.html#a24c8335057af14a9b508d5ac18999ce5">p</a>].position();</div>
<div class="line"><a name="l00853"></a><span class="lineno">  853</span>&#160;        <a class="code" href="../../de/d9a/namespacedropbox.html#a407b5b895ba9265893768748aaa73825">dir</a> = fwdUpdTkState[<a class="code" href="../../d9/dd2/selectors_8fcl.html#a24c8335057af14a9b508d5ac18999ce5">p</a>].momentum();</div>
<div class="line"><a name="l00854"></a><span class="lineno">  854</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="../../d6/dca/classtrkf_1_1TrackKalmanFitter.html#acbd8f32e18621b3cc8387fc6f01fb190">dumpLevel_</a> &gt; 2)</div>
<div class="line"><a name="l00855"></a><span class="lineno">  855</span>&#160;          <a class="code" href="../../d8/df5/messageservice_8fcl.html#a6699b4dbd72f548e48d81c88697d35a6">std::cout</a> &lt;&lt; <span class="stringliteral">&quot;sort output found point not excluded with p=&quot;</span> &lt;&lt; p</div>
<div class="line"><a name="l00856"></a><span class="lineno">  856</span>&#160;                    &lt;&lt; <span class="stringliteral">&quot; hitstateidx[p]=&quot;</span> &lt;&lt; hitstateidx[<a class="code" href="../../d9/dd2/selectors_8fcl.html#a24c8335057af14a9b508d5ac18999ce5">p</a>] &lt;&lt; <span class="stringliteral">&quot; pos=&quot;</span> &lt;&lt; pos &lt;&lt; std::endl;</div>
<div class="line"><a name="l00857"></a><span class="lineno">  857</span>&#160;        <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00858"></a><span class="lineno">  858</span>&#160;      }</div>
<div class="line"><a name="l00859"></a><span class="lineno">  859</span>&#160;      <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00860"></a><span class="lineno">  860</span>&#160;        rejectedhsidx.push_back(hitstateidx[p]);</div>
<div class="line"><a name="l00861"></a><span class="lineno">  861</span>&#160;      }</div>
<div class="line"><a name="l00862"></a><span class="lineno">  862</span>&#160;    }</div>
<div class="line"><a name="l00863"></a><span class="lineno">  863</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="../../d6/dca/classtrkf_1_1TrackKalmanFitter.html#acbd8f32e18621b3cc8387fc6f01fb190">dumpLevel_</a> &gt; 1)</div>
<div class="line"><a name="l00864"></a><span class="lineno">  864</span>&#160;      <a class="code" href="../../d8/df5/messageservice_8fcl.html#a6699b4dbd72f548e48d81c88697d35a6">std::cout</a> &lt;&lt; <span class="stringliteral">&quot;sort output init with pos=&quot;</span> &lt;&lt; pos &lt;&lt; <span class="stringliteral">&quot; dir=&quot;</span> &lt;&lt; <a class="code" href="../../de/d9a/namespacedropbox.html#a407b5b895ba9265893768748aaa73825">dir</a> &lt;&lt; std::endl;</div>
<div class="line"><a name="l00865"></a><span class="lineno">  865</span>&#160;    <span class="comment">//pick hits based on minimum dot product with respect to position and direction at previous hit</span></div>
<div class="line"><a name="l00866"></a><span class="lineno">  866</span>&#160;    <span class="keywordflow">for</span> (; p &lt; fwdUpdTkState.size(); ++<a class="code" href="../../d9/dd2/selectors_8fcl.html#a24c8335057af14a9b508d5ac18999ce5">p</a>) {</div>
<div class="line"><a name="l00867"></a><span class="lineno">  867</span>&#160;      <span class="keywordtype">int</span> min_plane = -1;</div>
<div class="line"><a name="l00868"></a><span class="lineno">  868</span>&#160;      <span class="keywordtype">double</span> min_dotp = DBL_MAX;</div>
<div class="line"><a name="l00869"></a><span class="lineno">  869</span>&#160;      <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> iplane = 0; iplane &lt; iterTracksInPlanes.size(); ++iplane) {</div>
<div class="line"><a name="l00870"></a><span class="lineno">  870</span>&#160;        <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span>&amp; itk = iterTracksInPlanes[iplane]; itk &lt; tracksInPlanes[iplane].size();</div>
<div class="line"><a name="l00871"></a><span class="lineno">  871</span>&#160;             ++itk) {</div>
<div class="line"><a name="l00872"></a><span class="lineno">  872</span>&#160;          <span class="keyword">auto</span>&amp; trackstate = fwdUpdTkState[tracksInPlanes[iplane][iterTracksInPlanes[iplane]]];</div>
<div class="line"><a name="l00873"></a><span class="lineno">  873</span>&#160;          <span class="keyword">auto</span>&amp; tmppos = trackstate.position();</div>
<div class="line"><a name="l00874"></a><span class="lineno">  874</span>&#160;          <span class="keyword">const</span> <span class="keywordtype">double</span> dotp = <a class="code" href="../../de/d9a/namespacedropbox.html#a407b5b895ba9265893768748aaa73825">dir</a>.Dot(tmppos - pos);</div>
<div class="line"><a name="l00875"></a><span class="lineno">  875</span>&#160;          <span class="keywordflow">if</span> (<a class="code" href="../../d6/dca/classtrkf_1_1TrackKalmanFitter.html#acbd8f32e18621b3cc8387fc6f01fb190">dumpLevel_</a> &gt; 2)</div>
<div class="line"><a name="l00876"></a><span class="lineno">  876</span>&#160;            <a class="code" href="../../d8/df5/messageservice_8fcl.html#a6699b4dbd72f548e48d81c88697d35a6">std::cout</a> &lt;&lt; <span class="stringliteral">&quot;iplane=&quot;</span> &lt;&lt; iplane &lt;&lt; <span class="stringliteral">&quot; tmppos=&quot;</span> &lt;&lt; tmppos &lt;&lt; <span class="stringliteral">&quot; tmpdir=&quot;</span> &lt;&lt; tmppos - pos</div>
<div class="line"><a name="l00877"></a><span class="lineno">  877</span>&#160;                      &lt;&lt; <span class="stringliteral">&quot; dotp=&quot;</span> &lt;&lt; dotp &lt;&lt; std::endl;</div>
<div class="line"><a name="l00878"></a><span class="lineno">  878</span>&#160;          <span class="keywordflow">if</span> (dotp &lt; min_dotp) {</div>
<div class="line"><a name="l00879"></a><span class="lineno">  879</span>&#160;            min_plane = iplane;</div>
<div class="line"><a name="l00880"></a><span class="lineno">  880</span>&#160;            min_dotp = dotp;</div>
<div class="line"><a name="l00881"></a><span class="lineno">  881</span>&#160;          }</div>
<div class="line"><a name="l00882"></a><span class="lineno">  882</span>&#160;          <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00883"></a><span class="lineno">  883</span>&#160;        }</div>
<div class="line"><a name="l00884"></a><span class="lineno">  884</span>&#160;      }</div>
<div class="line"><a name="l00885"></a><span class="lineno">  885</span>&#160;      <span class="keywordflow">if</span> (min_plane &lt; 0) <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l00886"></a><span class="lineno">  886</span>&#160;      <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> ihit = tracksInPlanes[min_plane][iterTracksInPlanes[min_plane]];</div>
<div class="line"><a name="l00887"></a><span class="lineno">  887</span>&#160;      <span class="keywordflow">if</span> (applySkipClean &amp;&amp; <a class="code" href="../../d6/dca/classtrkf_1_1TrackKalmanFitter.html#a439ce5d209c8590832ce4c5612dbf7b7">skipNegProp_</a> &amp;&amp; min_dotp &lt; <a class="code" href="../../d6/dca/classtrkf_1_1TrackKalmanFitter.html#a2efa447160c8b4b0cb5fddc93cd05352">negDistTolerance_</a> &amp;&amp;</div>
<div class="line"><a name="l00888"></a><span class="lineno">  888</span>&#160;          sortedtksidx.size() &gt; 0) {</div>
<div class="line"><a name="l00889"></a><span class="lineno">  889</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="../../d6/dca/classtrkf_1_1TrackKalmanFitter.html#acbd8f32e18621b3cc8387fc6f01fb190">dumpLevel_</a> &gt; 2)</div>
<div class="line"><a name="l00890"></a><span class="lineno">  890</span>&#160;          <a class="code" href="../../d8/df5/messageservice_8fcl.html#a6699b4dbd72f548e48d81c88697d35a6">std::cout</a> &lt;&lt; <span class="stringliteral">&quot;sort output rejecting hit #&quot;</span> &lt;&lt; ihit &lt;&lt; <span class="stringliteral">&quot; plane=&quot;</span> &lt;&lt; min_plane</div>
<div class="line"><a name="l00891"></a><span class="lineno">  891</span>&#160;                    &lt;&lt; <span class="stringliteral">&quot; with min_dotp=&quot;</span> &lt;&lt; min_dotp &lt;&lt; std::endl;</div>
<div class="line"><a name="l00892"></a><span class="lineno">  892</span>&#160;        rejectedhsidx.push_back(hitstateidx[ihit]);</div>
<div class="line"><a name="l00893"></a><span class="lineno">  893</span>&#160;        iterTracksInPlanes[min_plane]++;</div>
<div class="line"><a name="l00894"></a><span class="lineno">  894</span>&#160;        <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l00895"></a><span class="lineno">  895</span>&#160;      }</div>
<div class="line"><a name="l00896"></a><span class="lineno">  896</span>&#160;      <span class="keywordflow">if</span> (<a class="code" href="../../d6/dca/classtrkf_1_1TrackKalmanFitter.html#acbd8f32e18621b3cc8387fc6f01fb190">dumpLevel_</a> &gt; 2)</div>
<div class="line"><a name="l00897"></a><span class="lineno">  897</span>&#160;        <a class="code" href="../../d8/df5/messageservice_8fcl.html#a6699b4dbd72f548e48d81c88697d35a6">std::cout</a> &lt;&lt; <span class="stringliteral">&quot;sort output picking hit #&quot;</span> &lt;&lt; ihit &lt;&lt; <span class="stringliteral">&quot; plane=&quot;</span> &lt;&lt; min_plane</div>
<div class="line"><a name="l00898"></a><span class="lineno">  898</span>&#160;                  &lt;&lt; <span class="stringliteral">&quot; with min_dotp=&quot;</span> &lt;&lt; min_dotp &lt;&lt; std::endl;</div>
<div class="line"><a name="l00899"></a><span class="lineno">  899</span>&#160;      <span class="keyword">auto</span>&amp; trackstate = fwdUpdTkState[ihit];</div>
<div class="line"><a name="l00900"></a><span class="lineno">  900</span>&#160;      pos = trackstate.position();</div>
<div class="line"><a name="l00901"></a><span class="lineno">  901</span>&#160;      <a class="code" href="../../de/d9a/namespacedropbox.html#a407b5b895ba9265893768748aaa73825">dir</a> = trackstate.momentum();</div>
<div class="line"><a name="l00902"></a><span class="lineno">  902</span>&#160;      <span class="comment">//</span></div>
<div class="line"><a name="l00903"></a><span class="lineno">  903</span>&#160;      sortedtksidx.push_back(ihit);</div>
<div class="line"><a name="l00904"></a><span class="lineno">  904</span>&#160;      iterTracksInPlanes[min_plane]++;</div>
<div class="line"><a name="l00905"></a><span class="lineno">  905</span>&#160;    }</div>
<div class="line"><a name="l00906"></a><span class="lineno">  906</span>&#160;  }</div>
<div class="line"><a name="l00907"></a><span class="lineno">  907</span>&#160;  <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00908"></a><span class="lineno">  908</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> p = 0; p &lt; fwdUpdTkState.size(); ++<a class="code" href="../../d9/dd2/selectors_8fcl.html#a24c8335057af14a9b508d5ac18999ce5">p</a>) {</div>
<div class="line"><a name="l00909"></a><span class="lineno">  909</span>&#160;      sortedtksidx.push_back(p);</div>
<div class="line"><a name="l00910"></a><span class="lineno">  910</span>&#160;    }</div>
<div class="line"><a name="l00911"></a><span class="lineno">  911</span>&#160;  }</div>
<div class="line"><a name="l00912"></a><span class="lineno">  912</span>&#160;  <span class="comment">//</span></div>
<div class="line"><a name="l00913"></a><span class="lineno">  913</span>&#160;  <span class="keywordflow">if</span> (applySkipClean &amp;&amp; <a class="code" href="../../d6/dca/classtrkf_1_1TrackKalmanFitter.html#ae0c319b72c3d58667842962a195a7752">cleanZigzag_</a>) {</div>
<div class="line"><a name="l00914"></a><span class="lineno">  914</span>&#160;    std::vector&lt;unsigned int&gt; itoerase;</div>
<div class="line"><a name="l00915"></a><span class="lineno">  915</span>&#160;    <span class="keywordtype">bool</span> clean = <span class="keyword">false</span>;</div>
<div class="line"><a name="l00916"></a><span class="lineno">  916</span>&#160;    <span class="keywordflow">while</span> (!clean) {</div>
<div class="line"><a name="l00917"></a><span class="lineno">  917</span>&#160;      <span class="keywordtype">bool</span> broken = <span class="keyword">false</span>;</div>
<div class="line"><a name="l00918"></a><span class="lineno">  918</span>&#160;      <span class="keyword">auto</span> pos0 = fwdUpdTkState[sortedtksidx[0]].position();</div>
<div class="line"><a name="l00919"></a><span class="lineno">  919</span>&#160;      <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i = 1;</div>
<div class="line"><a name="l00920"></a><span class="lineno">  920</span>&#160;      <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="../../d5/d62/namespaceicarus_1_1ns_1_1util.html#aac918da84f16d53ad17bab4f817da1c4">end</a> = sortedtksidx.size() - 1;</div>
<div class="line"><a name="l00921"></a><span class="lineno">  921</span>&#160;      <span class="keywordflow">for</span> (; i &lt; <a class="code" href="../../d5/d62/namespaceicarus_1_1ns_1_1util.html#aac918da84f16d53ad17bab4f817da1c4">end</a>; ++i) {</div>
<div class="line"><a name="l00922"></a><span class="lineno">  922</span>&#160;        <span class="keyword">auto</span> dir0 = fwdUpdTkState[sortedtksidx[i]].position() - pos0;</div>
<div class="line"><a name="l00923"></a><span class="lineno">  923</span>&#160;        <span class="keyword">auto</span> dir2 =</div>
<div class="line"><a name="l00924"></a><span class="lineno">  924</span>&#160;          fwdUpdTkState[sortedtksidx[i + 1]].position() - fwdUpdTkState[sortedtksidx[i]].position();</div>
<div class="line"><a name="l00925"></a><span class="lineno">  925</span>&#160;        dir0 /= dir0.R();</div>
<div class="line"><a name="l00926"></a><span class="lineno">  926</span>&#160;        dir2 /= dir2.R();</div>
<div class="line"><a name="l00927"></a><span class="lineno">  927</span>&#160;        <span class="keywordflow">if</span> (dir2.Dot(dir0) &lt; 0.) {</div>
<div class="line"><a name="l00928"></a><span class="lineno">  928</span>&#160;          broken = <span class="keyword">true</span>;</div>
<div class="line"><a name="l00929"></a><span class="lineno">  929</span>&#160;          end--;</div>
<div class="line"><a name="l00930"></a><span class="lineno">  930</span>&#160;          <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00931"></a><span class="lineno">  931</span>&#160;        }</div>
<div class="line"><a name="l00932"></a><span class="lineno">  932</span>&#160;        <span class="keywordflow">else</span></div>
<div class="line"><a name="l00933"></a><span class="lineno">  933</span>&#160;          pos0 = fwdUpdTkState[sortedtksidx[i]].position();</div>
<div class="line"><a name="l00934"></a><span class="lineno">  934</span>&#160;      }</div>
<div class="line"><a name="l00935"></a><span class="lineno">  935</span>&#160;      <span class="keywordflow">if</span> (!broken) { clean = <span class="keyword">true</span>; }</div>
<div class="line"><a name="l00936"></a><span class="lineno">  936</span>&#160;      <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00937"></a><span class="lineno">  937</span>&#160;        rejectedhsidx.push_back(hitstateidx[sortedtksidx[i]]);</div>
<div class="line"><a name="l00938"></a><span class="lineno">  938</span>&#160;        sortedtksidx.erase(sortedtksidx.begin() + i);</div>
<div class="line"><a name="l00939"></a><span class="lineno">  939</span>&#160;      }</div>
<div class="line"><a name="l00940"></a><span class="lineno">  940</span>&#160;    }</div>
<div class="line"><a name="l00941"></a><span class="lineno">  941</span>&#160;  }</div>
<div class="line"><a name="l00942"></a><span class="lineno">  942</span>&#160;  <span class="comment">//</span></div>
<div class="line"><a name="l00943"></a><span class="lineno">  943</span>&#160;}</div>
<div class="ttc" id="classtrkf_1_1TrackKalmanFitter_html_ae0c319b72c3d58667842962a195a7752"><div class="ttname"><a href="../../d6/dca/classtrkf_1_1TrackKalmanFitter.html#ae0c319b72c3d58667842962a195a7752">trkf::TrackKalmanFitter::cleanZigzag_</a></div><div class="ttdeci">bool cleanZigzag_</div><div class="ttdef"><b>Definition:</b> <a href="../../d7/dcf/TrackKalmanFitter_8h_source.html#l00306">TrackKalmanFitter.h:306</a></div></div>
<div class="ttc" id="selectors_8fcl_html_a24c8335057af14a9b508d5ac18999ce5"><div class="ttname"><a href="../../d9/dd2/selectors_8fcl.html#a24c8335057af14a9b508d5ac18999ce5">p</a></div><div class="ttdeci">pdgs p</div><div class="ttdef"><b>Definition:</b> <a href="../../d9/dd2/selectors_8fcl_source.html#l00022">selectors.fcl:22</a></div></div>
<div class="ttc" id="classtrkf_1_1TrackKalmanFitter_html_a16bded3d3b4f7d0602c76a5b105af9f6"><div class="ttname"><a href="../../d6/dca/classtrkf_1_1TrackKalmanFitter.html#a16bded3d3b4f7d0602c76a5b105af9f6">trkf::TrackKalmanFitter::geom</a></div><div class="ttdeci">art::ServiceHandle&lt; geo::Geometry const  &gt; geom</div><div class="ttdef"><b>Definition:</b> <a href="../../d7/dcf/TrackKalmanFitter_8h_source.html#l00299">TrackKalmanFitter.h:299</a></div></div>
<div class="ttc" id="classtrkf_1_1TrackKalmanFitter_html_acbd8f32e18621b3cc8387fc6f01fb190"><div class="ttname"><a href="../../d6/dca/classtrkf_1_1TrackKalmanFitter.html#acbd8f32e18621b3cc8387fc6f01fb190">trkf::TrackKalmanFitter::dumpLevel_</a></div><div class="ttdeci">int dumpLevel_</div><div class="ttdef"><b>Definition:</b> <a href="../../d7/dcf/TrackKalmanFitter_8h_source.html#l00318">TrackKalmanFitter.h:318</a></div></div>
<div class="ttc" id="classtrkf_1_1TrackKalmanFitter_html_a2efa447160c8b4b0cb5fddc93cd05352"><div class="ttname"><a href="../../d6/dca/classtrkf_1_1TrackKalmanFitter.html#a2efa447160c8b4b0cb5fddc93cd05352">trkf::TrackKalmanFitter::negDistTolerance_</a></div><div class="ttdeci">float negDistTolerance_</div><div class="ttdef"><b>Definition:</b> <a href="../../d7/dcf/TrackKalmanFitter_8h_source.html#l00317">TrackKalmanFitter.h:317</a></div></div>
<div class="ttc" id="namespaceicarus_1_1ns_1_1util_html_aac918da84f16d53ad17bab4f817da1c4"><div class="ttname"><a href="../../d5/d62/namespaceicarus_1_1ns_1_1util.html#aac918da84f16d53ad17bab4f817da1c4">icarus::ns::util::end</a></div><div class="ttdeci">auto end(FixedBins&lt; T, C &gt; const &amp;) noexcept</div><div class="ttdef"><b>Definition:</b> <a href="../../d3/dbd/FixedBins_8h_source.html#l00585">FixedBins.h:585</a></div></div>
<div class="ttc" id="namespacedropbox_html_a407b5b895ba9265893768748aaa73825"><div class="ttname"><a href="../../de/d9a/namespacedropbox.html#a407b5b895ba9265893768748aaa73825">dropbox.dir</a></div><div class="ttdeci">tuple dir</div><div class="ttdef"><b>Definition:</b> <a href="../../df/d81/dropbox_8py_source.html#l00028">dropbox.py:28</a></div></div>
<div class="ttc" id="structrecob_1_1TrajectoryPointFlagTraits_html_a52e1b0d7701ede6b439780ccfe24dcf6"><div class="ttname"><a href="../../d4/dff/structrecob_1_1TrajectoryPointFlagTraits.html#a52e1b0d7701ede6b439780ccfe24dcf6">recob::TrajectoryPointFlagTraits::ExcludedFromFit</a></div><div class="ttdeci">static constexpr Flag_t ExcludedFromFit</div><div class="ttdef"><b>Definition:</b> <a href="../../dd/d67/TrajectoryPointFlags_8h_source.html#l00169">TrajectoryPointFlags.h:169</a></div></div>
<div class="ttc" id="classtrkf_1_1TrackKalmanFitter_html_a48c558422473744a041b99ee95c59d95"><div class="ttname"><a href="../../d6/dca/classtrkf_1_1TrackKalmanFitter.html#a48c558422473744a041b99ee95c59d95">trkf::TrackKalmanFitter::sortOutputHitsMinLength_</a></div><div class="ttdeci">bool sortOutputHitsMinLength_</div><div class="ttdef"><b>Definition:</b> <a href="../../d7/dcf/TrackKalmanFitter_8h_source.html#l00304">TrackKalmanFitter.h:304</a></div></div>
<div class="ttc" id="file__to__url_8sh_html_a096ad3d3698082826189c839d7a6e46f"><div class="ttname"><a href="../../d0/dea/file__to__url_8sh.html#a096ad3d3698082826189c839d7a6e46f">s</a></div><div class="ttdeci">then echo File list $list not found else cat $list while read file do echo $file sed s</div><div class="ttdef"><b>Definition:</b> <a href="../../d0/dea/file__to__url_8sh_source.html#l00060">file_to_url.sh:60</a></div></div>
<div class="ttc" id="classtrkf_1_1TrackKalmanFitter_html_a439ce5d209c8590832ce4c5612dbf7b7"><div class="ttname"><a href="../../d6/dca/classtrkf_1_1TrackKalmanFitter.html#a439ce5d209c8590832ce4c5612dbf7b7">trkf::TrackKalmanFitter::skipNegProp_</a></div><div class="ttdeci">bool skipNegProp_</div><div class="ttdef"><b>Definition:</b> <a href="../../d7/dcf/TrackKalmanFitter_8h_source.html#l00305">TrackKalmanFitter.h:305</a></div></div>
<div class="ttc" id="messageservice_8fcl_html_a6699b4dbd72f548e48d81c88697d35a6"><div class="ttname"><a href="../../d8/df5/messageservice_8fcl.html#a6699b4dbd72f548e48d81c88697d35a6">cout</a></div><div class="ttdeci">BEGIN_PROLOG could also be cout</div><div class="ttdef"><b>Definition:</b> <a href="../../d8/df5/messageservice_8fcl_source.html#l00010">messageservice.fcl:10</a></div></div>
</div><!-- fragment -->
</div>
</div>
<h2 class="groupheader">Member Data Documentation</h2>
<a class="anchor" id="ae0c319b72c3d58667842962a195a7752"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">bool trkf::TrackKalmanFitter::cleanZigzag_</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="../../d7/dcf/TrackKalmanFitter_8h_source.html#l00306">306</a> of file <a class="el" href="../../d7/dcf/TrackKalmanFitter_8h_source.html">TrackKalmanFitter.h</a>.</p>

</div>
</div>
<a class="anchor" id="acbd8f32e18621b3cc8387fc6f01fb190"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">int trkf::TrackKalmanFitter::dumpLevel_</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="../../d7/dcf/TrackKalmanFitter_8h_source.html#l00318">318</a> of file <a class="el" href="../../d7/dcf/TrackKalmanFitter_8h_source.html">TrackKalmanFitter.h</a>.</p>

</div>
</div>
<a class="anchor" id="a16bded3d3b4f7d0602c76a5b105af9f6"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">art::ServiceHandle&lt;<a class="el" href="../../d8/df3/classgeo_1_1Geometry.html">geo::Geometry</a> const&gt; trkf::TrackKalmanFitter::geom</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="../../d7/dcf/TrackKalmanFitter_8h_source.html#l00299">299</a> of file <a class="el" href="../../d7/dcf/TrackKalmanFitter_8h_source.html">TrackKalmanFitter.h</a>.</p>

</div>
</div>
<a class="anchor" id="a14e5957cb48a5d5b764883a16e38d960"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">float trkf::TrackKalmanFitter::hitErr2ScaleFact_</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="../../d7/dcf/TrackKalmanFitter_8h_source.html#l00309">309</a> of file <a class="el" href="../../d7/dcf/TrackKalmanFitter_8h_source.html">TrackKalmanFitter.h</a>.</p>

</div>
</div>
<a class="anchor" id="a32e405aa0e9672abe0f28d28d3af8777"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">float trkf::TrackKalmanFitter::maxChi2_</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="../../d7/dcf/TrackKalmanFitter_8h_source.html#l00315">315</a> of file <a class="el" href="../../d7/dcf/TrackKalmanFitter_8h_source.html">TrackKalmanFitter.h</a>.</p>

</div>
</div>
<a class="anchor" id="a3637c0f4a1ead3c751c0a4cc687facdc"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">float trkf::TrackKalmanFitter::maxDist_</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="../../d7/dcf/TrackKalmanFitter_8h_source.html#l00316">316</a> of file <a class="el" href="../../d7/dcf/TrackKalmanFitter_8h_source.html">TrackKalmanFitter.h</a>.</p>

</div>
</div>
<a class="anchor" id="ad91dc22bc6789376670625e65803e70a"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">float trkf::TrackKalmanFitter::maxResidue_</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="../../d7/dcf/TrackKalmanFitter_8h_source.html#l00313">313</a> of file <a class="el" href="../../d7/dcf/TrackKalmanFitter_8h_source.html">TrackKalmanFitter.h</a>.</p>

</div>
</div>
<a class="anchor" id="a796c8a2d3ee31f64c073dca95a009964"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">float trkf::TrackKalmanFitter::maxResidueFirstHit_</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="../../d7/dcf/TrackKalmanFitter_8h_source.html#l00314">314</a> of file <a class="el" href="../../d7/dcf/TrackKalmanFitter_8h_source.html">TrackKalmanFitter.h</a>.</p>

</div>
</div>
<a class="anchor" id="a2efa447160c8b4b0cb5fddc93cd05352"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">float trkf::TrackKalmanFitter::negDistTolerance_</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="../../d7/dcf/TrackKalmanFitter_8h_source.html#l00317">317</a> of file <a class="el" href="../../d7/dcf/TrackKalmanFitter_8h_source.html">TrackKalmanFitter.h</a>.</p>

</div>
</div>
<a class="anchor" id="ae5732efc6840b8ee63c1da7cae12dc92"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">bool trkf::TrackKalmanFitter::pickBestHitOnWire_</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="../../d7/dcf/TrackKalmanFitter_8h_source.html#l00312">312</a> of file <a class="el" href="../../d7/dcf/TrackKalmanFitter_8h_source.html">TrackKalmanFitter.h</a>.</p>

</div>
</div>
<a class="anchor" id="a029821569a62274483456d270d7cd7e8"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">const <a class="el" href="../../dc/d5e/classtrkf_1_1TrackStatePropagator.html">TrackStatePropagator</a>* trkf::TrackKalmanFitter::propagator</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="../../d7/dcf/TrackKalmanFitter_8h_source.html#l00300">300</a> of file <a class="el" href="../../d7/dcf/TrackKalmanFitter_8h_source.html">TrackKalmanFitter.h</a>.</p>

</div>
</div>
<a class="anchor" id="aee1a59befcc52425c5f57815310eb096"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">bool trkf::TrackKalmanFitter::rejectHighMultHits_</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="../../d7/dcf/TrackKalmanFitter_8h_source.html#l00307">307</a> of file <a class="el" href="../../d7/dcf/TrackKalmanFitter_8h_source.html">TrackKalmanFitter.h</a>.</p>

</div>
</div>
<a class="anchor" id="a072e8273342653ea9a4150d1b60939b7"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">bool trkf::TrackKalmanFitter::rejectHitsNegativeGOF_</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="../../d7/dcf/TrackKalmanFitter_8h_source.html#l00308">308</a> of file <a class="el" href="../../d7/dcf/TrackKalmanFitter_8h_source.html">TrackKalmanFitter.h</a>.</p>

</div>
</div>
<a class="anchor" id="a439ce5d209c8590832ce4c5612dbf7b7"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">bool trkf::TrackKalmanFitter::skipNegProp_</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="../../d7/dcf/TrackKalmanFitter_8h_source.html#l00305">305</a> of file <a class="el" href="../../d7/dcf/TrackKalmanFitter_8h_source.html">TrackKalmanFitter.h</a>.</p>

</div>
</div>
<a class="anchor" id="a444bcfb6fd6cdf59ae68f7ee2c366368"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">bool trkf::TrackKalmanFitter::sortHitsByPlane_</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="../../d7/dcf/TrackKalmanFitter_8h_source.html#l00302">302</a> of file <a class="el" href="../../d7/dcf/TrackKalmanFitter_8h_source.html">TrackKalmanFitter.h</a>.</p>

</div>
</div>
<a class="anchor" id="aa38e65d72933ec4e4ff502510d9b3c12"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">bool trkf::TrackKalmanFitter::sortHitsByWire_</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="../../d7/dcf/TrackKalmanFitter_8h_source.html#l00303">303</a> of file <a class="el" href="../../d7/dcf/TrackKalmanFitter_8h_source.html">TrackKalmanFitter.h</a>.</p>

</div>
</div>
<a class="anchor" id="a48c558422473744a041b99ee95c59d95"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">bool trkf::TrackKalmanFitter::sortOutputHitsMinLength_</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="../../d7/dcf/TrackKalmanFitter_8h_source.html#l00304">304</a> of file <a class="el" href="../../d7/dcf/TrackKalmanFitter_8h_source.html">TrackKalmanFitter.h</a>.</p>

</div>
</div>
<a class="anchor" id="a2f527686a3b82eaab63104dbb3e870b2"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">bool trkf::TrackKalmanFitter::tryBothDirs_</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="../../d7/dcf/TrackKalmanFitter_8h_source.html#l00311">311</a> of file <a class="el" href="../../d7/dcf/TrackKalmanFitter_8h_source.html">TrackKalmanFitter.h</a>.</p>

</div>
</div>
<a class="anchor" id="a27d510c7be11bd82373d8ab30ac8e6d9"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">bool trkf::TrackKalmanFitter::tryNoSkipWhenFails_</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="../../d7/dcf/TrackKalmanFitter_8h_source.html#l00310">310</a> of file <a class="el" href="../../d7/dcf/TrackKalmanFitter_8h_source.html">TrackKalmanFitter.h</a>.</p>

</div>
</div>
<a class="anchor" id="a36f86ceceded941eb34ee8a1e762c40f"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">bool trkf::TrackKalmanFitter::useRMS_</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="../../d7/dcf/TrackKalmanFitter_8h_source.html#l00301">301</a> of file <a class="el" href="../../d7/dcf/TrackKalmanFitter_8h_source.html">TrackKalmanFitter.h</a>.</p>

</div>
</div>
<hr/>The documentation for this class was generated from the following files:<ul>
<li><a class="el" href="../../d7/dcf/TrackKalmanFitter_8h_source.html">TrackKalmanFitter.h</a></li>
<li><a class="el" href="../../de/d68/TrackKalmanFitter_8cxx_source.html">TrackKalmanFitter.cxx</a></li>
</ul>
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="../../doxygen.png" alt="doxygen"/>
</a> 1.8.5
</small></address>
</body>
</html>
